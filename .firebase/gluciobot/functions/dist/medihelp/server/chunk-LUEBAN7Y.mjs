import './polyfills.server.mjs';
import{$ as Pl,A as he,B as i0,Ba as f0,C as xl,D as Jr,E as $t,F as Cn,Fa as p0,G as Vm,H as Um,Ha as nd,I as qm,Ia as Ym,J as kl,K as fo,L as qe,M as Fe,N as zm,O as Zr,P as ei,Q as ed,R as s0,S as Ol,T as po,U as Z,V as ee,W as Ml,X as Dt,Y as Gm,Z as oe,_ as mo,a as Wn,aa as ls,b as JC,ba as cs,c as Ju,ca as us,d as ZC,da as Fl,e as Yr,ea as jm,f as ss,fa as Km,g as En,ga as $m,h as Xr,ha as o0,i as ot,j as e0,ja as a0,k as t0,l as ho,m as Fm,n as n0,o as Dl,oa as Wm,p as Al,pa as l0,q as Lm,r as Rl,ra as Hm,s as os,sa as Qm,t as Bm,u as r0,ua as c0,v as Zu,va as u0,w as Nl,wa as d0,x as as,xa as td,y as Kt,ya as h0,z as Xe}from"./chunk-NRZ2WLUT.mjs";import{a as m0,b as Xm,c as g0,d as Ll,e as Jm,f as rd,g as y0,h as v0,i as Zm,j as ze,k as ds,l as Hn,m as id,n as w0,o as Bl,p as b0,q as S0,r as Er,s as Wt}from"./chunk-J2LHISQQ.mjs";import{a as an,b as Tr,c as Ee,f as R,h as Yu,i as Xu,j as _}from"./chunk-H6KHSOBK.mjs";var Te=R(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=ln.DEFAULT_MAX_SEND_MESSAGE_LENGTH=ln.Propagate=ln.LogVerbosity=ln.Status=void 0;var j0=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(j0||(ln.Status=j0={})),K0=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(K0||(ln.LogVerbosity=K0={})),$0=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}($0||(ln.Propagate=$0={}));ln.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;ln.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var gg=R((KJ,LF)=>{LF.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var He=R(Bt=>{"use strict";var yg,vg,wg,bg;Object.defineProperty(Bt,"__esModule",{value:!0});Bt.isTracerEnabled=Bt.trace=Bt.log=Bt.setLoggerVerbosity=Bt.setLogger=Bt.getLogger=void 0;var ii=Te(),BF=Ee("process"),VF=gg().version,UF={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},ps=UF,wo=ii.LogVerbosity.ERROR,qF=(vg=(yg=process.env.GRPC_NODE_VERBOSITY)!==null&&yg!==void 0?yg:process.env.GRPC_VERBOSITY)!==null&&vg!==void 0?vg:"";switch(qF.toUpperCase()){case"DEBUG":wo=ii.LogVerbosity.DEBUG;break;case"INFO":wo=ii.LogVerbosity.INFO;break;case"ERROR":wo=ii.LogVerbosity.ERROR;break;case"NONE":wo=ii.LogVerbosity.NONE;break;default:}var zF=()=>ps;Bt.getLogger=zF;var GF=n=>{ps=n};Bt.setLogger=GF;var jF=n=>{wo=n};Bt.setLoggerVerbosity=jF;var KF=(n,...e)=>{let t;if(n>=wo){switch(n){case ii.LogVerbosity.DEBUG:t=ps.debug;break;case ii.LogVerbosity.INFO:t=ps.info;break;case ii.LogVerbosity.ERROR:t=ps.error;break}t||(t=ps.error),t&&t.bind(ps)(...e)}};Bt.log=KF;var $F=(bg=(wg=process.env.GRPC_NODE_TRACE)!==null&&wg!==void 0?wg:process.env.GRPC_TRACE)!==null&&bg!==void 0?bg:"",Sg=new Set,W0=new Set;for(let n of $F.split(","))n.startsWith("-")?W0.add(n.substring(1)):Sg.add(n);var WF=Sg.has("all");function HF(n,e,t){H0(e)&&(0,Bt.log)(n,new Date().toISOString()+" | v"+VF+" "+BF.pid+" | "+e+" | "+t)}Bt.trace=HF;function H0(n){return!W0.has(n)&&(WF||Sg.has(n))}Bt.isTracerEnabled=H0});var ud=R(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.getErrorCode=bo.getErrorMessage=void 0;function QF(n){return n instanceof Error?n.message:String(n)}bo.getErrorMessage=QF;function YF(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}bo.getErrorCode=YF});var Ht=R(hd=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});hd.Metadata=void 0;var XF=He(),JF=Te(),ZF=ud(),eL=/^[0-9a-z_.-]+$/,tL=/^[ -~]*$/;function nL(n){return eL.test(n)}function rL(n){return tL.test(n)}function Y0(n){return n.endsWith("-bin")}function iL(n){return!n.startsWith("grpc-")}function dd(n){return n.toLowerCase()}function Q0(n,e){if(!nL(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Y0(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!rL(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var _g=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=dd(e),Q0(e,t),this.internalRepr.set(e,[t])}add(e,t){e=dd(e),Q0(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=dd(e),this.internalRepr.delete(e)}get(e){return e=dd(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(sL);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{Y0(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(iL(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,ZF.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,XF.log)(JF.LogVerbosity.ERROR,o)}}return t}};hd.Metadata=_g;var sL=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Dg=R(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});fd.CallCredentials=void 0;var Ig=Ht();function oL(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var So=class n{static createFromMetadataGenerator(e){return new Eg(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;oL(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Ig.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new Cg}};fd.CallCredentials=So;var Tg=class n extends So{constructor(e){super(),this.creds=e}generateMetadata(e){return _(this,null,function*(){let t=new Ig.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},Eg=class n extends So{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Tg([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Cg=class n extends So{generateMetadata(e){return Promise.resolve(new Ig.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Rg=R(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.getDefaultRootsData=_o.CIPHER_SUITES=void 0;var aL=Ee("fs");_o.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var X0=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Ag=null;function lL(){return X0?(Ag===null&&(Ag=aL.readFileSync(X0)),Ag):null}_o.getDefaultRootsData=lL});var gd=R(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.ChannelCredentials=void 0;var cL=Ee("tls"),uL=Dg(),J0=Rg();function Ng(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var To=class{constructor(e){this.callCredentials=e||uL.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Ng(e,"Root certificate"),Ng(t,"Private key"),Ng(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,cL.createSecureContext)({ca:(s=e??(0,J0.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:J0.CIPHER_SUITES});return new pd(o,i??{})}static createFromSecureContext(e,t){return new pd(e,t??{})}static createInsecure(){return new xg}};md.ChannelCredentials=To;var xg=class n extends To{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},pd=class n extends To{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new kg(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},kg=class n extends To{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var oi=R(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.validateLoadBalancingConfig=At.getFirstUsableConfig=At.isLoadBalancerNameRegistered=At.createLoadBalancer=At.registerDefaultLoadBalancerType=At.registerLoadBalancerType=At.createChildChannelControlHelper=void 0;function dL(n,e){var t,r,i,s,o,a,l,c,u,m;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(m=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&m!==void 0?m:n.removeChannelzChild.bind(n)}}At.createChildChannelControlHelper=dL;var si={},Og=null;function hL(n,e,t){si[n]={LoadBalancer:e,LoadBalancingConfig:t}}At.registerLoadBalancerType=hL;function fL(n){Og=n}At.registerDefaultLoadBalancerType=fL;function pL(n,e){let t=n.getLoadBalancerName();return t in si?new si[t].LoadBalancer(e):null}At.createLoadBalancer=pL;function mL(n){return n in si}At.isLoadBalancerNameRegistered=mL;function gL(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in si)return t;return e&&Og?new si[Og].LoadBalancingConfig:null}At.getFirstUsableConfig=gL;function yL(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in si)return si[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}At.validateLoadBalancingConfig=yL});var Mg=R(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.extractAndSelectServiceConfig=ai.validateServiceConfig=ai.validateRetryThrottling=void 0;var vL=Ee("os"),yd=Te(),wL=oi(),vd=/^\d+(\.\d{1,9})?s$/,bL="node";function SL(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function _L(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!vd.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!vd.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(yd.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(yd.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function TL(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!vd.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(yd.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(yd.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function EL(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(SL(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&vd.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=_L(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=TL(n.hedgingPolicy));return t}function Z0(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}ai.validateRetryThrottling=Z0;function eI(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,wL.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(EL(r));"retryThrottling"in n&&(e.retryThrottling=Z0(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}ai.validateServiceConfig=eI;function CL(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:eI(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function IL(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=CL(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===vL.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===bL&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function DL(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return IL(i,e)}return null}ai.extractAndSelectServiceConfig=DL});var cn=R(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});wd.ConnectivityState=void 0;var tI=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(tI||(wd.ConnectivityState=tI={}))});var en=R(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.uriToString=li.splitHostPort=li.parseUri=void 0;var AL=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function RL(n){let e=AL.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}li.parseUri=RL;var nI=/^\d+$/;function NL(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return nI.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?nI.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}li.splitHostPort=NL;function xL(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}li.uriToString=xL});var Qn=R(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.mapUriDefaultScheme=un.getDefaultAuthority=un.createResolver=un.registerDefaultScheme=un.registerResolver=void 0;var Fg=en(),Eo={},Pg=null;function kL(n,e){Eo[n]=e}un.registerResolver=kL;function OL(n){Pg=n}un.registerDefaultScheme=OL;function ML(n,e,t){if(n.scheme!==void 0&&n.scheme in Eo)return new Eo[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Fg.uriToString)(n)}`)}un.createResolver=ML;function PL(n){if(n.scheme!==void 0&&n.scheme in Eo)return Eo[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Fg.uriToString)(n)}`)}un.getDefaultAuthority=PL;function FL(n){return n.scheme===void 0||!(n.scheme in Eo)?Pg!==null?{scheme:Pg,authority:void 0,path:(0,Fg.uriToString)(n)}:null:n}un.mapUriDefaultScheme=FL});var ui=R(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.QueuePicker=ci.UnavailablePicker=ci.PickResultType=void 0;var LL=Ht(),BL=Te(),bd=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(bd||(ci.PickResultType=bd={})),Lg=class{constructor(e){this.status=Object.assign({code:BL.Status.UNAVAILABLE,details:"No connection established",metadata:new LL.Metadata},e)}pick(e){return{pickResultType:bd.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};ci.UnavailablePicker=Lg;var Bg=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:bd.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};ci.QueuePicker=Bg});var zl=R(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});Sd.BackoffTimeout=void 0;var VL=1e3,UL=1.6,qL=12e4,zL=.2;function GL(n,e){return Math.random()*(e-n)+n}var Vg=class{constructor(e,t){this.callback=e,this.initialDelay=VL,this.multiplier=UL,this.maxDelay=qL,this.jitter=zL,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+GL(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Sd.BackoffTimeout=Vg});var Td=R(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.ChildLoadBalancerHandler=void 0;var jL=oi(),KL=cn(),$L="child_load_balancer_helper",Ug=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===KL.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,jL.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return $L}};_d.ChildLoadBalancerHandler=Ug});var iI=R(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});Ed.ResolvingLoadBalancer=void 0;var WL=oi(),HL=Mg(),Qt=cn(),QL=Qn(),Co=ui(),YL=zl(),qg=Te(),XL=Ht(),JL=He(),ZL=Te(),e2=en(),t2=Td(),n2="resolving_load_balancer";function rI(n){JL.trace(ZL.LogVerbosity.DEBUG,n2,n)}var r2=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function i2(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function s2(n,e,t,r){for(let i of t)if(i2(n,e,i,r))return i;return null}function o2(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of r2){let u=s2(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:qg.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:qg.Status.OK,dynamicFilterFactories:[]}}}var zg=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Qt.ConnectivityState.IDLE,this.latestChildPicker=new Co.QueuePicker(this),this.currentState=Qt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,HL.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Qt.ConnectivityState.IDLE,new Co.QueuePicker(this)),this.childLoadBalancer=new t2.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(rI("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,QL.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,m)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let S=null;l===null?c===null?(this.previousServiceConfig=null,S=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):S=this.previousServiceConfig:(S=l,this.previousServiceConfig=l);let T=(g=S?.loadBalancingConfig)!==null&&g!==void 0?g:[],C=(0,WL.getFirstUsableConfig)(T,!0);if(C===null){this.handleResolutionFailure({code:qg.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new XL.Metadata});return}this.childLoadBalancer.updateAddressList(a,C,m);let E=S??this.defaultServiceConfig;this.onSuccessfulResolution(E,u??o2(E))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new YL.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Qt.ConnectivityState.IDLE&&this.updateState(Qt.ConnectivityState.CONNECTING,new Co.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){rI((0,e2.uriToString)(this.target)+" "+Qt.ConnectivityState[this.currentState]+" -> "+Qt.ConnectivityState[e]),e===Qt.ConnectivityState.IDLE&&(t=new Co.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Qt.ConnectivityState.IDLE&&(this.updateState(Qt.ConnectivityState.TRANSIENT_FAILURE,new Co.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Qt.ConnectivityState.IDLE||this.currentState===Qt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Qt.ConnectivityState.IDLE,this.latestChildPicker=new Co.QueuePicker(this),this.currentState=Qt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Ed.ResolvingLoadBalancer=zg});var sI=R(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.channelOptionsEqual=Io.recognizedOptions=void 0;Io.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function a2(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Io.channelOptionsEqual=a2});var Xn=R(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.stringToSubchannelAddress=Yn.subchannelAddressToString=Yn.subchannelAddressEqual=Yn.isTcpSubchannelAddress=void 0;var l2=Ee("net");function Gl(n){return"port"in n}Yn.isTcpSubchannelAddress=Gl;function c2(n,e){return!n&&!e?!0:!n||!e?!1:Gl(n)?Gl(e)&&n.host===e.host&&n.port===e.port:!Gl(e)&&n.path===e.path}Yn.subchannelAddressEqual=c2;function u2(n){return Gl(n)?n.host+":"+n.port:n.path}Yn.subchannelAddressToString=u2;var d2=443;function h2(n,e){return(0,l2.isIP)(n)?{host:n,port:e??d2}:{path:n}}Yn.stringToSubchannelAddress=h2});var Cd=R(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.addAdminServicesToServer=Do.registerAdminService=void 0;var oI=[];function f2(n,e){oI.push({getServiceDefinition:n,getHandlers:e})}Do.registerAdminService=f2;function p2(n){for(let{getServiceDefinition:e,getHandlers:t}of oI)n.addService(e(),t())}Do.addAdminServicesToServer=p2});var aI=R(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.ClientDuplexStreamImpl=dn.ClientWritableStreamImpl=dn.ClientReadableStreamImpl=dn.ClientUnaryCallImpl=dn.callErrorFromStatus=void 0;var m2=Ee("events"),Wg=Ee("stream"),jl=Te();function g2(n,e){let t=`${n.code} ${jl.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}dn.callErrorFromStatus=g2;var Gg=class extends m2.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(jl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};dn.ClientUnaryCallImpl=Gg;var jg=class extends Wg.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(jl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};dn.ClientReadableStreamImpl=jg;var Kg=class extends Wg.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(jl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dn.ClientWritableStreamImpl=Kg;var $g=class extends Wg.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(jl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dn.ClientDuplexStreamImpl=$g});var lI=R(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.InterceptingListenerImpl=Ao.isInterceptingListener=void 0;function y2(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Ao.isInterceptingListener=y2;var Hg=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Ao.InterceptingListenerImpl=Hg});var ty=R(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.getInterceptingCall=hn.InterceptingCall=hn.RequesterBuilder=hn.ListenerBuilder=hn.InterceptorConfigurationError=void 0;var v2=Ht(),cI=lI(),uI=Te(),dI=ud(),$l=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};hn.InterceptorConfigurationError=$l;var Yg=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};hn.ListenerBuilder=Yg;var Xg=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};hn.RequesterBuilder=Xg;var Qg={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Kl={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Jg=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Kl.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Kl.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Kl.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Kl.cancel}:this.requester=Kl}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,m)=>{var g,S,T;this.processingMetadata=!1;let C;if((0,cI.isInterceptingListener)(m))C=m;else{let E={onReceiveMetadata:(g=m.onReceiveMetadata)!==null&&g!==void 0?g:Qg.onReceiveMetadata,onReceiveMessage:(S=m.onReceiveMessage)!==null&&S!==void 0?S:Qg.onReceiveMessage,onReceiveStatus:(T=m.onReceiveStatus)!==null&&T!==void 0?T:Qg.onReceiveStatus};C=new cI.InterceptingListenerImpl(E,c)}this.nextCall.start(u,C),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};hn.InterceptingCall=Jg;function w2(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Id=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(uI.Status.INTERNAL,`Request message serialization failure: ${(0,dI.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:uI.Status.INTERNAL,details:`Response message parsing error: ${(0,dI.getErrorMessage)(a)}`,metadata:new v2.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Zg=class extends Id{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},ey=class extends Id{};function b2(n,e,t){let r=w2(n,t.path,e);return t.responseStream?new ey(r,t):new Zg(r,t)}function S2(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new $l("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new $l("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>b2(r,a,e))(s)}hn.getInterceptingCall=S2});var iy=R(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.Client=void 0;var Jn=aI(),_2=sy(),T2=cn(),di=Te(),Ro=Ht(),Dd=ty(),An=Symbol(),No=Symbol(),xo=Symbol(),Cr=Symbol();function ny(n){return typeof n=="function"}function ko(n){return n.stack.split(`
`).slice(1).join(`
`)}var ry=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[No]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[xo]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[No].length>0&&this[xo].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Cr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[An]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[An]=o(e,t,r)}else this[An]=new _2.ChannelImplementation(e,t,r)}close(){this[An].close()}getChannel(){return this[An]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[An].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===T2.ConnectivityState.READY)t();else try{this[An].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(ny(e))return{metadata:new Ro.Metadata,options:{},callback:e};if(ny(t))return e instanceof Ro.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Ro.Metadata,options:e,callback:t};if(!(e instanceof Ro.Metadata&&t instanceof Object&&ny(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),m={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},g={argument:i,metadata:u.metadata,call:new Jn.ClientUnaryCallImpl,channel:this[An],methodDefinition:m,callOptions:u.options,callback:u.callback};this[Cr]&&(g=this[Cr](g));let S=g.call,T={clientInterceptors:this[No],clientInterceptorProviders:this[xo],callInterceptors:(l=g.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=g.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},C=(0,Dd.getInterceptingCall)(T,g.methodDefinition,g.callOptions,g.channel);S.call=C;let E=null,x=!1,A=new Error;return C.start(g.metadata,{onReceiveMetadata:k=>{S.emit("metadata",k)},onReceiveMessage(k){E!==null&&C.cancelWithStatus(di.Status.INTERNAL,"Too many responses received"),E=k},onReceiveStatus(k){if(!x){if(x=!0,k.code===di.Status.OK)if(E===null){let O=ko(A);g.callback((0,Jn.callErrorFromStatus)({code:di.Status.INTERNAL,details:"No message received",metadata:k.metadata},O))}else g.callback(null,E);else{let O=ko(A);g.callback((0,Jn.callErrorFromStatus)(k,O))}A=null,S.emit("status",k)}}}),C.sendMessage(i),C.halfClose(),S}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},m={metadata:c.metadata,call:new Jn.ClientWritableStreamImpl(t),channel:this[An],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Cr]&&(m=this[Cr](m));let g=m.call,S={clientInterceptors:this[No],clientInterceptorProviders:this[xo],callInterceptors:(a=m.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},T=(0,Dd.getInterceptingCall)(S,m.methodDefinition,m.callOptions,m.channel);g.call=T;let C=null,E=!1,x=new Error;return T.start(m.metadata,{onReceiveMetadata:A=>{g.emit("metadata",A)},onReceiveMessage(A){C!==null&&T.cancelWithStatus(di.Status.INTERNAL,"Too many responses received"),C=A},onReceiveStatus(A){if(!E){if(E=!0,A.code===di.Status.OK)if(C===null){let k=ko(x);m.callback((0,Jn.callErrorFromStatus)({code:di.Status.INTERNAL,details:"No message received",metadata:A.metadata},k))}else m.callback(null,C);else{let k=ko(x);m.callback((0,Jn.callErrorFromStatus)(A,k))}x=null,g.emit("status",A)}}}),g}checkMetadataAndOptions(e,t){let r,i;return e instanceof Ro.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Ro.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},m={argument:i,metadata:c.metadata,call:new Jn.ClientReadableStreamImpl(r),channel:this[An],methodDefinition:u,callOptions:c.options};this[Cr]&&(m=this[Cr](m));let g=m.call,S={clientInterceptors:this[No],clientInterceptorProviders:this[xo],callInterceptors:(a=m.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},T=(0,Dd.getInterceptingCall)(S,m.methodDefinition,m.callOptions,m.channel);g.call=T;let C=!1,E=new Error;return T.start(m.metadata,{onReceiveMetadata(x){g.emit("metadata",x)},onReceiveMessage(x){g.push(x)},onReceiveStatus(x){if(!C){if(C=!0,g.push(null),x.code!==di.Status.OK){let A=ko(E);g.emit("error",(0,Jn.callErrorFromStatus)(x,A))}E=null,g.emit("status",x)}}}),T.sendMessage(i),T.halfClose(),g}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Jn.ClientDuplexStreamImpl(t,r),channel:this[An],methodDefinition:c,callOptions:l.options};this[Cr]&&(u=this[Cr](u));let m=u.call,g={clientInterceptors:this[No],clientInterceptorProviders:this[xo],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},S=(0,Dd.getInterceptingCall)(g,u.methodDefinition,u.callOptions,u.channel);m.call=S;let T=!1,C=new Error;return S.start(u.metadata,{onReceiveMetadata(E){m.emit("metadata",E)},onReceiveMessage(E){m.push(E)},onReceiveStatus(E){if(!T){if(T=!0,m.push(null),E.code!==di.Status.OK){let x=ko(C);m.emit("error",(0,Jn.callErrorFromStatus)(E,x))}C=null,m.emit("status",E)}}}),m}};Ad.Client=ry});var ay=R(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.loadPackageDefinition=Oo.makeClientConstructor=void 0;var Wl=iy(),E2={unary:Wl.Client.prototype.makeUnaryRequest,server_stream:Wl.Client.prototype.makeServerStreamRequest,client_stream:Wl.Client.prototype.makeClientStreamRequest,bidi:Wl.Client.prototype.makeBidiStreamRequest};function oy(n){return["__proto__","prototype","constructor"].includes(n)}function hI(n,e,t){t||(t={});class r extends Wl.Client{}return Object.keys(n).forEach(i=>{if(oy(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=C2(E2[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!oy(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Oo.makeClientConstructor=hI;function C2(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function I2(n){return"format"in n}function D2(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>oy(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];I2(r)?o[s]=r:o[s]=hI(r,s,{})}return e}Oo.loadPackageDefinition=D2});var LI=R((yZ,FI)=>{"use strict";var A2=1/0,R2="[object Symbol]",N2=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,x2=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Nd="\\ud800-\\udfff",bI="\\u0300-\\u036f\\ufe20-\\ufe23",SI="\\u20d0-\\u20f0",_I="\\u2700-\\u27bf",TI="a-z\\xdf-\\xf6\\xf8-\\xff",k2="\\xac\\xb1\\xd7\\xf7",O2="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",M2="\\u2000-\\u206f",P2=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",EI="A-Z\\xc0-\\xd6\\xd8-\\xde",CI="\\ufe0e\\ufe0f",II=k2+O2+M2+P2,cy="['\u2019]",F2="["+Nd+"]",fI="["+II+"]",Rd="["+bI+SI+"]",DI="\\d+",L2="["+_I+"]",AI="["+TI+"]",RI="[^"+Nd+II+DI+_I+TI+EI+"]",ly="\\ud83c[\\udffb-\\udfff]",B2="(?:"+Rd+"|"+ly+")",NI="[^"+Nd+"]",uy="(?:\\ud83c[\\udde6-\\uddff]){2}",dy="[\\ud800-\\udbff][\\udc00-\\udfff]",Mo="["+EI+"]",xI="\\u200d",pI="(?:"+AI+"|"+RI+")",V2="(?:"+Mo+"|"+RI+")",mI="(?:"+cy+"(?:d|ll|m|re|s|t|ve))?",gI="(?:"+cy+"(?:D|LL|M|RE|S|T|VE))?",kI=B2+"?",OI="["+CI+"]?",U2="(?:"+xI+"(?:"+[NI,uy,dy].join("|")+")"+OI+kI+")*",MI=OI+kI+U2,q2="(?:"+[L2,uy,dy].join("|")+")"+MI,z2="(?:"+[NI+Rd+"?",Rd,uy,dy,F2].join("|")+")",G2=RegExp(cy,"g"),j2=RegExp(Rd,"g"),K2=RegExp(ly+"(?="+ly+")|"+z2+MI,"g"),$2=RegExp([Mo+"?"+AI+"+"+mI+"(?="+[fI,Mo,"$"].join("|")+")",V2+"+"+gI+"(?="+[fI,Mo+pI,"$"].join("|")+")",Mo+"?"+pI+"+"+mI,Mo+"+"+gI,DI,q2].join("|"),"g"),W2=RegExp("["+xI+Nd+bI+SI+CI+"]"),H2=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Q2={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},Y2=typeof global=="object"&&global&&global.Object===Object&&global,X2=typeof self=="object"&&self&&self.Object===Object&&self,J2=Y2||X2||Function("return this")();function Z2(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function eB(n){return n.split("")}function tB(n){return n.match(N2)||[]}function nB(n){return function(e){return n?.[e]}}var rB=nB(Q2);function PI(n){return W2.test(n)}function iB(n){return H2.test(n)}function sB(n){return PI(n)?oB(n):eB(n)}function oB(n){return n.match(K2)||[]}function aB(n){return n.match($2)||[]}var lB=Object.prototype,cB=lB.toString,yI=J2.Symbol,vI=yI?yI.prototype:void 0,wI=vI?vI.toString:void 0;function uB(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function dB(n){if(typeof n=="string")return n;if(gB(n))return wI?wI.call(n):"";var e=n+"";return e=="0"&&1/n==-A2?"-0":e}function hB(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:uB(n,e,t)}function fB(n){return function(e){e=xd(e);var t=PI(e)?sB(e):void 0,r=t?t[0]:e.charAt(0),i=t?hB(t,1).join(""):e.slice(1);return r[n]()+i}}function pB(n){return function(e){return Z2(SB(wB(e).replace(G2,"")),n,"")}}function mB(n){return!!n&&typeof n=="object"}function gB(n){return typeof n=="symbol"||mB(n)&&cB.call(n)==R2}function xd(n){return n==null?"":dB(n)}var yB=pB(function(n,e,t){return e=e.toLowerCase(),n+(t?vB(e):e)});function vB(n){return bB(xd(n).toLowerCase())}function wB(n){return n=xd(n),n&&n.replace(x2,rB).replace(j2,"")}var bB=fB("toUpperCase");function SB(n,e,t){return n=xd(n),e=t?void 0:e,e===void 0?iB(n)?aB(n):tB(n):n.match(e)||[]}FI.exports=yB});var hy=R((vZ,BI)=>{"use strict";BI.exports=_B;function _B(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var m=new Array(arguments.length-1),g=0;g<m.length;)m[g++]=arguments[g];a.apply(null,m)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var zI=R(qI=>{"use strict";var kd=qI;kd.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Po=new Array(64),UI=new Array(123);for(Rn=0;Rn<64;)UI[Po[Rn]=Rn<26?Rn+65:Rn<52?Rn+71:Rn<62?Rn-4:Rn-59|43]=Rn++;var Rn;kd.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=Po[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=Po[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=Po[l|c>>6],s[o++]=Po[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Po[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var VI="invalid encoding";kd.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=UI[l])===void 0)throw Error(VI);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(VI);return r-i};kd.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var jI=R((bZ,GI)=>{"use strict";GI.exports=Od;function Od(){this._listeners={}}Od.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Od.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Od.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var XI=R((SZ,YI)=>{"use strict";YI.exports=KI(KI);function KI(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,$I),n.writeFloatBE=e.bind(null,WI);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,HI),n.readFloatBE=t.bind(null,QI)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var m=Math.floor(Math.log(o)/Math.LN2);m===1024&&(m=1023),u=o*Math.pow(2,-m),r(u*4503599627370496>>>0,a,l+i),r((c<<31|m+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,$I,0,4),n.writeDoubleBE=e.bind(null,WI,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,m=c>>>20&2047,g=4294967296*(c&1048575)+l;return m===2047?g?NaN:u*(1/0):m===0?u*5e-324*g:u*Math.pow(2,m-1075)*(g+4503599627370496)}n.readDoubleLE=t.bind(null,HI,0,4),n.readDoubleBE=t.bind(null,QI,4,0)}(),n}function $I(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function WI(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function HI(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function QI(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var fy=R((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var ZI=R(JI=>{"use strict";var py=JI;py.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};py.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};py.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var tD=R((TZ,eD)=>{"use strict";eD.exports=TB;function TB(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var rD=R((EZ,nD)=>{"use strict";nD.exports=gt;var Hl=Zn();function gt(n,e){this.lo=n>>>0,this.hi=e>>>0}var ms=gt.zero=new gt(0,0);ms.toNumber=function(){return 0};ms.zzEncode=ms.zzDecode=function(){return this};ms.length=function(){return 1};var EB=gt.zeroHash="\0\0\0\0\0\0\0\0";gt.fromNumber=function(e){if(e===0)return ms;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new gt(r,i)};gt.from=function(e){if(typeof e=="number")return gt.fromNumber(e);if(Hl.isString(e))if(Hl.Long)e=Hl.Long.fromString(e);else return gt.fromNumber(parseInt(e,10));return e.low||e.high?new gt(e.low>>>0,e.high>>>0):ms};gt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};gt.prototype.toLong=function(e){return Hl.Long?new Hl.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var hi=String.prototype.charCodeAt;gt.fromHash=function(e){return e===EB?ms:new gt((hi.call(e,0)|hi.call(e,1)<<8|hi.call(e,2)<<16|hi.call(e,3)<<24)>>>0,(hi.call(e,4)|hi.call(e,5)<<8|hi.call(e,6)<<16|hi.call(e,7)<<24)>>>0)};gt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};gt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};gt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};gt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Zn=R(my=>{"use strict";var Y=my;Y.asPromise=hy();Y.base64=zI();Y.EventEmitter=jI();Y.float=XI();Y.inquire=fy();Y.utf8=ZI();Y.pool=tD();Y.LongBits=rD();Y.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Y.global=Y.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||my;Y.emptyArray=Object.freeze?Object.freeze([]):[];Y.emptyObject=Object.freeze?Object.freeze({}):{};Y.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Y.isString=function(e){return typeof e=="string"||e instanceof String};Y.isObject=function(e){return e&&typeof e=="object"};Y.isset=Y.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};Y.Buffer=function(){try{var n=Y.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();Y._Buffer_from=null;Y._Buffer_allocUnsafe=null;Y.newBuffer=function(e){return typeof e=="number"?Y.Buffer?Y._Buffer_allocUnsafe(e):new Y.Array(e):Y.Buffer?Y._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Y.Array=typeof Uint8Array<"u"?Uint8Array:Array;Y.Long=Y.global.dcodeIO&&Y.global.dcodeIO.Long||Y.global.Long||Y.inquire("long");Y.key2Re=/^true|false|0|1$/;Y.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Y.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Y.longToHash=function(e){return e?Y.LongBits.from(e).toHash():Y.LongBits.zeroHash};Y.longFromHash=function(e,t){var r=Y.LongBits.fromHash(e);return Y.Long?Y.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function iD(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}Y.merge=iD;Y.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function sD(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&iD(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Y.newError=sD;Y.ProtocolError=sD("ProtocolError");Y.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Y.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};Y.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Y._configure=function(){var n=Y.Buffer;if(!n){Y._Buffer_from=Y._Buffer_allocUnsafe=null;return}Y._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},Y._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Pd=R((IZ,cD)=>{"use strict";cD.exports=we;var fn=Zn(),gy,Md=fn.LongBits,oD=fn.base64,aD=fn.utf8;function Ql(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function vy(){}function CB(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function we(){this.len=0,this.head=new Ql(vy,0,0),this.tail=this.head,this.states=null}var lD=function(){return fn.Buffer?function(){return(we.create=function(){return new gy})()}:function(){return new we}};we.create=lD();we.alloc=function(e){return new fn.Array(e)};fn.Array!==Array&&(we.alloc=fn.pool(we.alloc,fn.Array.prototype.subarray));we.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Ql(e,t,r),this.len+=t,this};function wy(n,e,t){e[t]=n&255}function IB(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function by(n,e){this.len=n,this.next=void 0,this.val=e}by.prototype=Object.create(Ql.prototype);by.prototype.fn=IB;we.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new by((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};we.prototype.int32=function(e){return e<0?this._push(Sy,10,Md.fromNumber(e)):this.uint32(e)};we.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Sy(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}we.prototype.uint64=function(e){var t=Md.from(e);return this._push(Sy,t.length(),t)};we.prototype.int64=we.prototype.uint64;we.prototype.sint64=function(e){var t=Md.from(e).zzEncode();return this._push(Sy,t.length(),t)};we.prototype.bool=function(e){return this._push(wy,1,e?1:0)};function yy(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}we.prototype.fixed32=function(e){return this._push(yy,4,e>>>0)};we.prototype.sfixed32=we.prototype.fixed32;we.prototype.fixed64=function(e){var t=Md.from(e);return this._push(yy,4,t.lo)._push(yy,4,t.hi)};we.prototype.sfixed64=we.prototype.fixed64;we.prototype.float=function(e){return this._push(fn.float.writeFloatLE,4,e)};we.prototype.double=function(e){return this._push(fn.float.writeDoubleLE,8,e)};var DB=fn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};we.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(wy,1,0);if(fn.isString(e)){var r=we.alloc(t=oD.length(e));oD.decode(e,r,0),e=r}return this.uint32(t)._push(DB,t,e)};we.prototype.string=function(e){var t=aD.length(e);return t?this.uint32(t)._push(aD.write,t,e):this._push(wy,1,0)};we.prototype.fork=function(){return this.states=new CB(this),this.head=this.tail=new Ql(vy,0,0),this.len=0,this};we.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ql(vy,0,0),this.len=0),this};we.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};we.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};we._configure=function(n){gy=n,we.create=lD(),gy._configure()}});var hD=R((DZ,dD)=>{"use strict";dD.exports=er;var uD=Pd();(er.prototype=Object.create(uD.prototype)).constructor=er;var fi=Zn();function er(){uD.call(this)}er._configure=function(){er.alloc=fi._Buffer_allocUnsafe,er.writeBytesBuffer=fi.Buffer&&fi.Buffer.prototype instanceof Uint8Array&&fi.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};er.prototype.bytes=function(e){fi.isString(e)&&(e=fi._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(er.writeBytesBuffer,t,e),this};function AB(n,e,t){n.length<40?fi.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}er.prototype.string=function(e){var t=fi.Buffer.byteLength(e);return this.uint32(t),t&&this._push(AB,t,e),this};er._configure()});var Ld=R((AZ,yD)=>{"use strict";yD.exports=Je;var Nn=Zn(),Ty,mD=Nn.LongBits,RB=Nn.utf8;function xn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Je(n){this.buf=n,this.pos=0,this.len=n.length}var fD=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Je(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Je(e);throw Error("illegal buffer")},gD=function(){return Nn.Buffer?function(t){return(Je.create=function(i){return Nn.Buffer.isBuffer(i)?new Ty(i):fD(i)})(t)}:fD};Je.create=gD();Je.prototype._slice=Nn.Array.prototype.subarray||Nn.Array.prototype.slice;Je.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,xn(this,10);return e}}();Je.prototype.int32=function(){return this.uint32()|0};Je.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function _y(){var n=new mD(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw xn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw xn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Je.prototype.bool=function(){return this.uint32()!==0};function Fd(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Je.prototype.fixed32=function(){if(this.pos+4>this.len)throw xn(this,4);return Fd(this.buf,this.pos+=4)};Je.prototype.sfixed32=function(){if(this.pos+4>this.len)throw xn(this,4);return Fd(this.buf,this.pos+=4)|0};function pD(){if(this.pos+8>this.len)throw xn(this,8);return new mD(Fd(this.buf,this.pos+=4),Fd(this.buf,this.pos+=4))}Je.prototype.float=function(){if(this.pos+4>this.len)throw xn(this,4);var e=Nn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Je.prototype.double=function(){if(this.pos+8>this.len)throw xn(this,4);var e=Nn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Je.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw xn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Nn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Je.prototype.string=function(){var e=this.bytes();return RB.read(e,0,e.length)};Je.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw xn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw xn(this);while(this.buf[this.pos++]&128);return this};Je.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Je._configure=function(n){Ty=n,Je.create=gD(),Ty._configure();var e=Nn.Long?"toLong":"toNumber";Nn.merge(Je.prototype,{int64:function(){return _y.call(this)[e](!1)},uint64:function(){return _y.call(this)[e](!0)},sint64:function(){return _y.call(this).zzDecode()[e](!1)},fixed64:function(){return pD.call(this)[e](!0)},sfixed64:function(){return pD.call(this)[e](!1)}})}});var SD=R((RZ,bD)=>{"use strict";bD.exports=gs;var wD=Ld();(gs.prototype=Object.create(wD.prototype)).constructor=gs;var vD=Zn();function gs(n){wD.call(this,n)}gs._configure=function(){vD.Buffer&&(gs.prototype._slice=vD.Buffer.prototype.slice)};gs.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};gs._configure()});var TD=R((NZ,_D)=>{"use strict";_D.exports=Yl;var Ey=Zn();(Yl.prototype=Object.create(Ey.EventEmitter.prototype)).constructor=Yl;function Yl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");Ey.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Yl.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Ey.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Yl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Cy=R(ED=>{"use strict";var NB=ED;NB.Service=TD()});var Iy=R((kZ,CD)=>{"use strict";CD.exports={}});var AD=R(DD=>{"use strict";var Yt=DD;Yt.build="minimal";Yt.Writer=Pd();Yt.BufferWriter=hD();Yt.Reader=Ld();Yt.BufferReader=SD();Yt.util=Zn();Yt.rpc=Cy();Yt.roots=Iy();Yt.configure=ID;function ID(){Yt.util._configure(),Yt.Writer._configure(Yt.BufferWriter),Yt.Reader._configure(Yt.BufferReader)}ID()});var ND=R((MZ,RD)=>{"use strict";RD.exports=Dy;function Dy(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Dy.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var m=new Array(arguments.length-1),g=0;g<m.length;)m[g]=arguments[++g];if(g=0,s=s.replace(/%([%dfijs])/g,function(T,C){var E=m[g++];switch(C){case"d":case"f":return String(Number(E));case"i":return String(Math.floor(E));case"j":return JSON.stringify(E);case"s":return String(E)}return"%"}),g!==m.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Dy.verbose=!1});var kD=R((PZ,xD)=>{"use strict";xD.exports=Xl;var xB=hy(),kB=fy(),Ay=kB("fs");function Xl(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Ay&&Ay.readFile?Ay.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Xl.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Xl.xhr(n,e,t):xB(Xl,this,n,e)}Xl.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var PD=R(MD=>{"use strict";var Ny=MD,OD=Ny.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Ry=Ny.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=OD(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Ny.resolve=function(e,t,r){return r||(t=Ry(t)),OD(t)?t:(r||(e=Ry(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Ry(e+"/"+t):t)}});var ys=R(FD=>{"use strict";var Jl=FD,OB=yt(),MB=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Zl(n,e){var t=0,r={};for(e|=0;t<n.length;)r[MB[t+e]]=n[t++];return r}Jl.basic=Zl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Jl.defaults=Zl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",OB.emptyArray,null]);Jl.long=Zl([0,0,0,1,1],7);Jl.mapKey=Zl([0,0,0,5,5,0,0,0,1,1,0,2],2);Jl.packed=Zl([1,5,0,0,0,5,5,0,0,0,1,1,0])});var pi=R((BZ,VD)=>{"use strict";VD.exports=pn;var Bd=vs();((pn.prototype=Object.create(Bd.prototype)).constructor=pn).className="Field";var LD=kn(),BD=ys(),at=yt(),xy,PB=/^required|optional|repeated$/;pn.fromJSON=function(e,t){return new pn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function pn(n,e,t,r,i,s,o){if(at.isObject(r)?(o=i,s=r,r=i=void 0):at.isObject(i)&&(o=s,s=i,i=void 0),Bd.call(this,n,s),!at.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!at.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!PB.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!at.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=at.Long?BD.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(pn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});pn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Bd.prototype.setOption.call(this,e,t,r)};pn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return at.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};pn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=BD.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof xy?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof LD&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof LD))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=at.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;at.base64.test(this.typeDefault)?at.base64.decode(this.typeDefault,e=at.newBuffer(at.base64.length(this.typeDefault)),0):at.utf8.write(this.typeDefault,e=at.newBuffer(at.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=at.emptyObject:this.repeated?this.defaultValue=at.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof xy&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Bd.prototype.resolve.call(this)};pn.d=function(e,t,r,i){return typeof t=="function"?t=at.decorateType(t).name:t&&typeof t=="object"&&(t=at.decorateEnum(t).name),function(o,a){at.decorateType(o.constructor).add(new pn(a,e,t,r,{default:i}))}};pn._configure=function(e){xy=e}});var Fo=R((VZ,zD)=>{"use strict";zD.exports=mn;var Ud=vs();((mn.prototype=Object.create(Ud.prototype)).constructor=mn).className="OneOf";var UD=pi(),Vd=yt();function mn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Ud.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}mn.fromJSON=function(e,t){return new mn(e,t.oneof,t.options,t.comment)};mn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Vd.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function qD(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}mn.prototype.add=function(e){if(!(e instanceof UD))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,qD(this),this};mn.prototype.remove=function(e){if(!(e instanceof UD))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};mn.prototype.onAdd=function(e){Ud.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}qD(this)};mn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Ud.prototype.onRemove.call(this,e)};mn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Vd.decorateType(i.constructor).add(new mn(s,e)),Object.defineProperty(i,s,{get:Vd.oneOfGetter(e),set:Vd.oneOfSetter(e)})}}});var Vo=R((UZ,$D)=>{"use strict";$D.exports=_e;var ky=vs();((_e.prototype=Object.create(ky.prototype)).constructor=_e).className="Namespace";var GD=pi(),qd=yt(),FB=Fo(),Lo,ec,Bo;_e.fromJSON=function(e,t){return new _e(e,t.options).addJSON(t.nested)};function jD(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}_e.arrayToJSON=jD;_e.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};_e.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function _e(n,e){ky.call(this,n,e),this.nested=void 0,this._nestedArray=null}function KD(n){return n._nestedArray=null,n}Object.defineProperty(_e.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=qd.toArray(this.nested))}});_e.prototype.toJSON=function(e){return qd.toObject(["options",this.options,"nested",jD(this.nestedArray,e)])};_e.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Lo.fromJSON:s.values!==void 0?Bo.fromJSON:s.methods!==void 0?ec.fromJSON:s.id!==void 0?GD.fromJSON:_e.fromJSON)(r[i],s));return this};_e.prototype.get=function(e){return this.nested&&this.nested[e]||null};_e.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Bo)return this.nested[e].values;throw Error("no such enum: "+e)};_e.prototype.add=function(e){if(!(e instanceof GD&&e.extend!==void 0||e instanceof Lo||e instanceof FB||e instanceof Bo||e instanceof ec||e instanceof _e))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof _e&&e instanceof _e&&!(t instanceof Lo||t instanceof ec)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),KD(this)};_e.prototype.remove=function(e){if(!(e instanceof ky))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),KD(this)};_e.prototype.define=function(e,t){if(qd.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof _e))throw Error("path conflicts with non-namespace objects")}else r.add(r=new _e(i))}return t&&r.addJSON(t),r};_e.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof _e?e[t++].resolveAll():e[t++].resolve();return this.resolve()};_e.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),qd.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof _e&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof _e&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};_e.prototype.lookupType=function(e){var t=this.lookup(e,[Lo]);if(!t)throw Error("no such type: "+e);return t};_e.prototype.lookupEnum=function(e){var t=this.lookup(e,[Bo]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};_e.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Lo,Bo]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};_e.prototype.lookupService=function(e){var t=this.lookup(e,[ec]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};_e._configure=function(n,e,t){Lo=n,ec=e,Bo=t}});var zd=R((qZ,WD)=>{"use strict";WD.exports=Ir;var Oy=pi();((Ir.prototype=Object.create(Oy.prototype)).constructor=Ir).className="MapField";var LB=ys(),tc=yt();function Ir(n,e,t,r,i,s){if(Oy.call(this,n,e,r,void 0,void 0,i,s),!tc.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Ir.fromJSON=function(e,t){return new Ir(e,t.id,t.keyType,t.type,t.options,t.comment)};Ir.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return tc.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Ir.prototype.resolve=function(){if(this.resolved)return this;if(LB.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Oy.prototype.resolve.call(this)};Ir.d=function(e,t,r){return typeof r=="function"?r=tc.decorateType(r).name:r&&typeof r=="object"&&(r=tc.decorateEnum(r).name),function(s,o){tc.decorateType(s.constructor).add(new Ir(o,e,t,r))}}});var Gd=R((zZ,HD)=>{"use strict";HD.exports=ws;var My=vs();((ws.prototype=Object.create(My.prototype)).constructor=ws).className="Method";var Uo=yt();function ws(n,e,t,r,i,s,o,a,l){if(Uo.isObject(i)?(o=i,i=s=void 0):Uo.isObject(s)&&(o=s,s=void 0),!(e===void 0||Uo.isString(e)))throw TypeError("type must be a string");if(!Uo.isString(t))throw TypeError("requestType must be a string");if(!Uo.isString(r))throw TypeError("responseType must be a string");My.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}ws.fromJSON=function(e,t){return new ws(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ws.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Uo.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ws.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),My.prototype.resolve.call(this))}});var jd=R((GZ,YD)=>{"use strict";YD.exports=gn;var mi=Vo();((gn.prototype=Object.create(mi.prototype)).constructor=gn).className="Service";var Py=Gd(),nc=yt(),BB=Cy();function gn(n,e){mi.call(this,n,e),this.methods={},this._methodsArray=null}gn.fromJSON=function(e,t){var r=new gn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Py.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};gn.prototype.toJSON=function(e){var t=mi.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return nc.toObject(["options",t&&t.options||void 0,"methods",mi.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(gn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=nc.toArray(this.methods))}});function QD(n){return n._methodsArray=null,n}gn.prototype.get=function(e){return this.methods[e]||mi.prototype.get.call(this,e)};gn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return mi.prototype.resolve.call(this)};gn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Py?(this.methods[e.name]=e,e.parent=this,QD(this)):mi.prototype.add.call(this,e)};gn.prototype.remove=function(e){if(e instanceof Py){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,QD(this)}return mi.prototype.remove.call(this,e)};gn.prototype.create=function(e,t,r){for(var i=new BB.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=nc.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=nc.codegen(["r","c"],nc.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Kd=R((jZ,XD)=>{"use strict";XD.exports=tr;var VB=Zn();function tr(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}tr.create=function(e){return this.$type.create(e)};tr.encode=function(e,t){return this.$type.encode(e,t)};tr.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};tr.decode=function(e){return this.$type.decode(e)};tr.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};tr.verify=function(e){return this.$type.verify(e)};tr.fromObject=function(e){return this.$type.fromObject(e)};tr.toObject=function(e,t){return this.$type.toObject(e,t)};tr.prototype.toJSON=function(){return this.$type.toObject(this,VB.toJSONOptions)}});var Fy=R((KZ,ZD)=>{"use strict";ZD.exports=zB;var UB=kn(),Dr=ys(),JD=yt();function qB(n){return"missing required '"+n.name+"'"}function zB(n){var e=JD.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof UB?"int32":r.type,s="m"+JD.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Dr.defaults[r.keyType]!==void 0?e("k=%j",Dr.defaults[r.keyType]):e("k=null"),Dr.defaults[i]!==void 0?e("value=%j",Dr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),Dr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Dr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Dr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),Dr.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):Dr.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",qB(o))}return e("return m")}});var Vy=R(($Z,eA)=>{"use strict";eA.exports=KB;var GB=kn(),Ly=yt();function yn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function By(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof GB){n("switch(%s){",r)("default:")("return%j",yn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",yn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",yn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",yn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",yn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",yn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",yn(e,"buffer"));break}return n}function jB(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",yn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",yn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",yn(e,"boolean key"));break}return n}function KB(n){var e=Ly.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+Ly.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",yn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),jB(e,s,"k[i]"),By(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",yn(s,"array"))("for(var i=0;i<%s.length;++i){",o),By(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=Ly.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}By(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var zy=R(nA=>{"use strict";var tA=nA,rc=kn(),nr=yt();function Uy(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof rc){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}tA.fromObject=function(e){var t=e.fieldsArray,r=nr.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=nr.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Uy(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Uy(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof rc||r("if(d%s!=null){",o),Uy(r,s,i,o),s.resolvedType instanceof rc||r("}"))}return r("return m")};function qy(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof rc?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}tA.toObject=function(e){var t=e.fieldsArray.slice().sort(nr.compareFieldsById);if(!t.length)return nr.codegen()("return {}");for(var r=nr.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",nr.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",nr.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=nr.safeProp(l.name);if(l.resolvedType instanceof rc)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var m=!1;for(a=0;a<t.length;++a){var l=t[a],g=e._fieldsArray.indexOf(l),c=nr.safeProp(l.name);l.map?(m||(m=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),qy(r,l,g,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),qy(r,l,g,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),qy(r,l,g,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",nr.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Gy=R(rA=>{"use strict";var $B=rA,WB=Kd();$B[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof WB){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Hd=R((QZ,sA)=>{"use strict";sA.exports=Ne;var On=Vo();((Ne.prototype=Object.create(On.prototype)).constructor=Ne).className="Type";var HB=kn(),$y=Fo(),$d=pi(),QB=zd(),YB=jd(),jy=Kd(),Ky=Ld(),XB=Pd(),Rt=yt(),JB=Wy(),ZB=Fy(),eV=Vy(),iA=zy(),tV=Gy();function Ne(n,e){On.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Ne.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Rt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Rt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Ne.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof jy||((n.prototype=new jy).constructor=n,Rt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Rt.merge(n,jy,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Rt.oneOfGetter(this._oneofsArray[t].oneof),set:Rt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Ne.generateConstructor=function(e){for(var t=Rt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Rt.safeProp(i.name)):i.repeated&&t("this%s=[]",Rt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Wd(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Ne.fromJSON=function(e,t){var r=new Ne(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?QB.fromJSON:$d.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add($y.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?$d.fromJSON:o.fields!==void 0?Ne.fromJSON:o.values!==void 0?HB.fromJSON:o.methods!==void 0?YB.fromJSON:On.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Ne.prototype.toJSON=function(e){var t=On.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Rt.toObject(["options",t&&t.options||void 0,"oneofs",On.arrayToJSON(this.oneofsArray,e),"fields",On.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Ne.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return On.prototype.resolveAll.call(this)};Ne.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Ne.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof $d&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Wd(this)}return e instanceof $y?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Wd(this)):On.prototype.add.call(this,e)};Ne.prototype.remove=function(e){if(e instanceof $d&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Wd(this)}if(e instanceof $y){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Wd(this)}return On.prototype.remove.call(this,e)};Ne.prototype.isReservedId=function(e){return On.isReservedId(this.reserved,e)};Ne.prototype.isReservedName=function(e){return On.isReservedName(this.reserved,e)};Ne.prototype.create=function(e){return new this.ctor(e)};Ne.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=JB(this)({Writer:XB,types:t,util:Rt}),this.decode=ZB(this)({Reader:Ky,types:t,util:Rt}),this.verify=eV(this)({types:t,util:Rt}),this.fromObject=iA.fromObject(this)({types:t,util:Rt}),this.toObject=iA.toObject(this)({types:t,util:Rt});var i=tV[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Ne.prototype.encode=function(e,t){return this.setup().encode(e,t)};Ne.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Ne.prototype.decode=function(e,t){return this.setup().decode(e,t)};Ne.prototype.decodeDelimited=function(e){return e instanceof Ky||(e=Ky.create(e)),this.decode(e,e.uint32())};Ne.prototype.verify=function(e){return this.setup().verify(e)};Ne.prototype.fromObject=function(e){return this.setup().fromObject(e)};Ne.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Ne.d=function(e){return function(r){Rt.decorateType(r,e)}}});var Xd=R((YZ,uA)=>{"use strict";uA.exports=tn;var Yd=Vo();((tn.prototype=Object.create(Yd.prototype)).constructor=tn).className="Root";var Qy=pi(),aA=kn(),nV=Fo(),gi=yt(),lA,Hy,ic;function tn(n){Yd.call(this,"",n),this.deferred=[],this.files=[]}tn.fromJSON=function(e,t){return t||(t=new tn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};tn.prototype.resolvePath=gi.path.resolve;tn.prototype.fetch=gi.fetch;function cA(){}tn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return gi.asPromise(n,i,e,t);var s=r===cA;function o(S,T){if(r){if(s)throw S;var C=r;r=null,C(S,T)}}function a(S){var T=S.lastIndexOf("google/protobuf/");if(T>-1){var C=S.substring(T);if(C in ic)return C}return null}function l(S,T){try{if(gi.isString(T)&&T.charAt(0)==="{"&&(T=JSON.parse(T)),!gi.isString(T))i.setOptions(T.options).addJSON(T.nested);else{Hy.filename=S;var C=Hy(T,i,t),E,x=0;if(C.imports)for(;x<C.imports.length;++x)(E=a(C.imports[x])||i.resolvePath(S,C.imports[x]))&&c(E);if(C.weakImports)for(x=0;x<C.weakImports.length;++x)(E=a(C.weakImports[x])||i.resolvePath(S,C.weakImports[x]))&&c(E,!0)}}catch(A){o(A)}!s&&!u&&o(null,i)}function c(S,T){if(S=a(S)||S,!(i.files.indexOf(S)>-1)){if(i.files.push(S),S in ic){s?l(S,ic[S]):(++u,setTimeout(function(){--u,l(S,ic[S])}));return}if(s){var C;try{C=gi.fs.readFileSync(S).toString("utf8")}catch(E){T||o(E);return}l(S,C)}else++u,i.fetch(S,function(E,x){if(--u,!!r){if(E){T?u||o(null,i):o(E);return}l(S,x)}})}}var u=0;gi.isString(e)&&(e=[e]);for(var m=0,g;m<e.length;++m)(g=i.resolvePath("",e[m]))&&c(g);if(s)return i;u||o(null,i)};tn.prototype.loadSync=function(e,t){if(!gi.isNode)throw Error("not supported");return this.load(e,t,cA)};tn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Yd.prototype.resolveAll.call(this)};var Qd=/^[A-Z]/;function oA(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Qy(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}tn.prototype._handleAdd=function(e){if(e instanceof Qy)e.extend!==void 0&&!e.extensionField&&(oA(this,e)||this.deferred.push(e));else if(e instanceof aA)Qd.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof nV)){if(e instanceof lA)for(var t=0;t<this.deferred.length;)oA(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Qd.test(e.name)&&(e.parent[e.name]=e)}};tn.prototype._handleRemove=function(e){if(e instanceof Qy){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof aA)Qd.test(e.name)&&delete e.parent[e.name];else if(e instanceof Yd){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Qd.test(e.name)&&delete e.parent[e.name]}};tn._configure=function(n,e,t){lA=n,Hy=e,ic=t}});var yt=R((XZ,hA)=>{"use strict";var Ze=hA.exports=Zn(),dA=Iy(),Yy,Xy;Ze.codegen=ND();Ze.fetch=kD();Ze.path=PD();Ze.fs=Ze.inquire("fs");Ze.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Ze.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var rV=/\\/g,iV=/"/g;Ze.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Ze.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Ze.isReserved(e)?'["'+e.replace(rV,"\\\\").replace(iV,'\\"')+'"]':"."+e};Ze.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var sV=/_([a-z])/g;Ze.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(sV,function(t,r){return r.toUpperCase()})};Ze.compareFieldsById=function(e,t){return e.id-t.id};Ze.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Ze.decorateRoot.remove(e.$type),e.$type.name=t,Ze.decorateRoot.add(e.$type)),e.$type;Yy||(Yy=Hd());var r=new Yy(t||e.name);return Ze.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var oV=0;Ze.decorateEnum=function(e){if(e.$type)return e.$type;Xy||(Xy=kn());var t=new Xy("Enum"+oV++,e);return Ze.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Ze.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Ze,"decorateRoot",{get:function(){return dA.decorated||(dA.decorated=new(Xd()))}})});var vs=R((JZ,fA)=>{"use strict";fA.exports=nn;nn.className="ReflectionObject";var Jd=yt(),Zd;function nn(n,e){if(!Jd.isString(n))throw TypeError("name must be a string");if(e&&!Jd.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(nn.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});nn.prototype.toJSON=function(){throw Error()};nn.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Zd&&t._handleAdd(this)};nn.prototype.onRemove=function(e){var t=e.root;t instanceof Zd&&t._handleRemove(this),this.parent=null,this.resolved=!1};nn.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Zd&&(this.resolved=!0),this)};nn.prototype.getOption=function(e){if(this.options)return this.options[e]};nn.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};nn.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Jd.setProperty(o,r,t)}else s={},s[e]=Jd.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};nn.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};nn.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};nn._configure=function(n){Zd=n}});var kn=R((ZZ,gA)=>{"use strict";gA.exports=rr;var pA=vs();((rr.prototype=Object.create(pA.prototype)).constructor=rr).className="Enum";var mA=Vo(),eh=yt();function rr(n,e,t,r,i,s){if(pA.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}rr.fromJSON=function(e,t){var r=new rr(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};rr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return eh.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};rr.prototype.add=function(e,t,r,i){if(!eh.isString(e))throw TypeError("name must be a string");if(!eh.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};rr.prototype.remove=function(e){if(!eh.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};rr.prototype.isReservedId=function(e){return mA.isReservedId(this.reserved,e)};rr.prototype.isReservedName=function(e){return mA.isReservedName(this.reserved,e)}});var Wy=R((eee,vA)=>{"use strict";vA.exports=lV;var aV=kn(),Jy=ys(),Zy=yt();function yA(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function lV(n){for(var e=Zy.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(Zy.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof aV?"int32":s.type,l=Jy.basic[a];r="m"+Zy.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Jy.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Jy.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?yA(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?yA(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var bA=R((tee,wA)=>{"use strict";var fe=wA.exports=AD();fe.build="light";function cV(n,e,t){return typeof e=="function"?(t=e,e=new fe.Root):e||(e=new fe.Root),e.load(n,t)}fe.load=cV;function uV(n,e){return e||(e=new fe.Root),e.loadSync(n)}fe.loadSync=uV;fe.encoder=Wy();fe.decoder=Fy();fe.verifier=Vy();fe.converter=zy();fe.ReflectionObject=vs();fe.Namespace=Vo();fe.Root=Xd();fe.Enum=kn();fe.Type=Hd();fe.Field=pi();fe.OneOf=Fo();fe.MapField=zd();fe.Service=jd();fe.Method=Gd();fe.Message=Kd();fe.wrappers=Gy();fe.types=ys();fe.util=yt();fe.ReflectionObject._configure(fe.Root);fe.Namespace._configure(fe.Type,fe.Service,fe.Enum);fe.Root._configure(fe.Type);fe.Field._configure(fe.Type)});var tv=R((nee,TA)=>{"use strict";TA.exports=_A;var ev=/[\s{}=;:[\],'"()<>]/g,dV=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,hV=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,fV=/^ *[*/]+ */,pV=/^\s*\*?\/*/,mV=/\n/g,gV=/\s/,yV=/\\(.?)/g,vV={0:"\0",r:"\r",n:`
`,t:"	"};function SA(n){return n.replace(yV,function(e,t){switch(t){case"\\":case"":return t;default:return vV[t]||""}})}_A.unescape=SA;function _A(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(O){return Error("illegal "+O+" (line "+i+")")}function u(){var O=l==="'"?hV:dV;O.lastIndex=t-1;var z=O.exec(n);if(!z)throw c("string");return t=O.lastIndex,E(l),l=null,SA(z[1])}function m(O){return n.charAt(O)}function g(O,z,Q){var v={type:n.charAt(O++),lineEmpty:!1,leading:Q},h;e?h=2:h=3;var p=O-h,y;do if(--p<0||(y=n.charAt(p))===`
`){v.lineEmpty=!0;break}while(y===" "||y==="	");for(var f=n.substring(O,z).split(mV),w=0;w<f.length;++w)f[w]=f[w].replace(e?pV:fV,"").trim();v.text=f.join(`
`).trim(),o[i]=v,s=i}function S(O){var z=T(O),Q=n.substring(O,z),v=/^\s*\/\//.test(Q);return v}function T(O){for(var z=O;z<r&&m(z)!==`
`;)z++;return z}function C(){if(a.length>0)return a.shift();if(l)return u();var O,z,Q,v,h,p=t===0;do{if(t===r)return null;for(O=!1;gV.test(Q=m(t));)if(Q===`
`&&(p=!0,++i),++t===r)return null;if(m(t)==="/"){if(++t===r)throw c("comment");if(m(t)==="/")if(e){if(v=t,h=!1,S(t-1)){h=!0;do if(t=T(t),t===r||(t++,!p))break;while(S(t))}else t=Math.min(r,T(t)+1);h&&(g(v,t,p),p=!0),i++,O=!0}else{for(h=m(v=t+1)==="/";m(++t)!==`
`;)if(t===r)return null;++t,h&&(g(v,t-1,p),p=!0),++i,O=!0}else if((Q=m(t))==="*"){v=t+1,h=e||m(v)==="*";do{if(Q===`
`&&++i,++t===r)throw c("comment");z=Q,Q=m(t)}while(z!=="*"||Q!=="/");++t,h&&(g(v,t-2,p),p=!0),O=!0}else return"/"}}while(O);var y=t;ev.lastIndex=0;var f=ev.test(m(y++));if(!f)for(;y<r&&!ev.test(m(y));)++y;var w=n.substring(t,t=y);return(w==='"'||w==="'")&&(l=w),w}function E(O){a.push(O)}function x(){if(!a.length){var O=C();if(O===null)return null;E(O)}return a[0]}function A(O,z){var Q=x(),v=Q===O;if(v)return C(),!0;if(!z)throw c("token '"+Q+"', '"+O+"' expected");return!1}function k(O){var z=null,Q;return O===void 0?(Q=o[i-1],delete o[i-1],Q&&(e||Q.type==="*"||Q.lineEmpty)&&(z=Q.leading?Q.text:null)):(s<O&&x(),Q=o[O],delete o[O],Q&&!Q.lineEmpty&&(e||Q.type==="/")&&(z=Q.leading?null:Q.text)),z}return Object.defineProperty({next:C,peek:x,push:E,skip:A,cmnt:k},"line",{get:function(){return i}})}});var RA=R((ree,AA)=>{"use strict";AA.exports=Ar;Ar.filename=null;Ar.defaults={keepCase:!1};var wV=tv(),EA=Xd(),CA=Hd(),IA=pi(),bV=zd(),DA=Fo(),SV=kn(),_V=jd(),TV=Gd(),nv=ys(),rv=yt(),EV=/^[1-9][0-9]*$/,CV=/^-?[1-9][0-9]*$/,IV=/^0[x][0-9a-fA-F]+$/,DV=/^-?0[x][0-9a-fA-F]+$/,AV=/^0[0-7]+$/,RV=/^-?0[0-7]+$/,NV=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ir=/^[a-zA-Z_][a-zA-Z_0-9]*$/,sr=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,xV=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Ar(n,e,t){e instanceof EA||(t=e,e=new EA),t||(t=Ar.defaults);var r=t.preferTrailingComment||!1,i=wV(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,m,g,S,T,C=!1,E=e,x=t.keepCase?function(P){return P}:rv.camelCase;function A(P,F,B){var J=Ar.filename;return B||(Ar.filename=null),Error("illegal "+(F||"token")+" '"+P+"' ("+(J?J+", ":"")+"line "+i.line+")")}function k(){var P=[],F;do{if((F=s())!=='"'&&F!=="'")throw A(F);P.push(s()),l(F),F=a()}while(F==='"'||F==="'");return P.join("")}function O(P){var F=s();switch(F){case"'":case'"':return o(F),k();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return Q(F,!0)}catch{if(P&&sr.test(F))return F;throw A(F,"value")}}function z(P,F){var B,J;do F&&((B=a())==='"'||B==="'")?P.push(k()):P.push([J=v(s()),l("to",!0)?v(s()):J]);while(l(",",!0));var W={options:void 0};W.setOption=function(ce,Ue){this.options===void 0&&(this.options={}),this.options[ce]=Ue},w(W,function(Ue){if(Ue==="option")Re(W,Ue),l(";");else throw A(Ue)},function(){Tt(W)})}function Q(P,F){var B=1;switch(P.charAt(0)==="-"&&(B=-1,P=P.substring(1)),P){case"inf":case"INF":case"Inf":return B*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(EV.test(P))return B*parseInt(P,10);if(IV.test(P))return B*parseInt(P,16);if(AV.test(P))return B*parseInt(P,8);if(NV.test(P))return B*parseFloat(P);throw A(P,"number",F)}function v(P,F){switch(P){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!F&&P.charAt(0)==="-")throw A(P,"id");if(CV.test(P))return parseInt(P,10);if(DV.test(P))return parseInt(P,16);if(RV.test(P))return parseInt(P,8);throw A(P,"id")}function h(){if(m!==void 0)throw A("package");if(m=s(),!sr.test(m))throw A(m,"name");E=E.define(m),l(";")}function p(){var P=a(),F;switch(P){case"weak":F=S||(S=[]),s();break;case"public":s();default:F=g||(g=[]);break}P=k(),l(";"),F.push(P)}function y(){if(l("="),T=k(),C=T==="proto3",!C&&T!=="proto2")throw A(T,"syntax");e.setOption("syntax",T),l(";")}function f(P,F){switch(F){case"option":return Re(P,F),l(";"),!0;case"message":return d(P,F),!0;case"enum":return De(P,F),!0;case"service":return st(P,F),!0;case"extend":return uo(P,F),!0}return!1}function w(P,F,B){var J=i.line;if(P&&(typeof P.comment!="string"&&(P.comment=c()),P.filename=Ar.filename),l("{",!0)){for(var W;(W=s())!=="}";)F(W);l(";",!0)}else B&&B(),l(";"),P&&(typeof P.comment!="string"||r)&&(P.comment=c(J)||P.comment)}function d(P,F){if(!ir.test(F=s()))throw A(F,"type name");var B=new CA(F);w(B,function(W){if(!f(B,W))switch(W){case"map":ve(B,W);break;case"required":case"repeated":b(B,W);break;case"optional":C?b(B,"proto3_optional"):b(B,"optional");break;case"oneof":Pe(B,W);break;case"extensions":z(B.extensions||(B.extensions=[]));break;case"reserved":z(B.reserved||(B.reserved=[]),!0);break;default:if(!C||!sr.test(W))throw A(W);o(W),b(B,"optional");break}}),P.add(B)}function b(P,F,B){var J=s();if(J==="group"){V(P,F);return}for(;J.endsWith(".")||a().startsWith(".");)J+=s();if(!sr.test(J))throw A(J,"type");var W=s();if(!ir.test(W))throw A(W,"name");W=x(W),l("=");var ce=new IA(W,v(s()),J,F,B);if(w(ce,function(Zt){if(Zt==="option")Re(ce,Zt),l(";");else throw A(Zt)},function(){Tt(ce)}),F==="proto3_optional"){var Ue=new DA("_"+W);ce.setOption("proto3_optional",!0),Ue.add(ce),P.add(Ue)}else P.add(ce);!C&&ce.repeated&&(nv.packed[J]!==void 0||nv.basic[J]===void 0)&&ce.setOption("packed",!1,!0)}function V(P,F){var B=s();if(!ir.test(B))throw A(B,"name");var J=rv.lcFirst(B);B===J&&(B=rv.ucFirst(B)),l("=");var W=v(s()),ce=new CA(B);ce.group=!0;var Ue=new IA(J,W,B,F);Ue.filename=Ar.filename,w(ce,function(Zt){switch(Zt){case"option":Re(ce,Zt),l(";");break;case"required":case"repeated":b(ce,Zt);break;case"optional":C?b(ce,"proto3_optional"):b(ce,"optional");break;case"message":d(ce,Zt);break;case"enum":De(ce,Zt);break;default:throw A(Zt)}}),P.add(ce).add(Ue)}function ve(P){l("<");var F=s();if(nv.mapKey[F]===void 0)throw A(F,"type");l(",");var B=s();if(!sr.test(B))throw A(B,"type");l(">");var J=s();if(!ir.test(J))throw A(J,"name");l("=");var W=new bV(x(J),v(s()),F,B);w(W,function(Ue){if(Ue==="option")Re(W,Ue),l(";");else throw A(Ue)},function(){Tt(W)}),P.add(W)}function Pe(P,F){if(!ir.test(F=s()))throw A(F,"name");var B=new DA(x(F));w(B,function(W){W==="option"?(Re(B,W),l(";")):(o(W),b(B,"optional"))}),P.add(B)}function De(P,F){if(!ir.test(F=s()))throw A(F,"name");var B=new SV(F);w(B,function(W){switch(W){case"option":Re(B,W),l(";");break;case"reserved":z(B.reserved||(B.reserved=[]),!0);break;default:Ye(B,W)}}),P.add(B)}function Ye(P,F){if(!ir.test(F))throw A(F,"name");l("=");var B=v(s(),!0),J={options:void 0};J.setOption=function(W,ce){this.options===void 0&&(this.options={}),this.options[W]=ce},w(J,function(ce){if(ce==="option")Re(J,ce),l(";");else throw A(ce)},function(){Tt(J)}),P.add(F,B,J.comment,J.options)}function Re(P,F){var B=l("(",!0);if(!sr.test(F=s()))throw A(F,"name");var J=F,W=J,ce;B&&(l(")"),J="("+J+")",W=J,F=a(),xV.test(F)&&(ce=F.slice(1),J+=F,s())),l("=");var Ue=Pt(P,J);We(P,W,Ue,ce)}function Pt(P,F){if(l("{",!0)){for(var B={};!l("}",!0);){if(!ir.test(It=s()))throw A(It,"name");if(It===null)throw A(It,"end of input");var J,W=It;if(l(":",!0),a()==="{")J=Pt(P,F+"."+It);else if(a()==="["){J=[];var ce;if(l("[",!0)){do ce=O(!0),J.push(ce);while(l(",",!0));l("]"),typeof ce<"u"&&it(P,F+"."+It,ce)}}else J=O(!0),it(P,F+"."+It,J);var Ue=B[W];Ue&&(J=[].concat(Ue).concat(J)),B[W]=J,l(",",!0),l(";",!0)}return B}var Qr=O(!0);return it(P,F,Qr),Qr}function it(P,F,B){P.setOption&&P.setOption(F,B)}function We(P,F,B,J){P.setParsedOption&&P.setParsedOption(F,B,J)}function Tt(P){if(l("[",!0)){do Re(P,"option");while(l(",",!0));l("]")}return P}function st(P,F){if(!ir.test(F=s()))throw A(F,"service name");var B=new _V(F);w(B,function(W){if(!f(B,W))if(W==="rpc")Ft(B,W);else throw A(W)}),P.add(B)}function Ft(P,F){var B=c(),J=F;if(!ir.test(F=s()))throw A(F,"name");var W=F,ce,Ue,Qr,Zt;if(l("("),l("stream",!0)&&(Ue=!0),!sr.test(F=s())||(ce=F,l(")"),l("returns"),l("("),l("stream",!0)&&(Zt=!0),!sr.test(F=s())))throw A(F);Qr=F,l(")");var Qu=new TV(W,J,ce,Qr,Ue,Zt);Qu.comment=B,w(Qu,function(Pm){if(Pm==="option")Re(Qu,Pm),l(";");else throw A(Pm)}),P.add(Qu)}function uo(P,F){if(!sr.test(F=s()))throw A(F,"reference");var B=F;w(null,function(W){switch(W){case"required":case"repeated":b(P,W,B);break;case"optional":C?b(P,"proto3_optional",B):b(P,"optional",B);break;default:if(!C||!sr.test(W))throw A(W);o(W),b(P,"optional",B);break}})}for(var It;(It=s())!==null;)switch(It){case"package":if(!u)throw A(It);h();break;case"import":if(!u)throw A(It);p();break;case"syntax":if(!u)throw A(It);y();break;case"option":Re(E,It),l(";");break;default:if(f(E,It)){u=!1;continue}throw A(It)}return Ar.filename=null,{package:m,imports:g,weakImports:S,syntax:T,root:e}}});var kA=R((iee,xA)=>{"use strict";xA.exports=Mn;var kV=/\/|\./;function Mn(n,e){kV.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Mn[n]=e}Mn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var NA;Mn("duration",{Duration:NA={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Mn("timestamp",{Timestamp:NA});Mn("empty",{Empty:{fields:{}}});Mn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Mn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Mn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Mn.get=function(e){return Mn[e]||null}});var MA=R((see,OA)=>{"use strict";var yi=OA.exports=bA();yi.build="full";yi.tokenize=tv();yi.parse=RA();yi.common=kA();yi.Root._configure(yi.Type,yi.parse,yi.common)});var th=R((oee,PA)=>{"use strict";PA.exports=MA()});var iv=R((aee,OV)=>{OV.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var UA=R((ue,VA)=>{"use strict";var Vt=th();VA.exports=ue=Vt.descriptor=Vt.Root.fromJSON(iv()).lookup(".google.protobuf");var FA=Vt.Namespace,sc=Vt.Root,Rr=Vt.Enum,vi=Vt.Type,wi=Vt.Field,MV=Vt.MapField,nh=Vt.OneOf,oc=Vt.Service,rh=Vt.Method;sc.fromDescriptor=function(e){typeof e.length=="number"&&(e=ue.FileDescriptorSet.decode(e));var t=new sc;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(vi.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Rr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(wi.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(oc.fromDescriptor(r.service[o]));var a=qo(r.options,ue.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};sc.prototype.toDescriptor=function(e){var t=ue.FileDescriptorSet.create();return LA(this,t.file,e),t};function LA(n,e,t){var r=ue.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof sc||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof vi?r.messageType.push(s.toDescriptor(t)):s instanceof Rr?r.enumType.push(s.toDescriptor()):s instanceof wi?r.extension.push(s.toDescriptor(t)):s instanceof oc?r.service.push(s.toDescriptor()):s instanceof FA&&LA(s,e,t);r.options=zo(n.options,ue.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var PV=0;vi.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=ue.DescriptorProto.decode(e));var r=new vi(e.name.length?e.name:"Type"+PV++,qo(e.options,ue.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(nh.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=wi.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(wi.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(vi.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Rr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};vi.prototype.toDescriptor=function(e){var t=ue.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof MV){var s=sv(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=sv(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&BA(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(ue.DescriptorProto.create({name:i.typeName,field:[ue.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),ue.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:ue.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof wi?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof vi?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Rr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(ue.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(ue.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=zo(this.options,ue.MessageOptions),t};var FV=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;wi.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=ue.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=qV(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new wi(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=qo(e.options,ue.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=FV.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return zV(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};wi.prototype.toDescriptor=function(e){var t=ue.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Vt.util.ucFirst(this.name),t.label=3;else{switch(t.type=sv(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?BA(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=zo(this.options,ue.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=ue.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=ue.FieldOptions.create())).packed=!0),t};var LV=0;Rr.fromDescriptor=function(e){typeof e.length=="number"&&(e=ue.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Rr(e.name&&e.name.length?e.name:"Enum"+LV++,t,qo(e.options,ue.EnumOptions))};Rr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(ue.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return ue.EnumDescriptorProto.create({name:this.name,value:e,options:zo(this.options,ue.EnumOptions)})};var BV=0;nh.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ue.OneofDescriptorProto.decode(e)),new nh(e.name&&e.name.length?e.name:"oneof"+BV++)};nh.prototype.toDescriptor=function(){return ue.OneofDescriptorProto.create({name:this.name})};var VV=0;oc.fromDescriptor=function(e){typeof e.length=="number"&&(e=ue.ServiceDescriptorProto.decode(e));var t=new oc(e.name&&e.name.length?e.name:"Service"+VV++,qo(e.options,ue.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(rh.fromDescriptor(e.method[r]));return t};oc.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return ue.ServiceDescriptorProto.create({name:this.name,method:e,options:zo(this.options,ue.ServiceOptions)})};var UV=0;rh.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ue.MethodDescriptorProto.decode(e)),new rh(e.name&&e.name.length?e.name:"Method"+UV++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,qo(e.options,ue.MethodOptions))};rh.prototype.toDescriptor=function(){return ue.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:zo(this.options,ue.MethodOptions)})};function qV(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function zV(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function sv(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Rr)return 14;if(e instanceof vi)return e.group?10:11;throw Error("illegal type: "+n)}function qo(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Rr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(GV(s),o));return t.length?Vt.util.toObject(t):void 0}}function zo(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Vt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Vt.util.toObject(t)):void 0}}function BA(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof sc)&&e instanceof FA)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function GV(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var qA=R((lee,jV)=>{jV.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var zA=R((cee,KV)=>{KV.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var GA=R((uee,$V)=>{$V.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var WA=R(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.addCommonProtos=bi.loadProtosWithOptionsSync=bi.loadProtosWithOptions=void 0;var jA=Ee("fs"),KA=Ee("path"),Go=th();function $A(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(KA.isAbsolute(i))return i;for(let s of e){let o=KA.join(s,i);try{return jA.accessSync(o,jA.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function WV(n,e){return _(this,null,function*(){let t=new Go.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));$A(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}bi.loadProtosWithOptions=WV;function HV(n,e){let t=new Go.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");$A(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}bi.loadProtosWithOptionsSync=HV;function QV(){let n=qA(),e=iv(),t=zA(),r=GA();Go.common("api",n.nested.google.nested.protobuf.nested),Go.common("descriptor",e.nested.google.nested.protobuf.nested),Go.common("source_context",t.nested.google.nested.protobuf.nested),Go.common("type",r.nested.google.nested.protobuf.nested)}bi.addCommonProtos=QV});var YA=R((QA,ov)=>{"use strict";var HA=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(d,b,V){this.low=d|0,this.high=b|0,this.unsigned=!!V}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(d){return(d&&d.__isLong__)===!0}function i(d){var b=Math.clz32(d&-d);return d?31-b:b}t.isLong=r;var s={},o={};function a(d,b){var V,ve,Pe;return b?(d>>>=0,(Pe=0<=d&&d<256)&&(ve=o[d],ve)?ve:(V=c(d,0,!0),Pe&&(o[d]=V),V)):(d|=0,(Pe=-128<=d&&d<128)&&(ve=s[d],ve)?ve:(V=c(d,d<0?-1:0,!1),Pe&&(s[d]=V),V))}t.fromInt=a;function l(d,b){if(isNaN(d))return b?O:k;if(b){if(d<0)return O;if(d>=E)return p}else{if(d<=-x)return y;if(d+1>=x)return h}return d<0?l(-d,b).neg():c(d%C|0,d/C|0,b)}t.fromNumber=l;function c(d,b,V){return new t(d,b,V)}t.fromBits=c;var u=Math.pow;function m(d,b,V){if(d.length===0)throw Error("empty string");if(typeof b=="number"?(V=b,b=!1):b=!!b,d==="NaN"||d==="Infinity"||d==="+Infinity"||d==="-Infinity")return b?O:k;if(V=V||10,V<2||36<V)throw RangeError("radix");var ve;if((ve=d.indexOf("-"))>0)throw Error("interior hyphen");if(ve===0)return m(d.substring(1),b,V).neg();for(var Pe=l(u(V,8)),De=k,Ye=0;Ye<d.length;Ye+=8){var Re=Math.min(8,d.length-Ye),Pt=parseInt(d.substring(Ye,Ye+Re),V);if(Re<8){var it=l(u(V,Re));De=De.mul(it).add(l(Pt))}else De=De.mul(Pe),De=De.add(l(Pt))}return De.unsigned=b,De}t.fromString=m;function g(d,b){return typeof d=="number"?l(d,b):typeof d=="string"?m(d,b):c(d.low,d.high,typeof b=="boolean"?b:d.unsigned)}t.fromValue=g;var S=65536,T=1<<24,C=S*S,E=C*C,x=E/2,A=a(T),k=a(0);t.ZERO=k;var O=a(0,!0);t.UZERO=O;var z=a(1);t.ONE=z;var Q=a(1,!0);t.UONE=Q;var v=a(-1);t.NEG_ONE=v;var h=c(-1,2147483647,!1);t.MAX_VALUE=h;var p=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=p;var y=c(0,-2147483648,!1);t.MIN_VALUE=y;var f=t.prototype;f.toInt=function(){return this.unsigned?this.low>>>0:this.low},f.toNumber=function(){return this.unsigned?(this.high>>>0)*C+(this.low>>>0):this.high*C+(this.low>>>0)},f.toString=function(b){if(b=b||10,b<2||36<b)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(y)){var V=l(b),ve=this.div(V),Pe=ve.mul(V).sub(this);return ve.toString(b)+Pe.toInt().toString(b)}else return"-"+this.neg().toString(b);for(var De=l(u(b,6),this.unsigned),Ye=this,Re="";;){var Pt=Ye.div(De),it=Ye.sub(Pt.mul(De)).toInt()>>>0,We=it.toString(b);if(Ye=Pt,Ye.isZero())return We+Re;for(;We.length<6;)We="0"+We;Re=""+We+Re}},f.getHighBits=function(){return this.high},f.getHighBitsUnsigned=function(){return this.high>>>0},f.getLowBits=function(){return this.low},f.getLowBitsUnsigned=function(){return this.low>>>0},f.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var b=this.high!=0?this.high:this.low,V=31;V>0&&!(b&1<<V);V--);return this.high!=0?V+33:V+1},f.isZero=function(){return this.high===0&&this.low===0},f.eqz=f.isZero,f.isNegative=function(){return!this.unsigned&&this.high<0},f.isPositive=function(){return this.unsigned||this.high>=0},f.isOdd=function(){return(this.low&1)===1},f.isEven=function(){return(this.low&1)===0},f.equals=function(b){return r(b)||(b=g(b)),this.unsigned!==b.unsigned&&this.high>>>31===1&&b.high>>>31===1?!1:this.high===b.high&&this.low===b.low},f.eq=f.equals,f.notEquals=function(b){return!this.eq(b)},f.neq=f.notEquals,f.ne=f.notEquals,f.lessThan=function(b){return this.comp(b)<0},f.lt=f.lessThan,f.lessThanOrEqual=function(b){return this.comp(b)<=0},f.lte=f.lessThanOrEqual,f.le=f.lessThanOrEqual,f.greaterThan=function(b){return this.comp(b)>0},f.gt=f.greaterThan,f.greaterThanOrEqual=function(b){return this.comp(b)>=0},f.gte=f.greaterThanOrEqual,f.ge=f.greaterThanOrEqual,f.compare=function(b){if(r(b)||(b=g(b)),this.eq(b))return 0;var V=this.isNegative(),ve=b.isNegative();return V&&!ve?-1:!V&&ve?1:this.unsigned?b.high>>>0>this.high>>>0||b.high===this.high&&b.low>>>0>this.low>>>0?-1:1:this.sub(b).isNegative()?-1:1},f.comp=f.compare,f.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(z)},f.neg=f.negate,f.add=function(b){r(b)||(b=g(b));var V=this.high>>>16,ve=this.high&65535,Pe=this.low>>>16,De=this.low&65535,Ye=b.high>>>16,Re=b.high&65535,Pt=b.low>>>16,it=b.low&65535,We=0,Tt=0,st=0,Ft=0;return Ft+=De+it,st+=Ft>>>16,Ft&=65535,st+=Pe+Pt,Tt+=st>>>16,st&=65535,Tt+=ve+Re,We+=Tt>>>16,Tt&=65535,We+=V+Ye,We&=65535,c(st<<16|Ft,We<<16|Tt,this.unsigned)},f.subtract=function(b){return r(b)||(b=g(b)),this.add(b.neg())},f.sub=f.subtract,f.multiply=function(b){if(this.isZero())return this;if(r(b)||(b=g(b)),e){var V=e.mul(this.low,this.high,b.low,b.high);return c(V,e.get_high(),this.unsigned)}if(b.isZero())return this.unsigned?O:k;if(this.eq(y))return b.isOdd()?y:k;if(b.eq(y))return this.isOdd()?y:k;if(this.isNegative())return b.isNegative()?this.neg().mul(b.neg()):this.neg().mul(b).neg();if(b.isNegative())return this.mul(b.neg()).neg();if(this.lt(A)&&b.lt(A))return l(this.toNumber()*b.toNumber(),this.unsigned);var ve=this.high>>>16,Pe=this.high&65535,De=this.low>>>16,Ye=this.low&65535,Re=b.high>>>16,Pt=b.high&65535,it=b.low>>>16,We=b.low&65535,Tt=0,st=0,Ft=0,uo=0;return uo+=Ye*We,Ft+=uo>>>16,uo&=65535,Ft+=De*We,st+=Ft>>>16,Ft&=65535,Ft+=Ye*it,st+=Ft>>>16,Ft&=65535,st+=Pe*We,Tt+=st>>>16,st&=65535,st+=De*it,Tt+=st>>>16,st&=65535,st+=Ye*Pt,Tt+=st>>>16,st&=65535,Tt+=ve*We+Pe*it+De*Pt+Ye*Re,Tt&=65535,c(Ft<<16|uo,Tt<<16|st,this.unsigned)},f.mul=f.multiply,f.divide=function(b){if(r(b)||(b=g(b)),b.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&b.low===-1&&b.high===-1)return this;var V=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,b.low,b.high);return c(V,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?O:k;var ve,Pe,De;if(this.unsigned){if(b.unsigned||(b=b.toUnsigned()),b.gt(this))return O;if(b.gt(this.shru(1)))return Q;De=O}else{if(this.eq(y)){if(b.eq(z)||b.eq(v))return y;if(b.eq(y))return z;var Ye=this.shr(1);return ve=Ye.div(b).shl(1),ve.eq(k)?b.isNegative()?z:v:(Pe=this.sub(b.mul(ve)),De=ve.add(Pe.div(b)),De)}else if(b.eq(y))return this.unsigned?O:k;if(this.isNegative())return b.isNegative()?this.neg().div(b.neg()):this.neg().div(b).neg();if(b.isNegative())return this.div(b.neg()).neg();De=k}for(Pe=this;Pe.gte(b);){ve=Math.max(1,Math.floor(Pe.toNumber()/b.toNumber()));for(var Re=Math.ceil(Math.log(ve)/Math.LN2),Pt=Re<=48?1:u(2,Re-48),it=l(ve),We=it.mul(b);We.isNegative()||We.gt(Pe);)ve-=Pt,it=l(ve,this.unsigned),We=it.mul(b);it.isZero()&&(it=z),De=De.add(it),Pe=Pe.sub(We)}return De},f.div=f.divide,f.modulo=function(b){if(r(b)||(b=g(b)),e){var V=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,b.low,b.high);return c(V,e.get_high(),this.unsigned)}return this.sub(this.div(b).mul(b))},f.mod=f.modulo,f.rem=f.modulo,f.not=function(){return c(~this.low,~this.high,this.unsigned)},f.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},f.clz=f.countLeadingZeros,f.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},f.ctz=f.countTrailingZeros,f.and=function(b){return r(b)||(b=g(b)),c(this.low&b.low,this.high&b.high,this.unsigned)},f.or=function(b){return r(b)||(b=g(b)),c(this.low|b.low,this.high|b.high,this.unsigned)},f.xor=function(b){return r(b)||(b=g(b)),c(this.low^b.low,this.high^b.high,this.unsigned)},f.shiftLeft=function(b){return r(b)&&(b=b.toInt()),(b&=63)===0?this:b<32?c(this.low<<b,this.high<<b|this.low>>>32-b,this.unsigned):c(0,this.low<<b-32,this.unsigned)},f.shl=f.shiftLeft,f.shiftRight=function(b){return r(b)&&(b=b.toInt()),(b&=63)===0?this:b<32?c(this.low>>>b|this.high<<32-b,this.high>>b,this.unsigned):c(this.high>>b-32,this.high>=0?0:-1,this.unsigned)},f.shr=f.shiftRight,f.shiftRightUnsigned=function(b){return r(b)&&(b=b.toInt()),(b&=63)===0?this:b<32?c(this.low>>>b|this.high<<32-b,this.high>>>b,this.unsigned):b===32?c(this.high,0,this.unsigned):c(this.high>>>b-32,0,this.unsigned)},f.shru=f.shiftRightUnsigned,f.shr_u=f.shiftRightUnsigned,f.rotateLeft=function(b){var V;return r(b)&&(b=b.toInt()),(b&=63)===0?this:b===32?c(this.high,this.low,this.unsigned):b<32?(V=32-b,c(this.low<<b|this.high>>>V,this.high<<b|this.low>>>V,this.unsigned)):(b-=32,V=32-b,c(this.high<<b|this.low>>>V,this.low<<b|this.high>>>V,this.unsigned))},f.rotl=f.rotateLeft,f.rotateRight=function(b){var V;return r(b)&&(b=b.toInt()),(b&=63)===0?this:b===32?c(this.high,this.low,this.unsigned):b<32?(V=32-b,c(this.high<<V|this.low>>>b,this.low<<V|this.high>>>b,this.unsigned)):(b-=32,V=32-b,c(this.low<<V|this.high>>>b,this.high<<V|this.low>>>b,this.unsigned))},f.rotr=f.rotateRight,f.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},f.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},f.toBytes=function(b){return b?this.toBytesLE():this.toBytesBE()},f.toBytesLE=function(){var b=this.high,V=this.low;return[V&255,V>>>8&255,V>>>16&255,V>>>24,b&255,b>>>8&255,b>>>16&255,b>>>24]},f.toBytesBE=function(){var b=this.high,V=this.low;return[b>>>24,b>>>16&255,b>>>8&255,b&255,V>>>24,V>>>16&255,V>>>8&255,V&255]},t.fromBytes=function(b,V,ve){return ve?t.fromBytesLE(b,V):t.fromBytesBE(b,V)},t.fromBytesLE=function(b,V){return new t(b[0]|b[1]<<8|b[2]<<16|b[3]<<24,b[4]|b[5]<<8|b[6]<<16|b[7]<<24,V)},t.fromBytesBE=function(b,V){return new t(b[4]<<24|b[5]<<16|b[6]<<8|b[7],b[0]<<24|b[1]<<16|b[2]<<8|b[3],V)};var w=t;return n.default=w,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return HA}):typeof ov=="object"&&typeof QA=="object"&&(ov.exports=HA)});var sh=R(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.loadFileDescriptorSetFromObject=ft.loadFileDescriptorSetFromBuffer=ft.fromJSON=ft.loadSync=ft.load=ft.IdempotencyLevel=ft.isAnyExtension=ft.Long=void 0;var YV=LI(),or=th(),lv=UA(),cv=WA(),XV=YA();ft.Long=XV;function JV(n){return"@type"in n&&typeof n["@type"]=="string"}ft.isAnyExtension=JV;var ZA;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(ZA=ft.IdempotencyLevel||(ft.IdempotencyLevel={}));var eR={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function ZV(n,e){return n===""?e:n+"."+e}function eU(n){return n instanceof or.Service||n instanceof or.Type||n instanceof or.Enum}function tU(n){return n instanceof or.Namespace||n instanceof or.Root}function tR(n,e){let t=ZV(e,n.name);return eU(n)?[[t,n]]:tU(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>tR(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function XA(n,e){return function(r){return n.toObject(n.decode(r),e)}}function JA(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function nU(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:ZA.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function rU(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:JA(i),requestDeserialize:XA(i,t),responseSerialize:JA(s),responseDeserialize:XA(s,t),originalName:YV(n.name),requestType:av(i,r),responseType:av(s,r),options:nU(n.parsedOptions)}}function iU(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=rU(s,e,t,r);return i}function av(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,eR),fileDescriptorProtos:e}}function sU(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,eR),fileDescriptorProtos:e}}function oU(n,e,t,r){if(n instanceof or.Service)return iU(n,e,t,r);if(n instanceof or.Type)return av(n,r);if(n instanceof or.Enum)return sU(n,r);throw new Error("Type mismatch in reflection object handling")}function ih(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(lv.FileDescriptorProto.encode(s).finish()));for(let[s,o]of tR(n,""))t[s]=oU(o,s,e,i);return t}function nR(n,e){e=e||{};let t=or.Root.fromDescriptor(n);return t.resolveAll(),ih(t,e)}function aU(n,e){return(0,cv.loadProtosWithOptions)(n,e).then(t=>ih(t,e))}ft.load=aU;function lU(n,e){let t=(0,cv.loadProtosWithOptionsSync)(n,e);return ih(t,e)}ft.loadSync=lU;function cU(n,e){e=e||{};let t=or.Root.fromJSON(n);return t.resolveAll(),ih(t,e)}ft.fromJSON=cU;function uU(n,e){let t=lv.FileDescriptorSet.decode(n);return nR(t,e)}ft.loadFileDescriptorSetFromBuffer=uU;function dU(n,e){let t=lv.FileDescriptorSet.fromObject(n);return nR(t,e)}ft.loadFileDescriptorSetFromObject=dU;(0,cv.addCommonProtos)()});var bs=R(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.setup=Le.getChannelzServiceDefinition=Le.getChannelzHandlers=Le.unregisterChannelzRef=Le.registerChannelzSocket=Le.registerChannelzServer=Le.registerChannelzSubchannel=Le.registerChannelzChannel=Le.ChannelzCallTracker=Le.ChannelzChildrenTracker=Le.ChannelzTrace=void 0;var rR=Ee("net"),ac=cn(),cc=Te(),hU=Xn(),fU=Cd(),pU=ay();function uv(n){return{channel_id:n.id,name:n.name}}function pv(n){return{subchannel_id:n.id,name:n.name}}function mU(n){return{server_id:n.id}}function ah(n){return{socket_id:n.id,name:n.name}}var iR=32,dv=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=iR*2&&(this.events=this.events.slice(iR)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Nr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Nr(e.timestamp),channel_ref:e.childChannel?uv(e.childChannel):null,subchannel_ref:e.childSubchannel?pv(e.childSubchannel):null}))}}};Le.ChannelzTrace=dv;var hv=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Le.ChannelzChildrenTracker=hv;var fv=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Le.ChannelzCallTracker=fv;var gU=1;function lh(){return gU++}var lc=[],mv=[],Si=[],gv=[];function yU(n,e,t){let r=lh(),i={id:r,name:n,kind:"channel"};return t&&(lc[r]={ref:i,getInfo:e}),i}Le.registerChannelzChannel=yU;function vU(n,e,t){let r=lh(),i={id:r,name:n,kind:"subchannel"};return t&&(mv[r]={ref:i,getInfo:e}),i}Le.registerChannelzSubchannel=vU;function wU(n,e){let t=lh(),r={id:t,kind:"server"};return e&&(Si[t]={ref:r,getInfo:n}),r}Le.registerChannelzServer=wU;function bU(n,e,t){let r=lh(),i={id:r,name:n,kind:"socket"};return t&&(gv[r]={ref:i,getInfo:e}),i}Le.registerChannelzSocket=bU;function SU(n){switch(n.kind){case"channel":delete lc[n.id];return;case"subchannel":delete mv[n.id];return;case"server":delete Si[n.id];return;case"socket":delete gv[n.id];return}}Le.unregisterChannelzRef=SU;function _U(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function sR(n){if(n==="")return[];let e=n.split(":").map(r=>_U(r));return[].concat(...e)}function TU(n){if((0,rR.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,rR.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(sR(e)),s=Buffer.from(sR(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function aR(n){switch(n){case ac.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case ac.ConnectivityState.IDLE:return{state:"IDLE"};case ac.ConnectivityState.READY:return{state:"READY"};case ac.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case ac.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Nr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function lR(n){let e=n.getInfo();return{ref:uv(n.ref),data:{target:e.target,state:aR(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Nr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>uv(t)),subchannel_ref:e.children.subchannels.map(t=>pv(t))}}function EU(n,e){let t=Number.parseInt(n.request.channel_id),r=lc[t];if(r===void 0){e({code:cc.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:lR(r)})}function CU(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<lc.length;i++){let s=lc[i];if(s!==void 0&&(r.push(lR(s)),r.length>=t))break}e(null,{channel:r,end:i>=Si.length})}function cR(n){let e=n.getInfo();return{ref:mU(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Nr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ah(t))}}function IU(n,e){let t=Number.parseInt(n.request.server_id),r=Si[t];if(r===void 0){e({code:cc.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:cR(r)})}function DU(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Si.length;i++){let s=Si[i];if(s!==void 0&&(r.push(cR(s)),r.length>=t))break}e(null,{server:r,end:i>=Si.length})}function AU(n,e){let t=Number.parseInt(n.request.subchannel_id),r=mv[t];if(r===void 0){e({code:cc.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:pv(r.ref),data:{target:i.target,state:aR(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Nr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>ah(o))};e(null,{subchannel:s})}function oR(n){var e;return(0,hU.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=TU(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function RU(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=gv[a];if(l===void 0){e({code:cc.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,m={ref:ah(l.ref),local:c.localAddress?oR(c.localAddress):null,remote:c.remoteAddress?oR(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Nr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Nr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Nr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Nr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:m})}function NU(n,e){let t=Number.parseInt(n.request.server_id),r=Si[t];if(r===void 0){e({code:cc.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,m)=>u.id-m.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(ah(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function uR(){return{GetChannel:EU,GetTopChannels:CU,GetServer:IU,GetServers:DU,GetSubchannel:AU,GetSocket:RU,GetServerSockets:NU}}Le.getChannelzHandlers=uR;var oh=null;function dR(){if(oh)return oh;let n=sh().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return oh=(0,pU.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,oh}Le.getChannelzServiceDefinition=dR;function xU(){(0,fU.registerAdminService)(dR,uR)}Le.setup=xU});var hR=R(uh=>{"use strict";Object.defineProperty(uh,"__esModule",{value:!0});uh.Subchannel=void 0;var xe=cn(),kU=zl(),yv=He(),ch=Te(),OU=en(),MU=Xn(),jo=bs(),PU="subchannel",FU=~(1<<31),vv=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=xe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new jo.ChannelzCallTracker,this.childrenTracker=new jo.ChannelzChildrenTracker,this.streamTracker=new jo.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new kU.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,MU.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new jo.ChannelzTrace,this.channelzRef=(0,jo.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){yv.trace(ch.LogVerbosity.DEBUG,PU,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){yv.trace(ch.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING):this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,FU);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([xe.ConnectivityState.READY],xe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,yv.log(ch.LogVerbosity.ERROR,`Connection to ${(0,OU.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(xe.ConnectivityState[this.connectivityState]+" -> "+xe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+xe.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case xe.ConnectivityState.READY:this.stopBackoff();break;case xe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case xe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case xe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,jo.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.CONNECTING,xe.ConnectivityState.READY],xe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===ch.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.IDLE],xe.ConnectivityState.CONNECTING)||this.connectivityState===xe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};uh.Subchannel=vv});var _v=R(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.setup=Ei.DEFAULT_PORT=void 0;var fR=Qn(),mR=Ee("dns"),gR=Ee("util"),LU=Mg(),wv=Te(),bv=Ht(),BU=He(),VU=Te(),_i=en(),pR=Ee("net"),UU=zl(),qU="dns_resolver";function Ti(n){BU.trace(VU.LogVerbosity.DEBUG,qU,n)}Ei.DEFAULT_PORT=443;var zU=3e4,GU=gR.promisify(mR.resolveTxt),jU=gR.promisify(mR.lookup);function KU(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Sv=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Ti("Resolver constructed for target "+(0,_i.uriToString)(e));let a=(0,_i.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,pR.isIPv4)(a.host)||(0,pR.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Ei.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Ei.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:wv.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,_i.uriToString)(this.target)}`,metadata:new bv.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new UU.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:zU,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Ti("Returning IP address for target "+(0,_i.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Ti("Failed to parse DNS address "+(0,_i.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:wv.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,_i.uriToString)(this.target)}`,metadata:new bv.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Ti("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=jU(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=KU(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(Ti("Resolved addresses for target "+(0,_i.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Ti("Resolution error for target "+(0,_i.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=GU(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,LU.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:wv.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new bv.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Ti('resolution update delayed by "min time between resolutions" rate limit'):Ti("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function $U(){(0,fR.registerResolver)("dns",Sv),(0,fR.registerDefaultScheme)("dns")}Ei.setup=$U});var Tv=R(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.getProxiedConnection=Wo.mapProxyName=void 0;var uc=He(),Ko=Te(),WU=Qn(),HU=Ee("http"),QU=Ee("tls"),YU=He(),yR=Xn(),$o=en(),XU=Ee("url"),JU=_v(),ZU="proxy";function Ci(n){YU.trace(Ko.LogVerbosity.DEBUG,ZU,n)}function eq(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new XU.URL(n)}catch{return(0,uc.log)(Ko.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,uc.log)(Ko.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,uc.log)(Ko.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Ci("Proxy server "+o.address+" set by environment variable "+e),o}function tq(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Ci("No proxy server list set by environment variable "+e),n.split(",")):[]}function nq(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=eq();if(!i.address)return r;let s=(0,$o.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of tq())if(l===o)return Ci("Not using proxy for target in no_proxy list: "+(0,$o.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,$o.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Wo.mapProxyName=nq;function rq(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,$o.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,$o.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:JU.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,yR.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,yR.subchannelAddressToString)(n);return Ci("Using proxy "+u+" to connect to "+l.path),new Promise((m,g)=>{let S=HU.request(l);S.once("connect",(T,C,E)=>{var x;if(S.removeAllListeners(),C.removeAllListeners(),T.statusCode===200)if(Ci("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let A=(0,WU.getDefaultAuthority)(s),k=(0,$o.splitHostPort)(A),O=(x=k?.host)!==null&&x!==void 0?x:A,z=QU.connect(Object.assign({host:O,servername:O,socket:C},t),()=>{Ci("Successfully established a TLS connection to "+l.path+" through proxy "+u),m({socket:z,realTarget:s})});z.on("error",Q=>{Ci("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+Q.message),g()})}else Ci("Successfully established a plaintext connection to "+l.path+" through proxy "+u),m({socket:C,realTarget:s});else(0,uc.log)(Ko.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+T.statusCode),g()}),S.once("error",T=>{S.removeAllListeners(),(0,uc.log)(Ko.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+T.message),g()}),S.end()})}Wo.getProxiedConnection=rq});var Cv=R(dh=>{"use strict";Object.defineProperty(dh,"__esModule",{value:!0});dh.StreamDecoder=void 0;var xr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(xr||{}),Ev=class{constructor(e){this.maxReadMessageLength=e,this.readState=xr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case xr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=xr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case xr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=xr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=xr.NO_DATA,i.push(s)}}break;case xr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=xr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};dh.StreamDecoder=Ev});var vR=R(hh=>{"use strict";Object.defineProperty(hh,"__esModule",{value:!0});hh.Http2SubchannelCall=void 0;var kr=Ee("http2"),iq=Ee("os"),Ce=Te(),Ii=Ht(),sq=Cv(),oq=He(),aq=Te(),lq="subchannel_call";function cq(n){for(let[e,t]of Object.entries(iq.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Iv=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Ce.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:Ce.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new sq.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let m of Object.keys(l))u+="		"+m+": "+l[m]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=Ce.Status.INTERNAL;break;case 401:this.mappedStatusCode=Ce.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Ce.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Ce.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Ce.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Ce.Status.UNKNOWN}if(c&kr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let m;try{m=Ii.Metadata.fromHttp2Headers(l)}catch(g){this.endCall({code:Ce.Status.UNKNOWN,details:g.message,metadata:new Ii.Metadata});return}this.listener.onReceiveMetadata(m)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(Ce.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===Ce.Status.OK)return;let c,u="";switch(e.rstCode){case kr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=Ce.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case kr.constants.NGHTTP2_REFUSED_STREAM:c=Ce.Status.UNAVAILABLE,u="Stream refused by server";break;case kr.constants.NGHTTP2_CANCEL:c=Ce.Status.CANCELLED,u="Call cancelled";break;case kr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=Ce.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case kr.constants.NGHTTP2_INADEQUATE_SECURITY:c=Ce.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case kr.constants.NGHTTP2_INTERNAL_ERROR:c=Ce.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=Ce.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=Ce.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Ii.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+cq(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Ce.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Ii.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){oq.trace(aq.LogVerbosity.DEBUG,lq,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Ce.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Ce.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Ii.Metadata.fromHttp2Headers(e)}catch{r=new Ii.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===Ce.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in Ce.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Ce.Status.OK?t=kr.constants.NGHTTP2_NO_ERROR:t=kr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Ii.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Ce.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=Ce.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Ce.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:Ce.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Ii.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};hh.Http2SubchannelCall=Iv});var Dv=R(fh=>{"use strict";Object.defineProperty(fh,"__esModule",{value:!0});fh.getNextCallNumber=void 0;var uq=0;function dq(){return uq++}fh.getNextCallNumber=dq});var SR=R(mh=>{"use strict";Object.defineProperty(mh,"__esModule",{value:!0});mh.Http2SubchannelConnector=void 0;var kv=Ee("http2"),wR=Ee("tls"),Av=bs(),dc=Te(),hq=Tv(),Qo=He(),bR=Qn(),ph=Xn(),Ho=en(),fq=Ee("net"),pq=vR(),mq=Dv(),Rv="transport",gq="transport_flowctrl",yq=gg().version,{HTTP2_HEADER_AUTHORITY:vq,HTTP2_HEADER_CONTENT_TYPE:wq,HTTP2_HEADER_METHOD:bq,HTTP2_HEADER_PATH:Sq,HTTP2_HEADER_TE:_q,HTTP2_HEADER_USER_AGENT:Tq}=kv.constants,Eq=2e4,Cq=Buffer.from("too_many_pings","ascii"),Nv=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=Eq,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Av.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,ph.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Av.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${yq}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===kv.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(Cq)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Qo.isTracerEnabled(Rv)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,ph.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,ph.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),m=c.getCertificate(),g=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Qo.trace(dc.LogVerbosity.DEBUG,Rv,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Qo.trace(dc.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Qo.trace(dc.LogVerbosity.DEBUG,gq,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Qo.trace(dc.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[vq]=t,o[Tq]=this.userAgent,o[wq]="application/grpc",o[bq]="POST",o[Sq]=r,o[_q]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var m;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(m=s.onStreamEnd)===null||m===void 0||m.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var m;(m=s.onStreamEnd)===null||m===void 0||m.call(s,u)}},c=new pq.Http2SubchannelCall(a,l,i,this,(0,mq.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,Av.unregisterChannelzRef)(this.channelzRef)}},xv=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Qo.trace(dc.LogVerbosity.DEBUG,Rv,(0,Ho.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Ho.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Ho.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,ph.subchannelAddressToString)(e)));let m=(0,bR.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),g=t._getConnectionOptions()||{};g.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?g.maxSessionMemory=r["grpc-node.max_session_memory"]:g.maxSessionMemory=Number.MAX_SAFE_INTEGER;let S="http://";if("secureContext"in g){if(S="https://",r["grpc.ssl_target_name_override"]){let E=r["grpc.ssl_target_name_override"];g.checkServerIdentity=(x,A)=>(0,wR.checkServerIdentity)(E,A),g.servername=E}else{let E=(c=(l=(0,Ho.splitHostPort)(m))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";g.servername=E}i.socket&&(g.createConnection=(E,x)=>i.socket)}else g.createConnection=(E,x)=>i.socket?i.socket:fq.connect(e);g=Object.assign(Object.assign(Object.assign({},g),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let T=kv.connect(S+m,g);this.session=T;let C="Failed to connect";T.unref(),T.once("connect",()=>{T.removeAllListeners(),s(new Nv(T,e,r,u)),this.session=null}),T.once("close",()=>{this.session=null,setImmediate(()=>{o(`${C} (${new Date().toISOString()})`)})}),T.once("error",E=>{C=E.message,this.trace("connection failed with error "+C)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,wR.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,bR.getDefaultAuthority)((i=(0,Ho.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Ho.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,hq.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};mh.Http2SubchannelConnector=xv});var _R=R(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.getSubchannelPool=Yo.SubchannelPool=void 0;var Iq=sI(),Dq=hR(),Aq=Xn(),Rq=en(),Nq=SR(),xq=1e4,hc=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},xq),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,Rq.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,Aq.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,Iq.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new Dq.Subchannel(e,t,r,i,new Nq.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Yo.SubchannelPool=hc;var kq=new hc;function Oq(n){return n?kq:new hc}Yo.getSubchannelPool=Oq});var Mv=R(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.FilterStackFactory=Xo.FilterStack=void 0;var gh=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Xo.FilterStack=gh;var Ov=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new gh(this.factories.map(e=>e.createFilter()))}};Xo.FilterStackFactory=Ov});var Pv=R(yh=>{"use strict";Object.defineProperty(yh,"__esModule",{value:!0});yh.CompressionAlgorithms=void 0;var TR=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(TR||(yh.CompressionAlgorithms=TR={}))});var Lv=R(vh=>{"use strict";Object.defineProperty(vh,"__esModule",{value:!0});vh.BaseFilter=void 0;var Fv=class{sendMetadata(e){return _(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return _(this,null,function*(){return e})}receiveMessage(e){return _(this,null,function*(){return e})}receiveTrailers(e){return e}};vh.BaseFilter=Fv});var IR=R(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.CompressionFilterFactory=Zo.CompressionFilter=void 0;var wh=Ee("zlib"),CR=Pv(),bh=Te(),Mq=Lv(),Pq=He(),Fq=n=>typeof n=="number"&&typeof CR.CompressionAlgorithms[n]=="string",Jo=class{writeMessage(e,t){return _(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return _(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Ss=class extends Jo{compressMessage(e){return _(this,null,function*(){return e})}writeMessage(e,t){return _(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Bv=class extends Jo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{wh.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=wh.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:bh.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Vv=class extends Jo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{wh.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=wh.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:bh.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Uv=class extends Jo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function ER(n,e){switch(n){case"identity":return new Ss;case"deflate":return new Bv(e);case"gzip":return new Vv(e);default:return new Uv(n)}}var Sh=class extends Mq.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new Ss,this.receiveCompression=new Ss,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:bh.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(Fq(s)){let o=CR.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=ER(this.currentCompressionAlgorithm,-1))}else Pq.log(bh.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return _(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=ER(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Ss,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return _(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Ss?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return _(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Zo.CompressionFilter=Sh;var qv=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Sh(this.options,this.sharedFilterConfig)}};Zo.CompressionFilterFactory=qv});var _h=R(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.deadlineToString=ar.getRelativeTimeout=ar.getDeadlineTimeoutString=ar.minDeadline=void 0;function Lq(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}ar.minDeadline=Lq;var Bq=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function Vq(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of Bq){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}ar.getDeadlineTimeoutString=Vq;var Uq=2147483647;function qq(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>Uq?1/0:r}ar.getRelativeTimeout=qq;function zq(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}ar.deadlineToString=zq});var Eh=R(Th=>{"use strict";Object.defineProperty(Th,"__esModule",{value:!0});Th.restrictControlPlaneStatusCode=void 0;var lr=Te(),Gq=[lr.Status.OK,lr.Status.INVALID_ARGUMENT,lr.Status.NOT_FOUND,lr.Status.ALREADY_EXISTS,lr.Status.FAILED_PRECONDITION,lr.Status.ABORTED,lr.Status.OUT_OF_RANGE,lr.Status.DATA_LOSS];function jq(n,e){return Gq.includes(n)?{code:lr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${lr.Status[n]} ${e}`}:{code:n,details:e}}Th.restrictControlPlaneStatusCode=jq});var AR=R(Dh=>{"use strict";Object.defineProperty(Dh,"__esModule",{value:!0});Dh.LoadBalancingCall=void 0;var DR=cn(),Ch=Te(),Kq=_h(),Ih=Ht(),fc=ui(),$q=en(),Wq=He(),zv=Eh(),Hq=Ee("http2"),Qq="load_balancing_call",Gv=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),m="";u.length>=2&&(m=u[1]);let g=(c=(l=(0,$q.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${g}/${m}`}trace(e){Wq.trace(Ch.LogVerbosity.DEBUG,Qq,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+fc.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case fc.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let m=this.metadata.clone();if(m.merge(a),m.get("authorization").length>1&&this.outputStatus({code:Ch.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Ih.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==DR.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+DR.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&m.set("grpc-timeout",(0,Kq.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(m,this.host,this.methodName,{onReceiveMetadata:g=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(g)},onReceiveMessage:g=>{this.trace("Received message"),this.listener.onReceiveMessage(g)},onReceiveStatus:g=>{this.trace("Received status"),g.rstCode===Hq.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(g,"REFUSED"):this.outputStatus(g,"PROCESSED")}})}catch(g){this.trace("Failed to start call on picked subchannel "+i+" with error "+g.message),this.outputStatus({code:Ch.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+g.message,metadata:new Ih.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,zv.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:Ch.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new Ih.Metadata},"PROCESSED")});break;case fc.PickResultType.DROP:let{code:s,details:o}=(0,zv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case fc.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,zv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case fc.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Ih.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Dh.LoadBalancingCall=Gv});var NR=R(Rh=>{"use strict";Object.defineProperty(Rh,"__esModule",{value:!0});Rh.ResolvingCall=void 0;var ea=Te(),Ah=_h(),RR=Ht(),Yq=He(),Xq=Eh(),Jq="resolving_call",jv=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&ea.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(ea.Status.CANCELLED,"Cancelled by parent call")}),r.flags&ea.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Ah.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){Yq.trace(ea.LogVerbosity.DEBUG,Jq,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Ah.deadlineToString)(this.deadline));let e=(0,Ah.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(ea.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==ea.Status.OK){let{code:r,details:i}=(0,Xq.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new RR.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Ah.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new RR.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Rh.ResolvingCall=jv});var xR=R(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.RetryingCall=Di.MessageBufferTracker=Di.RetryThrottler=void 0;var Nh=Te(),Zq=Ht(),e4=He(),t4="retrying_call",$v=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Di.RetryThrottler=$v;var Wv=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Di.MessageBufferTracker=Wv;var Kv="grpc-previous-rpc-attempts",Hv=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){e4.trace(Nh.LogVerbosity.DEBUG,t4,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new Zq.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Nh.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Nh.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Nh.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Kv,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Kv,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Kv,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Di.RetryingCall=Hv});var kh=R(xh=>{"use strict";Object.defineProperty(xh,"__esModule",{value:!0});xh.BaseSubchannelWrapper=void 0;var Qv=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};xh.BaseSubchannelWrapper=Qv});var MR=R(Ph=>{"use strict";Object.defineProperty(Ph,"__esModule",{value:!0});Ph.InternalChannel=void 0;var n4=gd(),r4=iI(),i4=_R(),kR=ui(),pc=Te(),s4=Mv(),o4=IR(),OR=Qn(),Yv=He(),a4=Tv(),Oh=en(),cr=cn(),mc=bs(),l4=AR(),c4=_h(),u4=NR(),Xv=Dv(),d4=Eh(),Jv=xR(),h4=kh(),f4=2147483647,p4=1e3,m4=30*60*1e3,Mh=new Map,g4=1<<24,y4=1<<20,Zv=class extends h4.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},ew=class{constructor(e,t,r){var i,s,o,a,l,c,u,m;if(this.credentials=t,this.options=r,this.connectivityState=cr.ConnectivityState.IDLE,this.currentPicker=new kR.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new mc.ChannelzCallTracker,this.childrenTracker=new mc.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof n4.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let g=(0,Oh.parseUri)(e);if(g===null)throw new Error(`Could not parse target name "${e}"`);let S=(0,OR.mapUriDefaultScheme)(g);if(S===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},f4),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new mc.ChannelzTrace,this.channelzRef=(0,mc.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,OR.getDefaultAuthority)(S);let T=(0,a4.mapProxyName)(S,r);this.target=T.target,this.options=Object.assign({},this.options,T.extraOptions),this.subchannelPool=(0,i4.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Jv.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:g4,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:y4),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:m4,p4);let C={createSubchannel:(x,A)=>{let k=this.subchannelPool.getOrCreateSubchannel(this.target,x,Object.assign({},this.options,A),this.credentials);k.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",k.getChannelzRef());let O=new Zv(k,this);return this.wrappedSubchannels.add(O),O},updateState:(x,A)=>{this.currentPicker=A;let k=this.pickQueue.slice();this.pickQueue=[],k.length>0&&this.callRefTimerUnref();for(let O of k)O.doPick();this.updateState(x)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:x=>{this.channelzEnabled&&this.childrenTracker.refChild(x)},removeChannelzChild:x=>{this.channelzEnabled&&this.childrenTracker.unrefChild(x)}};this.resolvingLoadBalancer=new r4.ResolvingLoadBalancer(this.target,C,r,(x,A)=>{x.retryThrottling?Mh.set(this.getTarget(),new Jv.RetryThrottler(x.retryThrottling.maxTokens,x.retryThrottling.tokenRatio,Mh.get(this.getTarget()))):Mh.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=A,this.currentResolutionError=null,process.nextTick(()=>{let k=this.configSelectionQueue;this.configSelectionQueue=[],k.length>0&&this.callRefTimerUnref();for(let O of k)O.getConfig()})},x=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+x.code+' and details "'+x.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,d4.restrictControlPlaneStatusCode)(x.code,x.details)),{metadata:x.metadata}));let A=this.configSelectionQueue;this.configSelectionQueue=[],A.length>0&&this.callRefTimerUnref();for(let k of A)k.reportResolverError(x)}),this.filterStackFactory=new s4.FilterStackFactory([new o4.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let E=new Error;(0,Yv.trace)(pc.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((m=E.stack)===null||m===void 0?void 0:m.substring(E.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Yv.trace)(t??pc.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Oh.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Yv.trace)(pc.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Oh.uriToString)(this.target)+" "+cr.ConnectivityState[this.connectivityState]+" -> "+cr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+cr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==cr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(cr.ConnectivityState.IDLE),this.currentPicker=new kR.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==cr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===pc.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Xv.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new l4.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Xv.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Jv.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,Mh.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Xv.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,c4.deadlineToString)(t));let a={deadline:t,flags:s??pc.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new u4.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(cr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,mc.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Oh.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===cr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===cr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Ph.InternalChannel=ew});var sy=R(Fh=>{"use strict";Object.defineProperty(Fh,"__esModule",{value:!0});Fh.ChannelImplementation=void 0;var v4=gd(),w4=MR(),tw=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof v4.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new w4.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Fh.ChannelImplementation=tw});var GR=R(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.Http2ServerCallStream=vn.ServerDuplexStreamImpl=vn.ServerWritableStreamImpl=vn.ServerReadableStreamImpl=vn.ServerUnaryCallImpl=void 0;var UR=Ee("events"),ta=Ee("http2"),iw=Ee("stream"),PR=Ee("zlib"),Oe=Te(),sw=Ht(),b4=Cv(),qR=He(),yc=ud(),zR="server_call";function gc(n){qR.trace(Oe.LogVerbosity.DEBUG,zR,n)}var S4="grpc-accept-encoding",_4="grpc-encoding",FR="grpc-message",LR="grpc-status",BR="grpc-timeout",T4=/(\d{1,8})\s*([HMSmun])/,E4={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},C4={[S4]:"identity,deflate,gzip",[_4]:"identity"},VR={[ta.constants.HTTP2_HEADER_STATUS]:ta.constants.HTTP_STATUS_OK,[ta.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},I4={waitForTrailers:!0},nw=class extends UR.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};vn.ServerUnaryCallImpl=nw;var Lh=class extends iw.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};vn.ServerReadableStreamImpl=Lh;var vc=class extends iw.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new sw.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,yc.getErrorMessage)(i),code:Oe.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Oe.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};vn.ServerWritableStreamImpl=vc;var na=class extends iw.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new sw.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};vn.ServerDuplexStreamImpl=na;na.prototype._read=Lh.prototype._read;na.prototype._write=vc.prototype._write;na.prototype._final=vc.prototype._final;var rw=class extends UR.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Oe.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Oe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;gc("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Oe.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=PR.createInflate():i=PR.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Oe.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Oe.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},VR),C4),t);this.stream.respond(r,I4)}receiveMetadata(e){let t=sw.Metadata.fromHttp2Headers(e);qR.isTracerEnabled(zR)&&gc("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(BR);if(r.length>0){let i=r[0].toString().match(T4);if(i===null){let a=new Error("Invalid deadline");return a.code=Oe.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*E4[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(D4,s,this),t.remove(BR)}return t.remove(ta.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(ta.constants.HTTP2_HEADER_TE),t.remove(ta.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(m){if(s+=m.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Oe.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(m)}function u(m){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),m!==void 0){r({code:Oe.Status.INTERNAL,details:m.message});return}if(s===0){r({code:Oe.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let g=Buffer.concat(a,s),T=g.readUInt8(0)===1?e:"identity",C=o.getDecompressedMessage(g,T);if(Buffer.isBuffer(C)){t(o.deserializeMessageWithInternalError(C));return}C.then(E=>t(o.deserializeMessageWithInternalError(E)),E=>r(E.code?E:{code:Oe.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return _(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,yc.getErrorMessage)(t),code:Oe.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return _(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Oe.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,yc.getErrorMessage)(s),code:Oe.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Oe.Status.OK),!this.checkCancelled())if(gc("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Oe.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[LR]:e.code,[FR]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[LR]:e.code,[FR]:encodeURI(e.details)},VR),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Oe.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Oe.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new b4.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>_(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>_(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Oe.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let g=u.readUInt8(0)===1?t:"identity",S;try{S=yield this.getDecompressedMessage(u,g)}catch(T){this.sendError(T);return}if(!S)return;yield this.pushOrBufferMessage(e,S)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>_(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return _(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return _(this,null,function*(){if(t===null){gc("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}gc("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,yc.getErrorCode)(r);(i===null||i<Oe.Status.OK||i>Oe.Status.UNAUTHENTICATED)&&(i=Oe.Status.INTERNAL),e.emit("error",{details:(0,yc.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};vn.Http2ServerCallStream=rw;function D4(n){let e=new Error("Deadline exceeded");e.code=Oe.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var lw=R(Bh=>{"use strict";Object.defineProperty(Bh,"__esModule",{value:!0});Bh.ServerCredentials=void 0;var jR=Rg(),wc=class{static createInsecure(){return new ow}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new aw({ca:e||(0,jR.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:jR.CIPHER_SUITES})}};Bh.ServerCredentials=wc;var ow=class extends wc{_isSecure(){return!1}_getSettings(){return null}},aw=class extends wc{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var WR=R(qh=>{"use strict";Object.defineProperty(qh,"__esModule",{value:!0});qh.Server=void 0;var Ai=Ee("http2"),Or=Te(),_s=GR(),A4=lw(),KR=Qn(),Vh=He(),Pn=Xn(),R4=en(),Xt=bs(),Uh=~(1<<31),N4=~(1<<31),x4=2e4,{HTTP2_HEADER_PATH:$R}=Ai.constants,k4="server";function O4(){}function cw(n){return{code:Or.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function M4(n,e){let t=cw(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var uw=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Xt.ChannelzTrace,this.callTracker=new Xt.ChannelzCallTracker,this.listenerChildrenTracker=new Xt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Xt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Xt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Uh,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Uh,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:N4,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:x4,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Pn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Pn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let m=o,g=m.getCipher(),S=m.getCertificate(),T=m.getPeerCertificate();c={cipherSuiteStandardName:(t=g.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:g.standardName?null:g.name,localCertificate:S&&"raw"in S?S.raw:null,remoteCertificate:T&&"raw"in T?T.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Vh.trace(Or.LogVerbosity.DEBUG,k4,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=M4(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof A4.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,R4.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,KR.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(S,T)=>{process.nextTick(()=>r(S,T))},l=()=>{let S;if(t._isSecure()){let T=Object.assign(o,t._getSettings());T.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,S=Ai.createSecureServer(T),S.on("secureConnection",C=>{C.on("error",E=>{this.trace("An incoming TLS connection closed with error: "+E.message)})})}else S=Ai.createServer(o);return S.setTimeout(0,O4),this._setupHandlers(S),S},c=(S,T,C)=>S.length===0?Promise.resolve({port:T,count:C}):Promise.all(S.map(E=>{this.trace("Attempting to bind "+(0,Pn.subchannelAddressToString)(E));let x;(0,Pn.isTcpSubchannelAddress)(E)?x={host:E.host,port:T}:x=E;let A=l();return new Promise((k,O)=>{let z=Q=>{this.trace("Failed to bind "+(0,Pn.subchannelAddressToString)(E)+" with error "+Q.message),k(Q)};A.once("error",z),A.listen(x,()=>{if(this.shutdown){A.close(),k(new Error("bindAsync failed because server is shutdown"));return}let Q=A.address(),v;typeof Q=="string"?v={path:Q}:v={host:Q.address,port:Q.port};let h=(0,Xt.registerChannelzSocket)((0,Pn.subchannelAddressToString)(v),()=>({localAddress:v,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(h),this.http2ServerList.push({server:A,channelzRef:h}),this.trace("Successfully bound "+(0,Pn.subchannelAddressToString)(v)),k("port"in v?v.port:T),A.removeListener("error",z)})})})).then(E=>{let x=0;for(let A of E)if(typeof A=="number"&&(x+=1,A!==T))throw new Error("Invalid state: multiple port numbers added from single address");return{port:T,count:x+C}}),u=S=>{if(S.length===0)return Promise.resolve({port:0,count:0});let T=S[0],C=l();return new Promise((E,x)=>{let A=k=>{this.trace("Failed to bind "+(0,Pn.subchannelAddressToString)(T)+" with error "+k.message),E(u(S.slice(1)))};C.once("error",A),C.listen(T,()=>{if(this.shutdown){C.close(),E({port:0,count:0});return}let k=C.address(),O={host:k.address,port:k.port},z=(0,Xt.registerChannelzSocket)((0,Pn.subchannelAddressToString)(O),()=>({localAddress:O,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(z),this.http2ServerList.push({server:C,channelzRef:z}),this.trace("Successfully bound "+(0,Pn.subchannelAddressToString)(O)),E(c(S.slice(1),k.port,1)),C.removeListener("error",A)})})},m={onSuccessfulResolution:(S,T,C)=>{if(m.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),S.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let E;(0,Pn.isTcpSubchannelAddress)(S[0])?S[0].port===0?E=u(S):E=c(S,S[0].port,0):E=c(S,1,0),E.then(x=>{if(x.count===0){let A=`No address added out of total ${S.length} resolved`;Vh.log(Or.LogVerbosity.ERROR,A),a(new Error(A),0)}else x.count<S.length&&Vh.log(Or.LogVerbosity.INFO,`WARNING Only ${x.count} addresses added out of total ${S.length} resolved`),a(null,x.port)},x=>{let A=`No address added out of total ${S.length} resolved`;Vh.log(Or.LogVerbosity.ERROR,A),a(new Error(A),0)})},onError:S=>{a(new Error(S.details),0)}};(0,KR.createResolver)(s,m,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Xt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Ai.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Xt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Xt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Xt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Ai.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Ai.constants.HTTP2_HEADER_STATUS]:Ai.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new _s.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Or.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[$R],s=this._retrieveHandler(i);if(!s){this._respondWithError(cw(i),e,r);return}let o=new _s.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Or.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Or.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[$R],i=this._retrieveHandler(r);if(!i){this._respondWithError(cw(r),e,null);return}let s=new _s.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Or.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")P4(e,t,s,o);else if(a==="clientStream")F4(e,t,s,o);else if(a==="serverStream")L4(e,t,s,o);else if(a==="bidi")B4(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let m=(0,Xt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),g={ref:m,streamTracker:new Xt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,g);let S=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+S),this.sessionChildrenTracker.refChild(m));let T=null,C=null,E=!1;if(this.maxConnectionAgeMs!==Uh){let A=this.maxConnectionAgeMs/10,k=Math.random()*A*2-A;T=(l=(a=setTimeout(()=>{var O,z;E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+S);try{s.goaway(Ai.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Uh&&(C=(z=(O=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||z===void 0?void 0:z.call(O))},this.maxConnectionAgeMs+k)).unref)===null||l===void 0?void 0:l.call(a)}let x=(u=(c=setInterval(()=>{var A,k;let O=(k=(A=setTimeout(()=>{E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+S),s.close()},this.keepaliveTimeoutMs)).unref)===null||k===void 0?void 0:k.call(A);try{s.ping((z,Q,v)=>{clearTimeout(O)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(E||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+S),this.sessionChildrenTracker.unrefChild(m),(0,Xt.unregisterChannelzRef)(m)),T&&clearTimeout(T),C&&clearTimeout(C),x&&clearTimeout(x),this.sessions.delete(s)})})}};qh.Server=uw;function P4(n,e,t,r){return _(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new _s.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function F4(n,e,t,r){let i=new _s.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function L4(n,e,t,r){return _(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new _s.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function B4(n,e,t,r){let i=new _s.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var HR=R(zh=>{"use strict";Object.defineProperty(zh,"__esModule",{value:!0});zh.StatusBuilder=void 0;var dw=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};zh.StatusBuilder=dw});var hw=R(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});Ri.isDuration=Ri.durationToMs=Ri.msToDuration=void 0;function V4(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}Ri.msToDuration=V4;function U4(n){return n.seconds*1e3+n.nanos/1e6|0}Ri.durationToMs=U4;function q4(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}Ri.isDuration=q4});var bw=R(Ni=>{"use strict";var fw;Object.defineProperty(Ni,"__esModule",{value:!0});Ni.setup=Ni.OutlierDetectionLoadBalancer=Ni.OutlierDetectionLoadBalancingConfig=void 0;var jh=cn(),YR=Te(),Ts=hw(),XR=Sw(),JR=oi(),z4=Td(),G4=ui(),QR=Xn(),j4=kh(),K4=He(),$4="outlier_detection";function vt(n){K4.trace(YR.LogVerbosity.DEBUG,$4,n)}var ww="outlier_detection",W4=((fw=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&fw!==void 0?fw:"true")==="true",H4={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},Q4={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function ra(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function pw(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Ts.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Gh(n,e,t){let r=t?`${t}.${e}`:e;if(ra(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var bc=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},H4),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},Q4),o):null}getLoadBalancerName(){return ww}toJsonObject(){return{interval:(0,Ts.msToDuration)(this.intervalMs),base_ejection_time:(0,Ts.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Ts.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(pw(e,"interval"),pw(e,"base_ejection_time"),pw(e,"max_ejection_time"),Gh(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");ra(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Gh(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),ra(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),ra(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Gh(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Gh(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),ra(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),ra(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Ts.durationToMs)(e.interval):null,e.base_ejection_time?(0,Ts.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Ts.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(JR.validateLoadBalancingConfig))}};Ni.OutlierDetectionLoadBalancingConfig=bc;var gw=class extends j4.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?jh.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,jh.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,jh.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function mw(){return{success:0,failure:0}}var yw=class{constructor(){this.activeBucket=mw(),this.inactiveBucket=mw()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=mw()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},vw=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===G4.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===YR.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Kh=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new z4.ChildLoadBalancerHandler((0,XR.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,QR.subchannelAddressToString)(t)),o=new gw(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===jh.ConnectivityState.READY?e.updateState(t,new vw(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;vt("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[m,g]of this.addressMap){let S=g.counter.getLastSuccesses(),T=g.counter.getLastFailures();vt("Stats for "+m+": successes="+S+" failures="+T+" targetRequestVolume="+r),S+T>=r&&(i+=1,s.push(S/(S+T)))}if(vt("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((m,g)=>m+g)/s.length,a=0;for(let m of s){let g=m-o;a+=g*g}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);vt("stdev="+c+" ejectionThreshold="+u);for(let[m,g]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let S=g.counter.getLastSuccesses(),T=g.counter.getLastFailures();if(S+T<r)continue;let C=S/(S+T);if(vt("Checking candidate "+m+" successRate="+C),C<u){let E=Math.random()*100;vt("Candidate "+m+" randomNumber="+E+" enforcement_percentage="+t.enforcement_percentage),E<t.enforcement_percentage&&(vt("Ejecting candidate "+m),this.eject(g,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;vt("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(vt("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;vt("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(vt("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(vt("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(vt("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof bc))return;let i=new Set;for(let o of e)i.add((0,QR.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(vt("Adding map entry for "+o),this.addressMap.set(o,{counter:new yw,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(vt("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,JR.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){vt("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else vt("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{vt("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return ww}};Ni.OutlierDetectionLoadBalancer=Kh;function Y4(){W4&&(0,XR.registerLoadBalancerType)(ww,Kh,bc)}Ni.setup=Y4});var Sw=R(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.OutlierDetectionLoadBalancingConfig=re.BaseSubchannelWrapper=re.registerAdminService=re.FilterStackFactory=re.BaseFilter=re.PickResultType=re.QueuePicker=re.UnavailablePicker=re.ChildLoadBalancerHandler=re.subchannelAddressToString=re.validateLoadBalancingConfig=re.getFirstUsableConfig=re.registerLoadBalancerType=re.createChildChannelControlHelper=re.BackoffTimeout=re.durationToMs=re.uriToString=re.createResolver=re.registerResolver=re.log=re.trace=void 0;var ZR=He();Object.defineProperty(re,"trace",{enumerable:!0,get:function(){return ZR.trace}});Object.defineProperty(re,"log",{enumerable:!0,get:function(){return ZR.log}});var eN=Qn();Object.defineProperty(re,"registerResolver",{enumerable:!0,get:function(){return eN.registerResolver}});Object.defineProperty(re,"createResolver",{enumerable:!0,get:function(){return eN.createResolver}});var X4=en();Object.defineProperty(re,"uriToString",{enumerable:!0,get:function(){return X4.uriToString}});var J4=hw();Object.defineProperty(re,"durationToMs",{enumerable:!0,get:function(){return J4.durationToMs}});var Z4=zl();Object.defineProperty(re,"BackoffTimeout",{enumerable:!0,get:function(){return Z4.BackoffTimeout}});var $h=oi();Object.defineProperty(re,"createChildChannelControlHelper",{enumerable:!0,get:function(){return $h.createChildChannelControlHelper}});Object.defineProperty(re,"registerLoadBalancerType",{enumerable:!0,get:function(){return $h.registerLoadBalancerType}});Object.defineProperty(re,"getFirstUsableConfig",{enumerable:!0,get:function(){return $h.getFirstUsableConfig}});Object.defineProperty(re,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return $h.validateLoadBalancingConfig}});var e3=Xn();Object.defineProperty(re,"subchannelAddressToString",{enumerable:!0,get:function(){return e3.subchannelAddressToString}});var t3=Td();Object.defineProperty(re,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return t3.ChildLoadBalancerHandler}});var _w=ui();Object.defineProperty(re,"UnavailablePicker",{enumerable:!0,get:function(){return _w.UnavailablePicker}});Object.defineProperty(re,"QueuePicker",{enumerable:!0,get:function(){return _w.QueuePicker}});Object.defineProperty(re,"PickResultType",{enumerable:!0,get:function(){return _w.PickResultType}});var n3=Lv();Object.defineProperty(re,"BaseFilter",{enumerable:!0,get:function(){return n3.BaseFilter}});var r3=Mv();Object.defineProperty(re,"FilterStackFactory",{enumerable:!0,get:function(){return r3.FilterStackFactory}});var i3=Cd();Object.defineProperty(re,"registerAdminService",{enumerable:!0,get:function(){return i3.registerAdminService}});var s3=kh();Object.defineProperty(re,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return s3.BaseSubchannelWrapper}});var o3=bw();Object.defineProperty(re,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return o3.OutlierDetectionLoadBalancingConfig}})});var tN=R(Wh=>{"use strict";Object.defineProperty(Wh,"__esModule",{value:!0});Wh.setup=void 0;var a3=Qn(),Tw=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function l3(){(0,a3.registerResolver)("unix",Tw)}Wh.setup=l3});var oN=R(Yh=>{"use strict";Object.defineProperty(Yh,"__esModule",{value:!0});Yh.setup=void 0;var nN=Ee("net"),Hh=Te(),Ew=Ht(),rN=Qn(),iN=en(),c3=He(),u3="ip_resolver";function sN(n){c3.trace(Hh.LogVerbosity.DEBUG,u3,n)}var Cw="ipv4",Iw="ipv6",d3=443,Qh=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,sN("Resolver constructed for target "+(0,iN.uriToString)(e));let s=[];if(!(e.scheme===Cw||e.scheme===Iw)){this.error={code:Hh.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Ew.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,iN.splitHostPort)(a);if(l===null){this.error={code:Hh.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Ew.Metadata};return}if(e.scheme===Cw&&!(0,nN.isIPv4)(l.host)||e.scheme===Iw&&!(0,nN.isIPv6)(l.host)){this.error={code:Hh.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Ew.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:d3})}this.addresses=s,sN("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function h3(){(0,rN.registerResolver)(Cw,Qh),(0,rN.registerResolver)(Iw,Qh)}Yh.setup=h3});var cN=R(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.setup=ur.PickFirstLoadBalancer=ur.shuffled=ur.PickFirstLoadBalancingConfig=void 0;var aN=oi(),Nt=cn(),Xh=ui(),f3=He(),p3=Te(),m3="pick_first";function Dw(n){f3.trace(p3.LogVerbosity.DEBUG,m3,n)}var Sc="pick_first",g3=250,_c=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Sc}toJsonObject(){return{[Sc]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};ur.PickFirstLoadBalancingConfig=_c;var Aw=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Xh.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function lN(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}ur.shuffled=lN;var Jh=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Nt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Nt.ConnectivityState.READY,new Aw(this.currentPick)):this.children.length===0?this.updateState(Nt.ConnectivityState.IDLE,new Xh.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Nt.ConnectivityState.TRANSIENT_FAILURE,new Xh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Nt.ConnectivityState.CONNECTING,new Xh.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Nt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Nt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Nt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Nt.ConnectivityState.IDLE||i===Nt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Nt.ConnectivityState.IDLE&&(Dw("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},g3)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Dw("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Dw(Nt.ConnectivityState[this.currentState]+" -> "+Nt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Nt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Nt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof _c&&(t.getShuffleAddressList()&&(e=lN(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Nt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Sc}};ur.PickFirstLoadBalancer=Jh;function y3(){(0,aN.registerLoadBalancerType)(Sc,Jh,_c),(0,aN.registerDefaultLoadBalancerType)(Sc)}ur.setup=y3});var dN=R(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.setup=ia.RoundRobinLoadBalancer=void 0;var v3=oi(),xt=cn(),Zh=ui(),w3=Xn(),b3=He(),S3=Te(),_3="round_robin";function uN(n){b3.trace(S3.LogVerbosity.DEBUG,_3,n)}var ef="round_robin",Rw=class n{getLoadBalancerName(){return ef}constructor(){}toJsonObject(){return{[ef]:{}}}static createFromJson(e){return new n}},Nw=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Zh.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},tf=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=xt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===xt.ConnectivityState.TRANSIENT_FAILURE||i===xt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(xt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===xt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(xt.ConnectivityState.READY,new Nw(e,t))}else this.countSubchannelsWithState(xt.ConnectivityState.CONNECTING)>0?this.updateState(xt.ConnectivityState.CONNECTING,new Zh.QueuePicker(this)):this.countSubchannelsWithState(xt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(xt.ConnectivityState.TRANSIENT_FAILURE,new Zh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(xt.ConnectivityState.IDLE,new Zh.QueuePicker(this))}updateState(e,t){uN(xt.ConnectivityState[this.currentState]+" -> "+xt.ConnectivityState[e]),e===xt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),uN("Connect to address list "+e.map(r=>(0,w3.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===xt.ConnectivityState.IDLE||i===xt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return ef}};ia.RoundRobinLoadBalancer=tf;function T3(){(0,v3.registerLoadBalancerType)(ef,tf,Rw)}ia.setup=T3});var Ow=R(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.experimental=j.addAdminServicesToServer=j.getChannelzHandlers=j.getChannelzServiceDefinition=j.InterceptorConfigurationError=j.InterceptingCall=j.RequesterBuilder=j.ListenerBuilder=j.StatusBuilder=j.getClientChannel=j.ServerCredentials=j.Server=j.setLogVerbosity=j.setLogger=j.load=j.loadObject=j.CallCredentials=j.ChannelCredentials=j.waitForClientReady=j.closeClient=j.Channel=j.makeGenericClientConstructor=j.makeClientConstructor=j.loadPackageDefinition=j.Client=j.compressionAlgorithms=j.propagate=j.connectivityState=j.status=j.logVerbosity=j.Metadata=j.credentials=void 0;var nf=Dg();Object.defineProperty(j,"CallCredentials",{enumerable:!0,get:function(){return nf.CallCredentials}});var E3=sy();Object.defineProperty(j,"Channel",{enumerable:!0,get:function(){return E3.ChannelImplementation}});var C3=Pv();Object.defineProperty(j,"compressionAlgorithms",{enumerable:!0,get:function(){return C3.CompressionAlgorithms}});var I3=cn();Object.defineProperty(j,"connectivityState",{enumerable:!0,get:function(){return I3.ConnectivityState}});var rf=gd();Object.defineProperty(j,"ChannelCredentials",{enumerable:!0,get:function(){return rf.ChannelCredentials}});var hN=iy();Object.defineProperty(j,"Client",{enumerable:!0,get:function(){return hN.Client}});var xw=Te();Object.defineProperty(j,"logVerbosity",{enumerable:!0,get:function(){return xw.LogVerbosity}});Object.defineProperty(j,"status",{enumerable:!0,get:function(){return xw.Status}});Object.defineProperty(j,"propagate",{enumerable:!0,get:function(){return xw.Propagate}});var fN=He(),kw=ay();Object.defineProperty(j,"loadPackageDefinition",{enumerable:!0,get:function(){return kw.loadPackageDefinition}});Object.defineProperty(j,"makeClientConstructor",{enumerable:!0,get:function(){return kw.makeClientConstructor}});Object.defineProperty(j,"makeGenericClientConstructor",{enumerable:!0,get:function(){return kw.makeClientConstructor}});var D3=Ht();Object.defineProperty(j,"Metadata",{enumerable:!0,get:function(){return D3.Metadata}});var A3=WR();Object.defineProperty(j,"Server",{enumerable:!0,get:function(){return A3.Server}});var R3=lw();Object.defineProperty(j,"ServerCredentials",{enumerable:!0,get:function(){return R3.ServerCredentials}});var N3=HR();Object.defineProperty(j,"StatusBuilder",{enumerable:!0,get:function(){return N3.StatusBuilder}});j.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:rf.ChannelCredentials.createInsecure,createSsl:rf.ChannelCredentials.createSsl,createFromSecureContext:rf.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:nf.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:nf.CallCredentials.createFromGoogleCredential,createEmpty:nf.CallCredentials.createEmpty};var x3=n=>n.close();j.closeClient=x3;var k3=(n,e,t)=>n.waitForReady(e,t);j.waitForClientReady=k3;var O3=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};j.loadObject=O3;var M3=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};j.load=M3;var P3=n=>{fN.setLogger(n)};j.setLogger=P3;var F3=n=>{fN.setLoggerVerbosity(n)};j.setLogVerbosity=F3;var L3=n=>hN.Client.prototype.getChannel.call(n);j.getClientChannel=L3;var sf=ty();Object.defineProperty(j,"ListenerBuilder",{enumerable:!0,get:function(){return sf.ListenerBuilder}});Object.defineProperty(j,"RequesterBuilder",{enumerable:!0,get:function(){return sf.RequesterBuilder}});Object.defineProperty(j,"InterceptingCall",{enumerable:!0,get:function(){return sf.InterceptingCall}});Object.defineProperty(j,"InterceptorConfigurationError",{enumerable:!0,get:function(){return sf.InterceptorConfigurationError}});var pN=bs();Object.defineProperty(j,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return pN.getChannelzServiceDefinition}});Object.defineProperty(j,"getChannelzHandlers",{enumerable:!0,get:function(){return pN.getChannelzHandlers}});var B3=Cd();Object.defineProperty(j,"addAdminServicesToServer",{enumerable:!0,get:function(){return B3.addAdminServicesToServer}});var V3=Sw();j.experimental=V3;var U3=_v(),q3=tN(),z3=oN(),G3=cN(),j3=dN(),K3=bw(),$3=bs();U3.setup(),q3.setup(),z3.setup(),G3.setup(),j3.setup(),K3.setup(),$3.setup()});var T0=(()=>{class n{constructor(t){this.router=t}navigateTo(t){this.router.navigate([`/${t}`])}static{this.\u0275fac=function(r){return new(r||n)(Fe(nd))}}static{this.\u0275cmp=Jr({type:n,selectors:[["app-landing-page"]],decls:31,vars:0,consts:[[1,"header"],[1,"logo"],[1,"nav-links"],[3,"click"],[1,"landing-content"]],template:function(r,i){r&1&&(Z(0,"div",0)(1,"div",1),oe(2,"MediHelp"),ee(),Z(3,"nav",2)(4,"button",3),Dt("click",function(){return i.navigateTo("inicio")}),oe(5,"Inicio"),ee(),Z(6,"button",3),Dt("click",function(){return i.navigateTo("medicos")}),oe(7,"Medicos"),ee(),Z(8,"button",3),Dt("click",function(){return i.navigateTo("gluciobot")}),oe(9,"GlucioBot"),ee(),Z(10,"button",3),Dt("click",function(){return i.navigateTo("nosotros")}),oe(11,"Nosotros"),ee(),Z(12,"button",3),Dt("click",function(){return i.navigateTo("login")}),oe(13,"Login"),ee()()(),Z(14,"div",4)(15,"h1"),oe(16,"Bienvenido a MediHelp"),ee(),Z(17,"p"),oe(18,"Centro de Salud Integral."),ee()(),Z(19,"div",4)(20,"h2"),oe(21,"Conoce a Gluciobot"),ee(),Z(22,"p"),oe(23,"Glucio, es un asistente virtual que te ayudara con el agendamiento de citas, historial m\xE9dico, recomendaciones e informaci\xF3n para prevenir enfermedades y mucho m\xE1s."),ee(),Z(24,"button",3),Dt("click",function(){return"glucio"}),oe(25,"Preguntale a Glucio"),ee()(),Z(26,"div",4)(27,"h2"),oe(28,"Nuestros Servicios"),ee(),Z(29,"p"),oe(30,"Nosotros te proveemos las mejores opciones. Nos ajustamos a tus necesidades de salud para asegurarnos de que te trates con doctores altamente calificados. Puedes consultar con nosotros el tipo de servicio que le corresponda para mejorar su salud."),ee()())},styles:[".header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:#fff;padding:15px 30px;color:#fff}.header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.header[_ngcontent-%COMP%]   .nav-links[_ngcontent-%COMP%]{display:flex;gap:20px}.header[_ngcontent-%COMP%]   .nav-links[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid white;border-radius:5px;color:#626262;padding:8px 15px;cursor:pointer;font-size:1rem}.header[_ngcontent-%COMP%]   .nav-links[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#fff;color:#000}.landing-content[_ngcontent-%COMP%]{text-align:left;margin-top:50px}.landing-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;color:#000}.landing-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;margin-top:10px;color:#626262}"]})}}return n})();var QP="firebase",YP="10.14.1";Er(QP,YP,"app");var fs=new $m("ANGULARFIRE2_VERSION");var E0=(n,e)=>{let t=e?[e]:S0(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},ti=class{constructor(){return E0(XP)}},XP="app-check";function go(){}var sd=class{zone;delegate;constructor(e,t=ZC){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},eg=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",go,{},go,go)),t.pipe(r0({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Vl=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new sd(Zone.current)),this.insideAngular=t.run(()=>new sd(Zone.current,Ju)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(he(Zr))};static \u0275prov=as({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function od(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function JP(n){return od().ngZone.runOutsideAngular(()=>n())}function hs(n){return od().ngZone.run(()=>n())}function Lt(n){return ZP(od())(n)}function ZP(n){return function(t){return t=t.lift(new eg(n.ngZone)),t.pipe(ss(n.outsideAngular),Yr(n.insideAngular))}}var eF=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),hs(()=>n.apply(void 0,r))},tg=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=hs(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",go,{},go,go))),r[s]=eF(r[s],t));let i=JP(()=>n.apply(this,r));if(!e)if(i instanceof Wn){let s=od();return i.pipe(ss(s.outsideAngular),Yr(s.insideAngular))}else return hs(()=>i);return i instanceof Wn?i.pipe(Lt):i instanceof Promise?hs(()=>new Promise((s,o)=>i.then(a=>hs(()=>s(a)),a=>hs(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:hs(()=>i)};var rF=new Map,iF={activated:!1,tokenObservers:[]},sF={initialized:!1,enabled:!1};function Dn(n){return rF.get(n)||Object.assign({},iF)}function N0(){return sF}var oF="https://content-firebaseappcheck.googleapis.com/v1";var aF="exchangeDebugToken",I0={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},oJ=24*60*60*1e3;var rg=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return _(this,null,function*(){this.stop();try{this.pending=new Xm,this.pending.promise.catch(t=>{}),yield lF(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Xm,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function lF(n){return new Promise(e=>{setTimeout(e,n)})}var cF={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ni=new v0("appCheck","AppCheck",cF);function x0(n){if(!Dn(n).activated)throw ni.create("use-before-activation",{appName:n.name})}function k0(r,i){return _(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let S=yield o.getHeartbeatsHeader();S&&(s["X-Firebase-Client"]=S)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(S){throw ni.create("fetch-network-error",{originalErrorMessage:S?.message})}if(l.status!==200)throw ni.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(S){throw ni.create("fetch-parse-error",{originalErrorMessage:S?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw ni.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let m=Number(u[1])*1e3,g=Date.now();return{token:c.token,expireTimeMillis:g+m,issuedAtTimeMillis:g}})}function O0(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${oF}/projects/${t}/apps/${r}:${aF}?key=${i}`,body:{debug_token:e}}}var uF="firebase-app-check-database",dF=1,ig="firebase-app-check-store";var ad=null;function hF(){return ad||(ad=new Promise((n,e)=>{try{let t=indexedDB.open(uF,dF);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(ni.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(ig,{keyPath:"compositeKey"})}}}catch(t){e(ni.create("storage-open",{originalErrorMessage:t?.message}))}}),ad)}function fF(n,e){return pF(mF(n),e)}function pF(n,e){return _(this,null,function*(){let r=(yield hF()).transaction(ig,"readwrite"),s=r.objectStore(ig).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(ni.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function mF(n){return`${n.options.appId}-${n.name}`}var sg=new id("@firebase/app-check");function ng(n,e){return rd()?fF(n,e).catch(t=>{sg.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function M0(){return N0().enabled}function P0(){return _(this,null,function*(){let n=N0();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var gF={error:"UNKNOWN_ERROR"};function yF(n){return m0.encodeString(JSON.stringify(n),!1)}function og(n,e=!1){return _(this,null,function*(){let t=n.app;x0(t);let r=Dn(t),i=r.token,s;if(i&&!Ul(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Ul(l)?i=l:yield ng(t,void 0))}if(!e&&i&&Ul(i))return{token:i.token};let o=!1;if(M0()){r.exchangeTokenPromise||(r.exchangeTokenPromise=k0(O0(t,yield P0()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield ng(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Dn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?sg.warn(l.message):sg.error(l),s=l}let a;return i?s?Ul(i)?a={token:i.token,internalError:s}:a=A0(s):(a={token:i.token},r.token=i,yield ng(t,i)):a=A0(s),o&&SF(t,a),a})}function vF(n){return _(this,null,function*(){let e=n.app;x0(e);let{provider:t}=Dn(e);if(M0()){let r=yield P0(),{token:i}=yield k0(O0(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function wF(n,e,t,r){let{app:i}=n,s=Dn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Ul(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),D0(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>D0(n))}function F0(n,e){let t=Dn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function D0(n){let{app:e}=n,t=Dn(e),r=t.tokenRefresher;r||(r=bF(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function bF(n){let{app:e}=n;return new rg(()=>_(this,null,function*(){let t=Dn(e),r;if(t.token?r=yield og(n,!0):r=yield og(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Dn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},I0.RETRIAL_MIN_WAIT,I0.RETRIAL_MAX_WAIT)}function SF(n,e){let t=Dn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Ul(n){return n.expireTimeMillis-Date.now()>0}function A0(n){return{token:yF(gF),error:n}}var ag=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Dn(this.app);for(let t of e)F0(this.app,t.next);return Promise.resolve()}};function _F(n,e){return new ag(n,e)}function TF(n){return{getToken:e=>og(n,e),getLimitedUseToken:()=>vF(n),addTokenListener:e=>wF(n,"INTERNAL",e),removeTokenListener:e=>F0(n.app,e)}}var EF="@firebase/app-check",CF="0.8.8";var IF="app-check",R0="app-check-internal";function DF(){Bl(new ds(IF,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return _F(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(R0).initialize()})),Bl(new ds(R0,n=>{let e=n.getProvider("app-check").getImmediate();return TF(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Er(EF,CF)}DF();var AF=["localhost","0.0.0.0","127.0.0.1"],vJ=typeof window<"u"&&AF.includes(window.location.hostname);var RF="firebase",NF="10.14.1";Wt.registerVersion(RF,NF,"app-compat");var xF=["ngOnDestroy"],V0=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(xF.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let m=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,m),m})})})});var ld=class{constructor(e){return e}},yo=new Xe("angularfire2.app.options"),vo=new Xe("angularfire2.app.name");function ql(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Wt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Wt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;kF("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ld(o)}var kF=(n,...e)=>{Wm()&&typeof console<"u"&&console[n](...e)},OF={provide:ld,useFactory:ql,deps:[yo,Zr,[new i0,vo]]},U0=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:yo,useValue:t},{provide:vo,useValue:r}]}}constructor(t){Wt.registerVersion("angularfire",fs.full,"core"),Wt.registerVersion("angularfire",fs.full,"app-compat"),Wt.registerVersion("angular",o0.full,t.toString())}static \u0275fac=function(r){return new(r||n)(he(fo))};static \u0275mod=$t({type:n});static \u0275inj=Kt({providers:[OF]})}return n})();function cd(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return MF(i,o)||(B0("error",`${e} was already initialized on the ${t} Firebase App with different settings.${PF?" You may need to reload as Firebase is not HMR aware.":""}`),B0("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function MF(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var PF=typeof module<"u"&&!!module.hot,B0=(n,...e)=>{Wm()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var lg=new Xe("angularfire2.auth.use-emulator"),cg=new Xe("angularfire2.auth.settings"),ug=new Xe("angularfire2.auth.tenant-id"),dg=new Xe("angularfire2.auth.langugage-code"),hg=new Xe("angularfire2.auth.use-device-language"),fg=new Xe("angularfire.auth.persistence"),pg=(n,e,t,r,i,s,o,a)=>cd(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),q0=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,m,g,S){let T=new JC,C=Xr(void 0).pipe(Yr(o.outsideAngular),os(()=>s.runOutsideAngular(()=>import("./chunk-UFLBHCJC.mjs"))),ot(()=>ql(t,s,r)),ot(E=>pg(E,s,a,c,u,m,l,g)),Lm({bufferSize:1,refCount:!1}));if(td(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Xr(null);else{C.pipe(n0()).subscribe();let E=C.pipe(os(k=>k.getRedirectResult().then(O=>O,()=>null)),Lt,Lm({bufferSize:1,refCount:!1})),x=C.pipe(os(k=>new Wn(O=>({unsubscribe:s.runOutsideAngular(()=>k.onAuthStateChanged(z=>O.next(z),z=>O.error(z),()=>O.complete()))})))),A=C.pipe(os(k=>new Wn(O=>({unsubscribe:s.runOutsideAngular(()=>k.onIdTokenChanged(z=>O.next(z),z=>O.error(z),()=>O.complete()))}))));this.authState=E.pipe(Bm(x),ss(o.outsideAngular),Yr(o.insideAngular)),this.user=E.pipe(Bm(A),ss(o.outsideAngular),Yr(o.insideAngular)),this.idToken=this.user.pipe(os(k=>k?En(k.getIdToken()):Xr(null))),this.idTokenResult=this.user.pipe(os(k=>k?En(k.getIdTokenResult()):Xr(null))),this.credential=t0(E,T,this.authState.pipe(ho(k=>!k))).pipe(ot(k=>k?.user?k:null),ss(o.outsideAngular),Yr(o.insideAngular))}return V0(this,C,s,{spy:{apply:(E,x,A)=>{(E.startsWith("signIn")||E.startsWith("createUser"))&&A.then(k=>T.next(k))}}})}static \u0275fac=function(r){return new(r||n)(he(yo),he(vo,8),he(fo),he(Zr),he(Vl),he(lg,8),he(cg,8),he(ug,8),he(dg,8),he(hg,8),he(fg,8),he(ti,8))};static \u0275prov=as({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as W3,TextEncoder as H3,TextDecoder as Q3}from"util";import{randomBytes as Y3}from"crypto";var z0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},G0={};var ri,mg;(function(){var n;function e(v,h){function p(){}p.prototype=h.prototype,v.D=h.prototype,v.prototype=new p,v.prototype.constructor=v,v.C=function(y,f,w){for(var d=Array(arguments.length-2),b=2;b<arguments.length;b++)d[b-2]=arguments[b];return h.prototype[f].apply(y,d)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,h,p){p||(p=0);var y=Array(16);if(typeof h=="string")for(var f=0;16>f;++f)y[f]=h.charCodeAt(p++)|h.charCodeAt(p++)<<8|h.charCodeAt(p++)<<16|h.charCodeAt(p++)<<24;else for(f=0;16>f;++f)y[f]=h[p++]|h[p++]<<8|h[p++]<<16|h[p++]<<24;h=v.g[0],p=v.g[1],f=v.g[2];var w=v.g[3],d=h+(w^p&(f^w))+y[0]+3614090360&4294967295;h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[1]+3905402710&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[2]+606105819&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[3]+3250441966&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(w^p&(f^w))+y[4]+4118548399&4294967295,h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[5]+1200080426&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[6]+2821735955&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[7]+4249261313&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(w^p&(f^w))+y[8]+1770035416&4294967295,h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[9]+2336552879&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[10]+4294925233&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[11]+2304563134&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(w^p&(f^w))+y[12]+1804603682&4294967295,h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[13]+4254626195&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[14]+2792965006&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[15]+1236535329&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(f^w&(p^f))+y[1]+4129170786&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[6]+3225465664&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[11]+643717713&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[0]+3921069994&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(f^w&(p^f))+y[5]+3593408605&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[10]+38016083&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[15]+3634488961&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[4]+3889429448&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(f^w&(p^f))+y[9]+568446438&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[14]+3275163606&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[3]+4107603335&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[8]+1163531501&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(f^w&(p^f))+y[13]+2850285829&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[2]+4243563512&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[7]+1735328473&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[12]+2368359562&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(p^f^w)+y[5]+4294588738&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[8]+2272392833&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[11]+1839030562&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[14]+4259657740&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(p^f^w)+y[1]+2763975236&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[4]+1272893353&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[7]+4139469664&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[10]+3200236656&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(p^f^w)+y[13]+681279174&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[0]+3936430074&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[3]+3572445317&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[6]+76029189&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(p^f^w)+y[9]+3654602809&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[12]+3873151461&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[15]+530742520&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[2]+3299628645&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(f^(p|~w))+y[0]+4096336452&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[7]+1126891415&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[14]+2878612391&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[5]+4237533241&4294967295,p=f+(d<<21&4294967295|d>>>11),d=h+(f^(p|~w))+y[12]+1700485571&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[3]+2399980690&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[10]+4293915773&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[1]+2240044497&4294967295,p=f+(d<<21&4294967295|d>>>11),d=h+(f^(p|~w))+y[8]+1873313359&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[15]+4264355552&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[6]+2734768916&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[13]+1309151649&4294967295,p=f+(d<<21&4294967295|d>>>11),d=h+(f^(p|~w))+y[4]+4149444226&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[11]+3174756917&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[2]+718787259&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+h&4294967295,v.g[1]=v.g[1]+(f+(d<<21&4294967295|d>>>11))&4294967295,v.g[2]=v.g[2]+f&4294967295,v.g[3]=v.g[3]+w&4294967295}r.prototype.u=function(v,h){h===void 0&&(h=v.length);for(var p=h-this.blockSize,y=this.B,f=this.h,w=0;w<h;){if(f==0)for(;w<=p;)i(this,v,w),w+=this.blockSize;if(typeof v=="string"){for(;w<h;)if(y[f++]=v.charCodeAt(w++),f==this.blockSize){i(this,y),f=0;break}}else for(;w<h;)if(y[f++]=v[w++],f==this.blockSize){i(this,y),f=0;break}}this.h=f,this.o+=h},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var h=1;h<v.length-8;++h)v[h]=0;var p=8*this.o;for(h=v.length-8;h<v.length;++h)v[h]=p&255,p/=256;for(this.u(v),v=Array(16),h=p=0;4>h;++h)for(var y=0;32>y;y+=8)v[p++]=this.g[h]>>>y&255;return v};function s(v,h){var p=a;return Object.prototype.hasOwnProperty.call(p,v)?p[v]:p[v]=h(v)}function o(v,h){this.h=h;for(var p=[],y=!0,f=v.length-1;0<=f;f--){var w=v[f]|0;y&&w==h||(p[f]=w,y=!1)}this.g=p}var a={};function l(v){return-128<=v&&128>v?s(v,function(h){return new o([h|0],0>h?-1:0)}):new o([v|0],0>v?-1:0)}function c(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return E(c(-v));for(var h=[],p=1,y=0;v>=p;y++)h[y]=v/p|0,p*=4294967296;return new o(h,0)}function u(v,h){if(v.length==0)throw Error("number format error: empty string");if(h=h||10,2>h||36<h)throw Error("radix out of range: "+h);if(v.charAt(0)=="-")return E(u(v.substring(1),h));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var p=c(Math.pow(h,8)),y=m,f=0;f<v.length;f+=8){var w=Math.min(8,v.length-f),d=parseInt(v.substring(f,f+w),h);8>w?(w=c(Math.pow(h,w)),y=y.j(w).add(c(d))):(y=y.j(p),y=y.add(c(d)))}return y}var m=l(0),g=l(1),S=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-E(this).m();for(var v=0,h=1,p=0;p<this.g.length;p++){var y=this.i(p);v+=(0<=y?y:4294967296+y)*h,h*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(T(this))return"0";if(C(this))return"-"+E(this).toString(v);for(var h=c(Math.pow(v,6)),p=this,y="";;){var f=O(p,h).g;p=x(p,f.j(h));var w=((0<p.g.length?p.g[0]:p.h)>>>0).toString(v);if(p=f,T(p))return w+y;for(;6>w.length;)w="0"+w;y=w+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function T(v){if(v.h!=0)return!1;for(var h=0;h<v.g.length;h++)if(v.g[h]!=0)return!1;return!0}function C(v){return v.h==-1}n.l=function(v){return v=x(this,v),C(v)?-1:T(v)?0:1};function E(v){for(var h=v.g.length,p=[],y=0;y<h;y++)p[y]=~v.g[y];return new o(p,~v.h).add(g)}n.abs=function(){return C(this)?E(this):this},n.add=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0,f=0;f<=h;f++){var w=y+(this.i(f)&65535)+(v.i(f)&65535),d=(w>>>16)+(this.i(f)>>>16)+(v.i(f)>>>16);y=d>>>16,w&=65535,d&=65535,p[f]=d<<16|w}return new o(p,p[p.length-1]&-2147483648?-1:0)};function x(v,h){return v.add(E(h))}n.j=function(v){if(T(this)||T(v))return m;if(C(this))return C(v)?E(this).j(E(v)):E(E(this).j(v));if(C(v))return E(this.j(E(v)));if(0>this.l(S)&&0>v.l(S))return c(this.m()*v.m());for(var h=this.g.length+v.g.length,p=[],y=0;y<2*h;y++)p[y]=0;for(y=0;y<this.g.length;y++)for(var f=0;f<v.g.length;f++){var w=this.i(y)>>>16,d=this.i(y)&65535,b=v.i(f)>>>16,V=v.i(f)&65535;p[2*y+2*f]+=d*V,A(p,2*y+2*f),p[2*y+2*f+1]+=w*V,A(p,2*y+2*f+1),p[2*y+2*f+1]+=d*b,A(p,2*y+2*f+1),p[2*y+2*f+2]+=w*b,A(p,2*y+2*f+2)}for(y=0;y<h;y++)p[y]=p[2*y+1]<<16|p[2*y];for(y=h;y<2*h;y++)p[y]=0;return new o(p,0)};function A(v,h){for(;(v[h]&65535)!=v[h];)v[h+1]+=v[h]>>>16,v[h]&=65535,h++}function k(v,h){this.g=v,this.h=h}function O(v,h){if(T(h))throw Error("division by zero");if(T(v))return new k(m,m);if(C(v))return h=O(E(v),h),new k(E(h.g),E(h.h));if(C(h))return h=O(v,E(h)),new k(E(h.g),h.h);if(30<v.g.length){if(C(v)||C(h))throw Error("slowDivide_ only works with positive integers.");for(var p=g,y=h;0>=y.l(v);)p=z(p),y=z(y);var f=Q(p,1),w=Q(y,1);for(y=Q(y,2),p=Q(p,2);!T(y);){var d=w.add(y);0>=d.l(v)&&(f=f.add(p),w=d),y=Q(y,1),p=Q(p,1)}return h=x(v,f.j(h)),new k(f,h)}for(f=m;0<=v.l(h);){for(p=Math.max(1,Math.floor(v.m()/h.m())),y=Math.ceil(Math.log(p)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),w=c(p),d=w.j(h);C(d)||0<d.l(v);)p-=y,w=c(p),d=w.j(h);T(w)&&(w=g),f=f.add(w),v=x(v,d)}return new k(f,v)}n.A=function(v){return O(this,v).h},n.and=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0;y<h;y++)p[y]=this.i(y)&v.i(y);return new o(p,this.h&v.h)},n.or=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0;y<h;y++)p[y]=this.i(y)|v.i(y);return new o(p,this.h|v.h)},n.xor=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0;y<h;y++)p[y]=this.i(y)^v.i(y);return new o(p,this.h^v.h)};function z(v){for(var h=v.g.length+1,p=[],y=0;y<h;y++)p[y]=v.i(y)<<1|v.i(y-1)>>>31;return new o(p,v.h)}function Q(v,h){var p=h>>5;h%=32;for(var y=v.g.length-p,f=[],w=0;w<y;w++)f[w]=0<h?v.i(w+p)>>>h|v.i(w+p+1)<<32-h:v.i(w+p);return new o(f,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,mg=G0.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,ri=G0.Integer=o}).apply(typeof z0<"u"?z0:typeof self<"u"?self:typeof window<"u"?window:{});var Os=Yu(Ow(),1),Ix=Yu(sh(),1);var mN="@firebase/firestore",gN="4.7.3";var dt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};dt.UNAUTHENTICATED=new dt(null);dt.GOOGLE_CREDENTIALS=new dt("google-credentials-uid");dt.FIRST_PARTY=new dt("first-party-uid");dt.MOCK_USER=new dt("mock-user");var X3="10.14.0";var Va=X3;function J3(n){Va=n}function Z3(n){return W3(n,{depth:100})}var Bi=new id("@firebase/firestore");function ha(){return Bi.logLevel}function KS(n){Bi.setLogLevel(n)}function L(n,...e){if(Bi.logLevel<=Hn.DEBUG){let t=e.map($S);Bi.debug(`Firestore (${Va}): ${n}`,...t)}}function Ge(n,...e){if(Bi.logLevel<=Hn.ERROR){let t=e.map($S);Bi.error(`Firestore (${Va}): ${n}`,...t)}}function Ln(n,...e){if(Bi.logLevel<=Hn.WARN){let t=e.map($S);Bi.warn(`Firestore (${Va}): ${n}`,...t)}}function $S(n){if(typeof n=="string")return n;try{return Z3(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${Va}) INTERNAL ASSERTION FAILED: `+n;throw Ge(e),new Error(e)}function $(n,e){n||G()}function Dx(n,e){n||G()}function q(n,e){return n}var D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends y0{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ct=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var mf=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Kw=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(dt.UNAUTHENTICATED))}shutdown(){}},$w=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Ww=class{constructor(e){this.authProvider=e,this.currentUser=dt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){$(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new ct;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new ct,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>_(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ct)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($(typeof r.accessToken=="string"),new mf(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new dt(e)}},Hw=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=dt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Qw=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Hw(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(dt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Yw=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Xw=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){$(this.tokenListener===void 0);let r=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Yw(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function ez(n){if(!n)return new Kw;switch(n.type){case"firstParty":return new Qw(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new N(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function tz(n){return Y3(n)}var gf=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=tz(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ie(n,e){return n<e?-1:n>e?1:0}function Ms(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function Ax(n){return n+"\0"}var yN=-62135596800,vN=1e6,je=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<yN)throw new N(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*vN);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/vN}_compareTo(e){return this.seconds===e.seconds?ie(this.nanoseconds,e.nanoseconds):ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-yN,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var X=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new je(0,0))}static max(){return new n(new je(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var wN="__name__",yf=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},pe=class n extends yf{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new N(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},nz=/^[_a-zA-Z][_a-zA-Z0-9]*$/,tt=class n extends yf{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return nz.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===wN}static keyField(){return new n([wN])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new N(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new N(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new N(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new N(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(pe.fromString(e))}static fromName(e){return new n(pe.fromString(e).popFirst(5))}static empty(){return new n(pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new pe(e.slice()))}};var Sa=-1,rz=0,Jw=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function WS(n){return n.fields.find(e=>e.kind===2)}function Ps(n){return n.fields.filter(e=>e.kind!==2)}function iz(n){let e=Ps(n);return e.length===0?0:e[e.length-1].kind}function sz(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var va=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Pc=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(rz,bn.min())}};function Rx(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new je(t+1,0):new je(t,r));return new bn(i,U.empty(),e)}function Nx(n){return new bn(n.readTime,n.key,Sa)}var bn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(X.min(),U.empty(),Sa)}static max(){return new n(X.max(),U.empty(),Sa)}};function HS(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=U.comparator(n.documentKey,e.documentKey),t!==0)?t:ie(n.largestBatchId,e.largestBatchId)}var xx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vf=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Qi(n){return _(this,null,function*(){if(n.code===D.FAILED_PRECONDITION&&n.message===xx)L("LocalStore","Unexpectedly lost primary lease");else throw n})}var I=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var rn="SimpleDb",oz=3,wf=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new ct,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ks(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=QS(r.target.error);this.completionDeferred.reject(new ks(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ks(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(L(rn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new eb(t)}},Vi=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(Ll())===12.2&&Ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return L(rn,"Removing database:",e),Cs(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!rd())return!1;if(n.isMockPersistence())return!0;let e=Ll(),t=n.getIOSVersion(e),r=0<t&&t<10,i=kx(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return _(this,null,function*(){return this.db||(L(rn,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new ks(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new N(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new N(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ks(e,o))},i.onupgradeneeded=s=>{L(rn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{L(rn,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return _(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=wf.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),I.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<oz;if(L(rn,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function kx(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Zw=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Cs(this.dbCursor.delete())}},ks=class extends N{constructor(e,t){super(D.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Yi(n){return n.name==="IndexedDbTransactionError"}var eb=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(L(rn,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(L(rn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Cs(r)}add(e){L(rn,"ADD",this.store.name,e,e);let t=this.store.add(e);return Cs(t)}get(e){let t=this.store.get(e);return Cs(t).next(r=>(r===void 0&&(r=null),L(rn,"GET",this.store.name,e,r),r))}delete(e){L(rn,"DELETE",this.store.name,e);let t=this.store.delete(e);return Cs(t)}count(){L(rn,"COUNT",this.store.name);let e=this.store.count();return Cs(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new I((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new I((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){L(rn,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new I((r,i)=>{t.onerror=s=>{let o=QS(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new I((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Zw(a),c=t(a.primaryKey,a.value,l);if(c instanceof I){let u=c.catch(m=>(l.done(),I.reject(m)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>I.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Cs(n){return new I((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=QS(r.target.error);t(i)}})}var bN=!1;function QS(n){let e=Vi.getIOSVersion(Ll());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return bN||(bN=!0,setTimeout(()=>{throw r},0)),r}}return n}var Rc="IndexBackfiller",az=15*1e3,lz=60*1e3,cz=50,tb=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(az)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){L(Rc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>_(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();L(Rc,`Documents written: ${t}`)}catch(t){Yi(t)?L(Rc,"Ignoring IndexedDB error during index backfill: ",t):yield Qi(t)}yield this.schedule(lz)}))}},nb=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return _(this,arguments,function*(e=cz){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return I.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return L(Rc,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(L(Rc,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=Nx(s);HS(o,r)>0&&(r=o)}),new bn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var sn=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),wa="",rb="",Ox="",Mx="";function qt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=SN(e)),e=uz(n.get(t),e);return SN(e)}function uz(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=wa+Ox;break;case wa:t+=wa+Mx;break;default:t+=s}}return t}function SN(n){return n+wa+rb}function hr(n){let e=n.length;if($(e>=2),e===2)return $(n.charAt(0)===wa&&n.charAt(1)===rb),pe.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(wa,s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case rb:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case Ox:i+=n.substring(s,o),i+="\0";break;case Mx:i+=n.substring(s,o+1);break;default:G()}s=o+2}return new pe(r)}var Is="remoteDocuments";var su="owner",sa="owner",ou="mutationQueues",dz="userId",Fn="mutations",Px="batchId",Ns="userMutationsIndex",Fx=["userId","batchId"];function hz(n){return[n]}function uf(n,e){return[n,qt(e)]}function Lx(n,e,t){return[n,qt(e),t]}var fz={},Ua="documentMutations",lp="remoteDocumentsV14",pz=["prefixPath","collectionGroup","readTime","documentId"],df="documentKeyIndex",mz=["prefixPath","collectionGroup","documentId"],Bx="collectionGroupIndex",gz=["collectionGroup","readTime","prefixPath","documentId"],au="remoteDocumentGlobal",ib="remoteDocumentGlobalKey",qa="targets",yz="targetId",Vx="queryTargetsIndex",vz=["canonicalId","targetId"],za="targetDocuments",wz=["targetId","path"],YS="documentTargetsIndex",bz=["path","targetId"],bf="targetGlobalKey",Hs="targetGlobal",Fc="collectionParents",Sz=["collectionId","parent"],_a="clientMetadata",_z="clientId",cp="bundles",Tz="bundleId",up="namedQueries",Ez="name",XS="indexConfiguration",Cz="indexId",sb="collectionGroupIndex",Iz="collectionGroup",dp="indexState",Dz=["indexId","uid"],Ux="sequenceNumberIndex",Az=["uid","sequenceNumber"],hp="indexEntries",Rz=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],qx="documentKeyIndex",Nz=["indexId","uid","orderedDocumentKey"],fp="documentOverlays",xz=["userId","collectionPath","documentId"],ob="collectionPathOverlayIndex",kz=["userId","collectionPath","largestBatchId"],zx="collectionGroupOverlayIndex",Oz=["userId","collectionGroup","largestBatchId"],JS="globals",Mz="name",Pz=[ou,Fn,Ua,Is,qa,su,Hs,za],Fz=Pz,Lz=[...Fz,_a],Bz=[...Lz,au],Vz=[...Bz,Fc],Gx=[...Vz,cp,up],Uz=[...Gx,fp],jx=[ou,Fn,Ua,lp,qa,su,Hs,za,_a,au,Fc,cp,up,fp],Kx=jx,ZS=[...Kx,XS,dp,hp],qz=ZS,zz=[...ZS,JS];function Gz(n){if(n===17)return zz;if(n===16)return qz;if(n===15)return ZS;if(n===14)return Kx;if(n===13)return jx;if(n===12)return Uz;if(n===11)return Gx;G()}var Lc=class extends vf{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function pt(n,e){let t=q(n);return Vi.getStore(t.simpleDbTransaction,e)}function _N(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Qs(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $x(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Me=class n{constructor(e,t){this.comparator=e,this.root=t||Nc.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Nc.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Nc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ga(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ga(this.root,e,this.comparator,!1)}getReverseIterator(){return new ga(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ga(this.root,e,this.comparator,!0)}},ga=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Nc=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let t=this.left.check();if(t!==this.right.check())throw G();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),ab=class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Nc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Nc.EMPTY=new ab;var Ae=class n{constructor(e){this.comparator=e,this.data=new Me(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Sf(this.data.getIterator())}getIteratorFrom(e){return new Sf(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Sf=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function jz(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=oa(s),l=oa(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let m=t(a,l);m<0?u=!0:m>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=oa(o)):u?(i(a),a=oa(s)):(a=oa(s),l=oa(o))}}function oa(n){return n.hasNext()?n.getNext():void 0}var on=class n{constructor(e){this.fields=e,e.sort(tt.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ae(tt.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ms(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function Kz(n){return Buffer.from(n,"base64").toString("binary")}function $z(n){return Buffer.from(n,"binary").toString("base64")}function Wx(){return!0}var nt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=Kz(e);return new n(t)}static fromUint8Array(e){let t=Wz(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return $z(this.binaryString)}toUint8Array(){return Hz(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};nt.EMPTY_BYTE_STRING=new nt("");function Wz(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function Hz(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var Qz=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pr(n){if($(!!n),typeof n=="string"){let e=0,t=Qz.exec(n);if($(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Be(n.seconds),t=Be(n.nanos);return{seconds:e,nanos:t}}}function Be(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ui(n){return typeof n=="string"?nt.fromBase64String(n):nt.fromUint8Array(n)}var Hx="server_timestamp",Qx="__type__",Yx="__previous_value__",Xx="__local_write_time__";function pp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Qx])===null||t===void 0?void 0:t.stringValue)===Hx}function Yz(n,e){let t={fields:{[Qx]:{stringValue:Hx},[Xx]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&pp(e)&&(e=e_(e)),e&&(t.fields[Yx]=e),{mapValue:t}}function e_(n){let e=n.mapValue.fields[Yx];return pp(e)?e_(e):e}function Bc(n){let e=Pr(n.mapValue.fields[Xx].timestampValue);return new je(e.seconds,e.nanos)}var lb=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},TN="(default)",qi=class n{constructor(e,t){this.projectId=e,this.database=t||TN}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===TN}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function Xz(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new N(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qi(n.options.projectId,e)}var Li=-1;function lu(n){return n==null}function Vc(n){return n===0&&1/n===-1/0}function Jx(n){return typeof n=="number"&&Number.isInteger(n)&&!Vc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var t_="__type__",Zx="__max__",Pi={mapValue:{fields:{__type__:{stringValue:Zx}}}},n_="__vector__",Ta="value",hf={nullValue:"NULL_VALUE"};function Fs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?pp(n)?4:tk(n)?9007199254740991:mp(n)?10:11:G()}function Bn(n,e){if(n===e)return!0;let t=Fs(n),r=Fs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bc(n).isEqual(Bc(e));case 3:return Jz(n,e);case 5:return n.stringValue===e.stringValue;case 6:return e9(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return Zz(n,e);case 2:return t9(n,e);case 9:return Ms(n.arrayValue.values||[],e.arrayValue.values||[],Bn);case 10:case 11:return n9(n,e);case 9007199254740991:return!0;default:return G()}}function Jz(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Pr(n.timestampValue),r=Pr(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function Zz(n,e){return Be(n.geoPointValue.latitude)===Be(e.geoPointValue.latitude)&&Be(n.geoPointValue.longitude)===Be(e.geoPointValue.longitude)}function e9(n,e){return Ui(n.bytesValue).isEqual(Ui(e.bytesValue))}function t9(n,e){if("integerValue"in n&&"integerValue"in e)return Be(n.integerValue)===Be(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Be(n.doubleValue),r=Be(e.doubleValue);return t===r?Vc(t)===Vc(r):isNaN(t)&&isNaN(r)}return!1}function n9(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(_N(t)!==_N(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Bn(t[i],r[i])))return!1;return!0}function Uc(n,e){return(n.values||[]).find(t=>Bn(t,e))!==void 0}function zi(n,e){if(n===e)return 0;let t=Fs(n),r=Fs(e);if(t!==r)return ie(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ie(n.booleanValue,e.booleanValue);case 2:return r9(n,e);case 3:return EN(n.timestampValue,e.timestampValue);case 4:return EN(Bc(n),Bc(e));case 5:return ie(n.stringValue,e.stringValue);case 6:return o9(n.bytesValue,e.bytesValue);case 7:return i9(n.referenceValue,e.referenceValue);case 8:return s9(n.geoPointValue,e.geoPointValue);case 9:return ek(n.arrayValue,e.arrayValue);case 10:return a9(n.mapValue,e.mapValue);case 11:return l9(n.mapValue,e.mapValue);default:throw G()}}function r9(n,e){let t=Be(n.integerValue||n.doubleValue),r=Be(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function EN(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ie(n,e);let t=Pr(n),r=Pr(e),i=ie(t.seconds,r.seconds);return i!==0?i:ie(t.nanos,r.nanos)}function i9(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ie(t[i],r[i]);if(s!==0)return s}return ie(t.length,r.length)}function s9(n,e){let t=ie(Be(n.latitude),Be(e.latitude));return t!==0?t:ie(Be(n.longitude),Be(e.longitude))}function o9(n,e){let t=Ui(n),r=Ui(e);return t.compareTo(r)}function ek(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=zi(t[i],r[i]);if(s)return s}return ie(t.length,r.length)}function a9(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Ta])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Ta])===null||r===void 0?void 0:r.arrayValue,u=ie(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:ek(l,c)}function l9(n,e){if(n===Pi.mapValue&&e===Pi.mapValue)return 0;if(n===Pi.mapValue)return 1;if(e===Pi.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ie(r[o],s[o]);if(a!==0)return a;let l=zi(t[r[o]],i[s[o]]);if(l!==0)return l}return ie(r.length,s.length)}function Ea(n){return r_(n)}function r_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?u9(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?c9(n.bytesValue):"referenceValue"in n?h9(n.referenceValue):"geoPointValue"in n?d9(n.geoPointValue):"arrayValue"in n?p9(n.arrayValue):"mapValue"in n?f9(n.mapValue):G()}function c9(n){return Ui(n).toBase64()}function u9(n){let e=Pr(n);return`time(${e.seconds},${e.nanos})`}function d9(n){return`geo(${n.latitude},${n.longitude})`}function h9(n){return U.fromName(n).toString()}function f9(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${r_(n.fields[i])}`;return t+"}"}function p9(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=r_(r);return e+"]"}function Ls(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function cb(n){return!!n&&"integerValue"in n}function m9(n){return!!n&&"doubleValue"in n}function g9(n){return cb(n)||m9(n)}function qc(n){return!!n&&"arrayValue"in n}function CN(n){return!!n&&"nullValue"in n}function IN(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ff(n){return!!n&&"mapValue"in n}function mp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[t_])===null||t===void 0?void 0:t.stringValue)===n_}function xc(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Qs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xc(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xc(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function tk(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Zx}var nk={mapValue:{fields:{[t_]:{stringValue:n_},[Ta]:{arrayValue:{}}}}};function y9(n){return"nullValue"in n?hf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ls(qi.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?mp(n)?nk:{mapValue:{}}:G()}function v9(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ls(qi.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?nk:"mapValue"in n?mp(n)?{mapValue:{}}:Pi:G()}function DN(n,e){let t=zi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function AN(n,e){let t=zi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var kt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ff(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=xc(t)}setAll(e){let t=tt.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=xc(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ff(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Bn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!ff(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Qs(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(xc(this.value))}};function rk(n){let e=[];return Qs(n.fields,(t,r)=>{let i=new tt([t]);if(ff(r)){let o=rk(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new on(e)}var ut=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,X.min(),X.min(),X.min(),kt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,X.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,X.min(),X.min(),kt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,X.min(),X.min(),kt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(X.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function w9(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?zi(r,i):G()}var gr=class{constructor(e,t){this.position=e,this.inclusive=t}};function ik(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=U.comparator(U.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=zi(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function b9(n,e,t){let r=ik(n,e,t);return n.inclusive?r>=0:r>0}function S9(n,e,t){let r=ik(n,e,t);return n.inclusive?r<=0:r<0}function RN(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Bn(r,i))return!1}return!0}var Bs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function _9(n){return n.field.canonicalString()+n.dir}function T9(n){return`${n.field.canonicalString()} (${n.dir})`}function E9(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var _f=class{},de=class n extends _f{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new hb(e,t,r):t==="array-contains"?new mb(e,r):t==="in"?new Tf(e,r):t==="not-in"?new gb(e,r):t==="array-contains-any"?new yb(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new fb(e,r):new pb(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(zi(t,this.value)):t!==null&&Fs(this.value)===Fs(t)&&this.matchesComparison(zi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ie=class n extends _f{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Ca(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Ca(n){return n.op==="and"}function ub(n){return n.op==="or"}function i_(n){return sk(n)&&Ca(n)}function sk(n){for(let e of n.filters)if(e instanceof Ie)return!1;return!0}function db(n){if(n instanceof de)return n.field.canonicalString()+n.op.toString()+Ea(n.value);if(i_(n))return n.filters.map(e=>db(e)).join(",");{let e=n.filters.map(t=>db(t)).join(",");return`${n.op}(${e})`}}function ok(n,e){if(n instanceof de)return C9(n,e);if(n instanceof Ie)return I9(n,e);G()}function C9(n,e){return e instanceof de&&n.op===e.op&&n.field.isEqual(e.field)&&Bn(n.value,e.value)}function I9(n,e){return e instanceof Ie&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&ok(i,e.filters[s]),!0):!1}function ak(n,e){let t=n.filters.concat(e);return Ie.create(t,n.op)}function lk(n){return n instanceof de?A9(n):n instanceof Ie?D9(n):"Filter"}function D9(n){return n.op.toString()+" {"+n.getFilters().map(lk).join(" ,")+"}"}function A9(n){return`${n.field.canonicalString()} ${n.op} ${Ea(n.value)}`}var hb=class extends de{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},fb=class extends de{constructor(e,t){super(e,"in",t),this.keys=ck("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},pb=class extends de{constructor(e,t){super(e,"not-in",t),this.keys=ck("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function ck(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var mb=class extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return qc(t)&&Uc(t.arrayValue,this.value)}},Tf=class extends de{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Uc(this.value.arrayValue,t)}},gb=class extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(Uc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Uc(this.value.arrayValue,t)}},yb=class extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!qc(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Uc(this.value.arrayValue,r))}};var vb=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function wb(n,e=null,t=[],r=[],i=null,s=null,o=null){return new vb(n,e,t,r,i,s,o)}function Vs(n){let e=q(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>db(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>_9(r)).join(","),lu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ea(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ea(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function R9(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>lk(t)).join(", ")}]`),lu(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>T9(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ea(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ea(t)).join(",")),`Target(${e})`}function cu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!E9(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ok(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!RN(n.startAt,e.startAt)?!1:RN(n.endAt,e.endAt)}function Ef(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function gp(n,e){return n.filters.filter(t=>t instanceof de&&t.field.isEqual(e))}function N9(n,e){let t=WS(e);if(t===void 0)return null;for(let r of gp(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function x9(n,e){let t=new Map;for(let r of Ps(e))for(let i of gp(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function k9(n,e){let t=[],r=!0;for(let i of Ps(e)){let s=i.kind===0?uk(n,i.fieldPath,n.startAt):dk(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new gr(t,r)}function O9(n,e){let t=[],r=!0;for(let i of Ps(e)){let s=i.kind===0?dk(n,i.fieldPath,n.endAt):uk(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new gr(t,r)}function uk(n,e,t){let r=hf,i=!0;for(let s of gp(n,e)){let o=hf,a=!0;switch(s.op){case"<":case"<=":o=y9(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=hf;break}DN({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];DN({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function dk(n,e,t){let r=Pi,i=!0;for(let s of gp(n,e)){let o=Pi,a=!0;switch(s.op){case">=":case">":o=v9(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Pi;break}AN({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];AN({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function M9(n){let e=new Ae(tt.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function P9(n){return n.limit!==null}var Vn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function hk(n,e,t,r,i,s,o,a){return new Vn(n,e,t,r,i,s,o,a)}function Ga(n){return new Vn(n)}function F9(n,e){return new Vn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function NN(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function L9(n){let e=new Ae(tt.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function B9(n){return new Vn(pe.emptyPath(),n)}function V9(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function s_(n){return n.collectionGroup!==null}function Ia(n){let e=q(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";L9(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Bs(s,r))}),t.has(tt.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Bs(tt.keyField(),r))}return e.memoizedNormalizedOrderBy}function zt(n){let e=q(n);return e.memoizedTarget||(e.memoizedTarget=U9(e,Ia(n))),e.memoizedTarget}function U9(n,e){if(n.limitType==="F")return wb(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Bs(i.field,s)});let t=n.endAt?new gr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new gr(n.startAt.position,n.startAt.inclusive):null;return wb(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function o_(n,e){let t=n.filters.concat([e]);return new Vn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function q9(n,e){let t=n.explicitOrderBy.concat([e]);return new Vn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function Cf(n,e,t){return new Vn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function z9(n,e){return new Vn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function G9(n,e){return new Vn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function uu(n,e){return cu(zt(n),zt(e))&&n.limitType===e.limitType}function fk(n){return`${Vs(zt(n))}|lt:${n.limitType}`}function fa(n){return`Query(target=${R9(zt(n))}; limitType=${n.limitType})`}function du(n,e){return e.isFoundDocument()&&j9(n,e)&&K9(n,e)&&$9(n,e)&&W9(n,e)}function j9(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):U.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function K9(n,e){for(let t of Ia(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function $9(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function W9(n,e){return!(n.startAt&&!S9(n.startAt,Ia(n),e)||n.endAt&&!b9(n.endAt,Ia(n),e))}function pk(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function mk(n){return(e,t)=>{let r=!1;for(let i of Ia(n)){let s=H9(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function H9(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):w9(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var yr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Qs(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return $x(this.inner)}size(){return this.innerSize}};var Q9=new Me(U.comparator);function Jt(){return Q9}var gk=new Me(U.comparator);function Dc(...n){let e=gk;for(let t of n)e=e.insert(t.key,t);return e}function Y9(){return zc()}function yk(n){let e=gk;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function fr(){return zc()}function vk(){return zc()}function zc(){return new yr(n=>n.toString(),(n,e)=>n.isEqual(e))}var X9=new Me(U.comparator);function J9(){return X9}var Z9=new Ae(U.comparator);function ae(...n){let e=Z9;for(let t of n)e=e.add(t);return e}var e6=new Ae(ie);function a_(){return e6}function l_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vc(e)?"-0":e}}function wk(n){return{integerValue:""+n}}function bk(n,e){return Jx(e)?wk(e):l_(n,e)}var Da=class{constructor(){this._=void 0}};function t6(n,e,t){return n instanceof Gi?Yz(t,e):n instanceof Fr?_k(n,e):n instanceof Lr?Tk(n,e):i6(n,e)}function n6(n,e,t){return n instanceof Fr?_k(n,e):n instanceof Lr?Tk(n,e):t}function Sk(n,e){return n instanceof ji?g9(e)?e:{integerValue:0}:null}function r6(n,e){return n instanceof Fr&&e instanceof Fr||n instanceof Lr&&e instanceof Lr?Ms(n.elements,e.elements,Bn):n instanceof ji&&e instanceof ji?Bn(n.operand,e.operand):n instanceof Gi&&e instanceof Gi}var Gi=class extends Da{},Fr=class extends Da{constructor(e){super(),this.elements=e}};function _k(n,e){let t=Ek(e);for(let r of n.elements)t.some(i=>Bn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Lr=class extends Da{constructor(e){super(),this.elements=e}};function Tk(n,e){let t=Ek(e);for(let r of n.elements)t=t.filter(i=>!Bn(i,r));return{arrayValue:{values:t}}}var ji=class extends Da{constructor(e,t){super(),this.serializer=e,this.operand=t}};function i6(n,e){let t=Sk(n,e),r=xN(t)+xN(n.operand);return cb(t)&&cb(n.operand)?wk(r):l_(n.serializer,r)}function xN(n){return Be(n.integerValue||n.doubleValue)}function Ek(n){return qc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Us=class{constructor(e,t){this.field=e,this.transform=t}};function s6(n,e){return n.field.isEqual(e.field)&&r6(n.transform,e.transform)}function o6(n,e){return n===void 0&&e===void 0?!0:n&&e?Ms(n,e,(t,r)=>s6(t,r)):!1}var bb=class{constructor(e,t){this.version=e,this.transformResults=t}},Qe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function yp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Aa=class{};function Ck(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new $i(n.key,Qe.none()):new Ki(n.key,n.data,Qe.none());{let t=n.data,r=kt.empty(),i=new Ae(tt.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Un(n.key,r,new on(i.toArray()),Qe.none())}}function a6(n,e,t){n instanceof Ki?c6(n,e,t):n instanceof Un?d6(n,e,t):f6(n,e,t)}function kc(n,e,t,r){return n instanceof Ki?u6(n,e,t,r):n instanceof Un?h6(n,e,t,r):p6(n,e,t)}function l6(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=Sk(r.transform,i||null);s!=null&&(t===null&&(t=kt.empty()),t.set(r.field,s))}return t||null}function kN(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!o6(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ki=class extends Aa{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function c6(n,e,t){let r=n.value.clone(),i=Dk(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function u6(n,e,t,r){if(!yp(n.precondition,e))return t;let i=n.value.clone(),s=Ak(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Un=class extends Aa{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function d6(n,e,t){if(!yp(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=Dk(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(Ik(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function h6(n,e,t,r){if(!yp(n.precondition,e))return t;let i=Ak(n.fieldTransforms,r,e),s=e.data;return s.setAll(Ik(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function Ik(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Dk(n,e,t){let r=new Map;$(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,n6(o,a,t[i]))}return r}function Ak(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,t6(s,o,e))}return r}var $i=class extends Aa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function f6(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function p6(n,e,t){return yp(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Gc=class extends Aa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var jc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];a6(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=kc(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=kc(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=vk();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=Ck(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(X.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ae())}isEqual(e){return this.batchId===e.batchId&&Ms(this.mutations,e.mutations,(t,r)=>kN(t,r))&&Ms(this.baseMutations,e.baseMutations,(t,r)=>kN(t,r))}},Sb=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){$(e.mutations.length===r.length);let i=J9(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Kc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var _b=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var wt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(wt||{});function Rk(n){switch(n){case D.OK:return G();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return G()}}function m6(n){return Rk(n)&&n!==D.ABORTED}function pf(n){if(n===void 0)return Ge("GRPC error has no .code"),D.UNKNOWN;switch(n){case wt.OK:return D.OK;case wt.CANCELLED:return D.CANCELLED;case wt.UNKNOWN:return D.UNKNOWN;case wt.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case wt.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case wt.INTERNAL:return D.INTERNAL;case wt.UNAVAILABLE:return D.UNAVAILABLE;case wt.UNAUTHENTICATED:return D.UNAUTHENTICATED;case wt.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case wt.NOT_FOUND:return D.NOT_FOUND;case wt.ALREADY_EXISTS:return D.ALREADY_EXISTS;case wt.PERMISSION_DENIED:return D.PERMISSION_DENIED;case wt.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case wt.ABORTED:return D.ABORTED;case wt.OUT_OF_RANGE:return D.OUT_OF_RANGE;case wt.UNIMPLEMENTED:return D.UNIMPLEMENTED;case wt.DATA_LOSS:return D.DATA_LOSS;default:return G()}}var Tb=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Mw=null;function Nk(){return new H3}function g6(){return new Q3("utf-8")}var y6=new ri([4294967295,4294967295],0);function ON(n){let e=Nk().encode(n),t=new mg;return t.update(e),new Uint8Array(t.digest())}function MN(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new ri([t,r],0),a=new ri([i,s],0);return[o,a]}var Eb=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new xs(`Invalid padding: ${t}`);if(r<0)throw new xs(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new xs(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new xs(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=ri.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(ri.fromNumber(r)));return i.compare(y6)===1&&(i=new ri([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=ON(e),[r,i]=MN(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=ON(e),[r,i]=MN(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},xs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var $c=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Wc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(X.min(),i,new Me(ie),Jt(),ae())}},Wc=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ae(),ae(),ae())}};var ba=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},If=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Df=class{constructor(e,t,r=nt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Af=class{constructor(){this.pendingResponses=0,this.documentChanges=FN(),this._resumeToken=nt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ae(),t=ae(),r=ae();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new Wc(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=FN()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,$(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},v6="WatchChangeAggregator",Cb=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Jt(),this.pendingDocumentTargetMapping=PN(),this.pendingTargetResets=new Me(ie)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(Ef(s))if(r===0){let o=new U(s.path);this.removeDocumentFromTarget(t,o,ut.newNoDocument(o,X.min()))}else $(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Mw?.notifyOnExistenceFilterMismatch(w6(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ui(r).toUint8Array()}catch(l){if(l instanceof Tb)return Ln("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new Eb(o,i,s)}catch(l){return l instanceof xs?Ln("BloomFilter error: ",l):Ln("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&Ef(a.target)){let l=new U(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,ut.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=ae();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new $c(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Jt(),this.pendingDocumentTargetMapping=PN(),this.pendingTargetResets=new Me(ie),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Af,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Ae(ie),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||L(v6,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Af),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function PN(){return new Me(U.comparator)}function FN(){return new Me(U.comparator)}function w6(n,e,t,r,i){var s,o,a,l,c,u;let m={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},g=e.unchangedNames;return g&&(m.bloomFilter={applied:i===0,hashCount:(s=g?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=g?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=g?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:S=>{var T;return(T=r?.mightContain(S))!==null&&T!==void 0?T:!1}}),m}var b6=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),S6=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),_6=(()=>{let n={};return n.and="AND",n.or="OR",n})();var Ib=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function T6(n){let e=n.code===void 0?D.UNKNOWN:pf(n.code);return new N(e,n.message||"")}function Db(n,e){return n.useProto3Json||lu(e)?e:{value:e}}function E6(n){let e;return typeof n=="object"?e=n.value:e=n,lu(e)?null:e}function Ra(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function C6(n){let e=Pr(n);return new je(e.seconds,e.nanos)}function xk(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function I6(n,e){return n.useProto3Json?($(e===void 0||typeof e=="string"),nt.fromBase64String(e||"")):($(e===void 0||e instanceof Buffer||e instanceof Uint8Array),nt.fromUint8Array(e||new Uint8Array))}function D6(n,e){return Ra(n,e.toTimestamp())}function et(n){return $(!!n),X.fromTimestamp(C6(n))}function c_(n,e){return Ab(n,e).canonicalString()}function Ab(n,e){let t=A6(n).child("documents");return e===void 0?t:t.child(e)}function kk(n){let e=pe.fromString(n);return $(zk(e)),e}function Hc(n,e){return c_(n.databaseId,e.path)}function pr(n,e){let t=kk(e);if(t.get(1)!==n.databaseId.projectId)throw new N(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(Pk(t))}function Ok(n,e){return c_(n.databaseId,e)}function Mk(n){let e=kk(n);return e.length===4?pe.emptyPath():Pk(e)}function Rb(n){return new pe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function A6(n){return new pe(["projects",n.projectId,"databases",n.database])}function Pk(n){return $(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function LN(n,e,t){return{name:Hc(n,e),fields:t.value.mapValue.fields}}function R6(n,e){return{name:Hc(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Ra(n,e.version.toTimestamp()),createTime:Ra(n,e.createTime.toTimestamp())}}function Fk(n,e,t){let r=pr(n,e.name),i=et(e.updateTime),s=e.createTime?et(e.createTime):X.min(),o=new kt({mapValue:{fields:e.fields}}),a=ut.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function N6(n,e){$(!!e.found),e.found.name,e.found.updateTime;let t=pr(n,e.found.name),r=et(e.found.updateTime),i=e.found.createTime?et(e.found.createTime):X.min(),s=new kt({mapValue:{fields:e.found.fields}});return ut.newFoundDocument(t,r,i,s)}function x6(n,e){$(!!e.missing),$(!!e.readTime);let t=pr(n,e.missing),r=et(e.readTime);return ut.newNoDocument(t,r)}function k6(n,e){return"found"in e?N6(n,e):"missing"in e?x6(n,e):G()}function O6(n,e){let t;if("targetChange"in e){e.targetChange;let r=M6(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=I6(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&T6(o);t=new Df(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=pr(n,r.document.name),s=et(r.document.updateTime),o=r.document.createTime?et(r.document.createTime):X.min(),a=new kt({mapValue:{fields:r.document.fields}}),l=ut.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new ba(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=pr(n,r.document),s=r.readTime?et(r.readTime):X.min(),o=ut.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ba([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=pr(n,r.document),s=r.removedTargetIds||[];t=new ba([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new _b(i,s),a=r.targetId;t=new If(a,o)}else return G();return t}function M6(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:G()}function P6(n){if(!("targetChange"in n))return X.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?X.min():et(e.readTime)}function Qc(n,e){let t;if(e instanceof Ki)t={update:LN(n,e.key,e.value)};else if(e instanceof $i)t={delete:Hc(n,e.key)};else if(e instanceof Un)t={update:LN(n,e.key,e.data),updateMask:pG(e.fieldMask)};else if(e instanceof Gc)t={verify:Hc(n,e.key)};else return G();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>U6(n,r))),e.precondition.isNone||(t.currentDocument=F6(n,e.precondition)),t}function Nb(n,e){let t=e.currentDocument?L6(e.currentDocument):Qe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>q6(n,i)):[];if(e.update){e.update.name;let i=pr(n,e.update.name),s=new kt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=mG(e.updateMask);return new Un(i,s,o,t,r)}else return new Ki(i,s,t,r)}else if(e.delete){let i=pr(n,e.delete);return new $i(i,t)}else if(e.verify){let i=pr(n,e.verify);return new Gc(i,t)}else return G()}function F6(n,e){return e.updateTime!==void 0?{updateTime:D6(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:G()}function L6(n){return n.updateTime!==void 0?Qe.updateTime(et(n.updateTime)):n.exists!==void 0?Qe.exists(n.exists):Qe.none()}function B6(n,e){let t=n.updateTime?et(n.updateTime):et(e);return t.isEqual(X.min())&&(t=et(e)),new bb(t,n.transformResults||[])}function V6(n,e){return n&&n.length>0?($(e!==void 0),n.map(t=>B6(t,e))):[]}function U6(n,e){let t=e.transform;if(t instanceof Gi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Fr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Lr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ji)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw G()}function q6(n,e){let t=null;if("setToServerValue"in e)$(e.setToServerValue==="REQUEST_TIME"),t=new Gi;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Fr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Lr(i)}else"increment"in e?t=new ji(n,e.increment):G();let r=tt.fromServerFormat(e.fieldPath);return new Us(r,t)}function Lk(n,e){return{documents:[Ok(n,e.path)]}}function z6(n){let e=n.documents.length;$(e===1);let t=n.documents[0];return zt(Ga(Mk(t)))}function Bk(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Ok(n,i);let s=W6(e.filters);s&&(t.structuredQuery.where=s);let o=Q6(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Db(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=X6(e.startAt)),e.endAt&&(t.structuredQuery.endAt=J6(e.endAt)),{queryTarget:t,parent:i}}function Vk(n){let e=Mk(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){$(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=H6(t.where));let o=[];t.orderBy&&(o=Y6(t.orderBy));let a=null;t.limit&&(a=E6(t.limit));let l=null;t.startAt&&(l=Z6(t.startAt));let c=null;return t.endAt&&(c=eG(t.endAt)),hk(e,i,o,s,a,"F",l,c)}function G6(n){return zt(Vk(n))}function j6(n,e){let t=K6(e.purpose);return t==null?null:{"goog-listen-tags":t}}function K6(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}function $6(n,e){let t,r=e.target;if(Ef(r)?t={documents:Lk(n,r)}:t={query:Bk(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=xk(n,e.resumeToken);let i=Db(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(X.min())>0){t.readTime=Ra(n,e.snapshotVersion.toTimestamp());let i=Db(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function W6(n){if(n.length!==0)return qk(Ie.create(n,"and"))}function H6(n){let e=Uk(n);return e instanceof Ie&&i_(e)?e.getFilters():[e]}function Uk(n){return n.unaryFilter!==void 0?dG(n):n.fieldFilter!==void 0?hG(n):n.compositeFilter!==void 0?fG(n):G()}function Q6(n){if(n.length!==0)return n.map(e=>aG(e))}function Y6(n){return n.map(e=>lG(e))}function X6(n){return{before:n.inclusive,values:n.position}}function J6(n){return{before:!n.inclusive,values:n.position}}function Z6(n){let e=!!n.before,t=n.values||[];return new gr(t,e)}function eG(n){let e=!n.before,t=n.values||[];return new gr(t,e)}function tG(n){return b6[n]}function nG(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function rG(n){return S6[n]}function iG(n){return _6[n]}function sG(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function oG(n){switch(n){case"AND":return"and";case"OR":return"or";default:return G()}}function pa(n){return{fieldPath:n.canonicalString()}}function ya(n){return tt.fromServerFormat(n.fieldPath)}function aG(n){return{field:pa(n.field),direction:tG(n.dir)}}function lG(n){return new Bs(ya(n.field),nG(n.direction))}function qk(n){return n instanceof de?uG(n):n instanceof Ie?cG(n):G()}function cG(n){let e=n.getFilters().map(t=>qk(t));return e.length===1?e[0]:{compositeFilter:{op:iG(n.op),filters:e}}}function uG(n){if(n.op==="=="){if(IN(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NAN"}};if(CN(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(IN(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NOT_NAN"}};if(CN(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pa(n.field),op:rG(n.op),value:n.value}}}function dG(n){switch(n.unaryFilter.op){case"IS_NAN":let e=ya(n.unaryFilter.field);return de.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=ya(n.unaryFilter.field);return de.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ya(n.unaryFilter.field);return de.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ya(n.unaryFilter.field);return de.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function hG(n){return de.create(ya(n.fieldFilter.field),sG(n.fieldFilter.op),n.fieldFilter.value)}function fG(n){return Ie.create(n.compositeFilter.filters.map(e=>Uk(e)),oG(n.compositeFilter.op))}function pG(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function mG(n){let e=n.fieldPaths||[];return new on(e.map(t=>tt.fromServerFormat(t)))}function zk(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Na=class n{constructor(e,t,r,i,s=X.min(),o=X.min(),a=nt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Rf=class{constructor(e){this.remoteSerializer=e}};function gG(n,e){let t;if(e.document)t=Fk(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=zs(e.noDocument.readTime);t=ut.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=U.fromSegments(e.unknownDocument.path),i=zs(e.unknownDocument.version);t=ut.newUnknownDocument(r,i)}else return G();return e.readTime&&t.setReadTime(yG(e.readTime)),t}function BN(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:vp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=R6(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:qs(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:qs(e.version)};else return G();return r}function vp(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function yG(n){let e=new je(n[0],n[1]);return X.fromTimestamp(e)}function qs(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zs(n){let e=new je(n.seconds,n.nanoseconds);return X.fromTimestamp(e)}function vG(n,e,t){let r=t.baseMutations.map(s=>Qc(n.remoteSerializer,s)),i=t.mutations.map(s=>Qc(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Ds(n,e){let t=(e.baseMutations||[]).map(s=>Nb(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Nb(n.remoteSerializer,s)),i=je.fromMillis(e.localWriteTimeMs);return new jc(e.batchId,i,t,r)}function Ac(n){let e=zs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?zs(n.lastLimboFreeSnapshotVersion):X.min(),r;return wG(n.query)?r=z6(n.query):r=G6(n.query),new Na(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,nt.fromBase64String(n.resumeToken))}function Gk(n,e){let t=qs(e.snapshotVersion),r=qs(e.lastLimboFreeSnapshotVersion),i;Ef(e.target)?i=Lk(n.remoteSerializer,e.target):i=Bk(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Vs(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function wG(n){return n.documents!==void 0}function bG(n){return{id:n.bundleId,createTime:zs(n.createTime),version:n.version}}function SG(n){return{bundleId:n.id,createTime:qs(et(n.createTime)),version:n.version}}function _G(n){return{name:n.name,query:u_(n.bundledQuery),readTime:zs(n.readTime)}}function TG(n){return{name:n.name,readTime:qs(et(n.readTime)),bundledQuery:n.bundledQuery}}function u_(n){let e=Vk({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Cf(e,e.limit,"L"):e}function EG(n){return{name:n.name,query:u_(n.bundledQuery),readTime:et(n.readTime)}}function CG(n){return{id:n.id,version:n.version,createTime:et(n.createTime)}}function Pw(n,e){return new Kc(e.largestBatchId,Nb(n.remoteSerializer,e.overlayMutation))}function IG(n,e,t){let[r,i,s]=jk(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Qc(n.remoteSerializer,t.mutation)}}function jk(n,e){let t=e.path.lastSegment(),r=qt(e.path.popLast());return[n,r,t]}function DG(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function AG(n,e){let t=e?new Pc(e.sequenceNumber,new bn(zs(e.readTime),new U(hr(e.documentKey)),e.largestBatchId)):Pc.empty(),r=n.fields.map(([i,s])=>new va(tt.fromServerFormat(i),s));return new Jw(n.indexId,n.collectionGroup,r,t)}function VN(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:qs(r.readTime),documentKey:qt(r.documentKey.path),largestBatchId:r.largestBatchId}}var xb=class{getBundleMetadata(e,t){return UN(e).get(t).next(r=>{if(r)return bG(r)})}saveBundleMetadata(e,t){return UN(e).put(SG(t))}getNamedQuery(e,t){return qN(e).get(t).next(r=>{if(r)return _G(r)})}saveNamedQuery(e,t){return qN(e).put(TG(t))}};function UN(n){return pt(n,cp)}function qN(n){return pt(n,up)}var Nf=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Tc(e).get(jk(this.userId,t)).next(r=>r?Pw(this.serializer,r):null)}getOverlays(e,t){let r=fr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Kc(t,o);i.push(this.saveOverlay(e,a))}),I.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(qt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Tc(e).deleteAll(ob,a))}),I.waitFor(s)}getOverlaysForCollection(e,t,r){let i=fr(),s=qt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Tc(e).loadAll(ob,o).next(a=>{for(let l of a){let c=Pw(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=fr(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Tc(e).iterate({index:zx,range:a},(l,c,u)=>{let m=Pw(this.serializer,c);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Tc(e).put(IG(this.serializer,this.userId,t))}};function Tc(n){return pt(n,fp)}var kb=class{globalsStore(e){return pt(e,JS)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?nt.fromUint8Array(i):nt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var RG=5,NG=10,xG=13,Fw=15,kG=20,OG=25,MG=30,PG=37,FG=45,LG=50,BG=53,VG=55,UG=60,qG=2,Mr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,RG);else if("booleanValue"in e)this.writeValueTypeLabel(t,NG),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Fw),t.writeNumber(Be(e.integerValue));else if("doubleValue"in e){let r=Be(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,xG):(this.writeValueTypeLabel(t,Fw),Vc(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,kG),typeof r=="string"&&(r=Pr(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,MG),t.writeBytes(Ui(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,FG),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?tk(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):mp(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):G()}writeIndexString(e,t){this.writeValueTypeLabel(t,OG),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,VG);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,BG);let o=Ta,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,Fw),t.writeNumber(Be(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,LG);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,PG),U.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,UG),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(qG)}};Mr.INSTANCE=new Mr;var zN="\uD800",GN="\uDBFF",aa=0,jN=255,KN=1,la=255,$N=255,WN=0,zG=64,GG=8,jG=1024;function KG(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function $G(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function WG(n){let e=0;for(let t=0;t<8;++t){let r=$G(n[t]&255);if(e+=r,r!==8)break}return e}function HN(n){let e=zG-WG(n);return Math.ceil(e/GG)}var Ob=class{constructor(){this.buffer=new Uint8Array(jG),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<zN||GN<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<zN||GN<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=HN(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=HN(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(la),this.writeEscapedByteAscending($N)}writeInfinityDescending(){this.writeEscapedByteDescending(la),this.writeEscapedByteDescending($N)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=KG(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===aa?(this.writeEscapedByteAscending(aa),this.writeEscapedByteAscending(jN)):t===la?(this.writeEscapedByteAscending(la),this.writeEscapedByteAscending(WN)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===aa?(this.writeEscapedByteDescending(aa),this.writeEscapedByteDescending(jN)):t===la?(this.writeEscapedByteDescending(la),this.writeEscapedByteDescending(WN)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(aa),this.writeEscapedByteAscending(KN)}writeSeparatorDescending(){this.writeEscapedByteDescending(aa),this.writeEscapedByteDescending(KN)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Mb=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Pb=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},As=class{constructor(){this.orderedCode=new Ob,this.ascending=new Mb(this.orderedCode),this.descending=new Pb(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Rs=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function xi(n,e){let t=n.indexId-e.indexId;return t!==0||(t=QN(n.arrayValue,e.arrayValue),t!==0)||(t=QN(n.directionalValue,e.directionalValue),t!==0)?t:U.comparator(n.documentKey,e.documentKey)}function QN(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var xf=class{constructor(e){this.inequalityFilters=new Ae((t,r)=>tt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if($(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=WS(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=Ps(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Ae(tt.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new va(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new va(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new va(r.field,r.dir==="asc"?0:1)));return new Jw(Jw.UNKNOWN_ID,this.collectionId,t,Pc.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function Kk(n){var e,t;if($(n instanceof de||n instanceof Ie),n instanceof de)if(n instanceof Tf){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>de.create(n.field,"==",s)))||[];return Ie.create(i,"or")}else return n;let r=n.filters.map(i=>Kk(i));return Ie.create(r,n.op)}function HG(n){if(n.getFilters().length===0)return[];let e=Fb(Kk(n));return $($k(e)),d_(e)||h_(e)?[e]:e.getFilters()}function d_(n){return n instanceof de}function h_(n){return n instanceof Ie&&i_(n)}function $k(n){return d_(n)||h_(n)||QG(n)}function QG(n){if(n instanceof Ie&&ub(n)){for(let e of n.getFilters())if(!d_(e)&&!h_(e))return!1;return!0}return!1}function Fb(n){if($(n instanceof de||n instanceof Ie),n instanceof de)return n;if(n.filters.length===1)return Fb(n.filters[0]);let e=n.filters.map(r=>Fb(r)),t=Ie.create(e,n.op);return t=kf(t),$k(t)?t:($(t instanceof Ie),$(Ca(t)),$(t.filters.length>1),t.filters.reduce((r,i)=>f_(r,i)))}function f_(n,e){$(n instanceof de||n instanceof Ie),$(e instanceof de||e instanceof Ie);let t;return n instanceof de?e instanceof de?t=YG(n,e):t=YN(n,e):e instanceof de?t=YN(e,n):t=XG(n,e),kf(t)}function YG(n,e){return Ie.create([n,e],"and")}function XG(n,e){if($(n.filters.length>0&&e.filters.length>0),Ca(n)&&Ca(e))return ak(n,e.getFilters());let t=ub(n)?n:e,r=ub(n)?e:n,i=t.filters.map(s=>f_(s,r));return Ie.create(i,"or")}function YN(n,e){if(Ca(e))return ak(e,n.getFilters());{let t=e.filters.map(r=>f_(n,r));return Ie.create(t,"or")}}function kf(n){if($(n instanceof de||n instanceof Ie),n instanceof de)return n;let e=n.getFilters();if(e.length===1)return kf(e[0]);if(sk(n))return n;let t=e.map(i=>kf(i)),r=[];return t.forEach(i=>{i instanceof de?r.push(i):i instanceof Ie&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Ie.create(r,n.op)}var Lb=class{constructor(){this.collectionParentIndex=new Yc}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),I.resolve()}getCollectionParents(e,t){return I.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return I.resolve()}deleteFieldIndex(e,t){return I.resolve()}deleteAllFieldIndexes(e){return I.resolve()}createTargetIndexes(e,t){return I.resolve()}getDocumentsMatchingTarget(e,t){return I.resolve(null)}getIndexType(e,t){return I.resolve(0)}getFieldIndexes(e,t){return I.resolve([])}getNextCollectionGroupToUpdate(e){return I.resolve(null)}getMinOffset(e,t){return I.resolve(bn.min())}getMinOffsetFromCollectionGroup(e,t){return I.resolve(bn.min())}updateCollectionGroup(e,t,r){return I.resolve()}updateIndexEntries(e,t){return I.resolve()}},Yc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ae(pe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ae(pe.comparator)).toArray()}};var XN="IndexedDbIndexManager",of=new Uint8Array(0),Bb=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Yc,this.targetToDnfSubTargets=new yr(r=>Vs(r),(r,i)=>cu(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:qt(i)};return JN(e).put(s)}return I.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[Ax(t),""],!1,!0);return JN(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(hr(o.parent))}return r})}addFieldIndex(e,t){let r=Ec(e),i=DG(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=ua(e);return s.next(a=>{o.put(VN(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Ec(e),i=ua(e),s=ca(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ec(e),r=ca(e),i=ua(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return I.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new xf(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=ca(e),i=!0,s=new Map;return I.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ae(),a=[];return I.forEach(s,(l,c)=>{L(XN,`Using index ${sz(l)} to execute ${Vs(t)}`);let u=N9(c,l),m=x9(c,l),g=k9(c,l),S=O9(c,l),T=this.encodeBound(l,c,g),C=this.encodeBound(l,c,S),E=this.encodeValues(l,c,m),x=this.generateIndexRanges(l.indexId,u,T,g.inclusive,C,S.inclusive,E);return I.forEach(x,A=>r.loadFirst(A,t.limit).next(k=>{k.forEach(O=>{let z=U.fromSegments(O.documentKey);o.has(z)||(o=o.add(z),a.push(z))})}))}).next(()=>a)}else return I.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=HG(Ie.create(e.filters,"and")).map(i=>wb(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let m=0;m<l;++m){let g=t?this.encodeSingleElement(t[m/c]):of,S=this.generateLowerBound(e,g,r[m%c],i),T=this.generateUpperBound(e,g,s[m%c],o),C=a.map(E=>this.generateLowerBound(e,g,E,!0));u.push(...this.createRange(S,T,C))}return u}generateLowerBound(e,t,r,i){let s=new Rs(e,U.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Rs(e,U.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new xf(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return I.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<M9(s)&&(r=1):r=0})).next(()=>P9(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new As;for(let i of Ps(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Mr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new As;return Mr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new As;return Mr.INSTANCE.writeIndexValue(Ls(this.databaseId,t),r.forKind(iz(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new As);let s=0;for(let o of Ps(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&qc(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);Mr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new As;l.seed(a.encodedBytes()),Mr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof de&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ec(e),i=ua(e);return(t?r.loadAll(sb,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return I.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(AG(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ie(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ec(e),s=ua(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(sb,IDBKeyRange.bound(t,t)).next(a=>I.forEach(a,l=>s.put(VN(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return I.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?I.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),I.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let m=this.computeIndexEntries(s,c);return u.isEqual(m)?I.resolve():this.updateEntries(e,s,c,u,m)}))))})}addIndexEntry(e,t,r,i){return ca(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return ca(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=ca(e),s=new Ae(xi);return i.iterate({index:qx,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Rs(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new Ae(xi),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=WS(t);if(s!=null){let o=e.data.field(s.fieldPath);if(qc(o))for(let a of o.arrayValue.values||[])r=r.add(new Rs(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Rs(t.indexId,e.key,of,i));return r}updateEntries(e,t,r,i,s){L(XN,"Updating index entries for document '%s'",t.key);let o=[];return jz(i,s,xi,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),I.waitFor(o)}getNextSequenceNumber(e){let t=1;return ua(e).iterate({index:Ux,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>xi(o,a)).filter((o,a,l)=>!a||xi(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=xi(o,e),l=xi(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,of,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,of,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return xi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ZN)}getMinOffset(e,t){return I.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||G())).next(ZN)}};function JN(n){return pt(n,Fc)}function ca(n){return pt(n,hp)}function Ec(n){return pt(n,XS)}function ua(n){return pt(n,dp)}function ZN(n){$(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;HS(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new bn(e.readTime,e.documentKey,t)}function Wk(n,e,t){let r=n.store(Fn),i=n.store(Ua),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,m,g)=>(a++,g.delete()));s.push(l.next(()=>{$(a===1)}));let c=[];for(let u of t.mutations){let m=Lx(e,u.key.path,t.batchId);s.push(i.delete(m)),c.push(u.key)}return I.waitFor(s).next(()=>c)}function Of(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw G();return JSON.stringify(e).length}var Mf=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){$(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).iterate({index:Ns,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ma(e),o=ki(e);return o.add({}).next(a=>{$(typeof a=="number");let l=new jc(a,t,r,i),c=vG(this.serializer,this.userId,l),u=[],m=new Ae((g,S)=>ie(g.canonicalString(),S.canonicalString()));for(let g of i){let S=Lx(this.userId,g.key.path,a);m=m.add(g.key.path.popLast()),u.push(o.put(c)),u.push(s.put(S,fz))}return m.forEach(g=>{u.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),I.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return ki(e).get(t).next(r=>r?($(r.userId===this.userId),Ds(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?I.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return ki(e).iterate({index:Ns,range:i},(o,a,l)=>{a.userId===this.userId&&($(a.batchId>=r),s=Ds(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Li;return ki(e).iterate({index:Ns,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Li],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).loadAll(Ns,t).next(r=>r.map(i=>Ds(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=uf(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ma(e).iterate({range:i},(o,a,l)=>{let[c,u,m]=o,g=hr(u);if(c!==this.userId||!t.path.isEqual(g)){l.done();return}return ki(e).get(m).next(S=>{if(!S)throw G();$(S.userId===this.userId),s.push(Ds(this.serializer,S))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ae(ie),i=[];return t.forEach(s=>{let o=uf(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=ma(e).iterate({range:a},(c,u,m)=>{let[g,S,T]=c,C=hr(S);if(g!==this.userId||!s.path.isEqual(C)){m.done();return}r=r.add(T)});i.push(l)}),I.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=uf(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ae(ie);return ma(e).iterate({range:o},(l,c,u)=>{let[m,g,S]=l,T=hr(g);if(m!==this.userId||!r.isPrefixOf(T)){u.done();return}T.length===i&&(a=a.add(S))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(ki(e).get(s).next(o=>{if(o===null)throw G();$(o.userId===this.userId),r.push(Ds(this.serializer,o))}))}),I.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Wk(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),I.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return I.resolve();let r=IDBKeyRange.lowerBound(hz(this.userId)),i=[];return ma(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=hr(s[1]);i.push(c)}}).next(()=>{$(i.length===0)})})}containsKey(e,t){return Hk(e,this.userId,t)}getMutationQueueMetadata(e){return Qk(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Li,lastStreamToken:""})}};function Hk(n,e,t){let r=uf(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ma(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,m,g]=a;u===e&&m===i&&(o=!0),c.done()}).next(()=>o)}function JG(n,e){let t=!1;return Qk(n).iterateSerial(r=>Hk(n,r,e).next(i=>(i&&(t=!0),I.resolve(!i)))).next(()=>t)}function ki(n){return pt(n,Fn)}function ma(n){return pt(n,Ua)}function Qk(n){return pt(n,ou)}var Lw=2,xa=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Lw,this.lastId}static forTargetCache(){return new n(2-Lw)}static forSyncEngine(){return new n(1-Lw)}};var Vb=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new xa(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>X.fromTimestamp(new je(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>da(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>($(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return da(e).iterate((o,a)=>{let l=Ac(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>I.waitFor(s)).next(()=>i)}forEachTarget(e,t){return da(e).iterate((r,i)=>{let s=Ac(i);t(s)})}retrieveMetadata(e){return ex(e).get(bf).next(t=>($(t!==null),t))}saveMetadata(e,t){return ex(e).put(bf,t)}saveTargetData(e,t){return da(e).put(Gk(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Vs(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return da(e).iterate({range:i,index:Vx},(o,a,l)=>{let c=Ac(a);cu(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Mi(e);return t.forEach(o=>{let a=qt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),I.waitFor(i)}removeMatchingKeys(e,t,r){let i=Mi(e);return I.forEach(t,s=>{let o=qt(s.path);return I.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Mi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Mi(e),s=ae();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=hr(o[1]),u=new U(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=qt(t.path),i=IDBKeyRange.bound([r],[Ax(r)],!1,!0),s=0;return Mi(e).iterate({index:YS,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return da(e).get(t).next(r=>r?Ac(r):null)}};function da(n){return pt(n,qa)}function ex(n){return pt(n,Hs)}function Mi(n){return pt(n,za)}var tx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hu=-1,Yk=40*1024*1024,wn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};wn.DEFAULT_COLLECTION_PERCENTILE=10;wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;wn.DEFAULT=new wn(Yk,wn.DEFAULT_COLLECTION_PERCENTILE,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);wn.DISABLED=new wn(hu,0,0);var nx="LruGarbageCollector",rx=1*1024*1024,ZG=1*60*1e3,ej=5*60*1e3;function ix([n,e],[t,r]){let i=ie(n,t);return i===0?ie(e,r):i}var Ub=class{constructor(e){this.maxElements=e,this.buffer=new Ae(ix),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();ix(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},qb=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==hu&&this.scheduleGC(ZG)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){L(nx,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>_(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Yi(t)?L(nx,"Ignoring IndexedDB error during garbage collection: ",t):yield Qi(t)}yield this.scheduleGC(ej)}))}},zb=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return I.resolve(sn.INVALID);let r=new Ub(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===hu?(L("LruGarbageCollector","Garbage collection skipped; disabled"),I.resolve(tx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tx):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>{if(c=Date.now(),ha()<=Hn.DEBUG){let g=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${m} documents in ${c-l}ms
Total Duration: ${c-u}ms`;L("LruGarbageCollector",g)}return I.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})})}};function tj(n,e){return new zb(n,e)}var Gb=class{constructor(e,t){this.db=e,this.garbageCollector=tj(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return af(e,r)}removeReference(e,t,r){return af(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return af(e,t)}isPinned(e,t){return JG(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(m=>{if(!m)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,X.min()),Mi(e).delete(nj(l))))});s.push(u)}}).next(()=>I.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return af(e,t)}forEachOrphanedDocument(e,t){let r=Mi(e),i=sn.INVALID,s;return r.iterate({index:YS},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==sn.INVALID&&t(new U(hr(s)),i),i=c,s=l):i=sn.INVALID}).next(()=>{i!==sn.INVALID&&t(new U(hr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function nj(n){return[0,qt(n.path)]}function rj(n,e){return{targetId:0,path:qt(n.path),sequenceNumber:e}}function af(n,e){return Mi(n).put(rj(e,n.currentSequenceNumber))}var Pf=class{constructor(){this.changes=new yr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?I.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var jb=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Es(e).put(r)}removeEntry(e,t,r){return Es(e).delete(ij(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=ut.newInvalidDocument(t);return Es(e).iterate({index:df,range:IDBKeyRange.only(Cc(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:ut.newInvalidDocument(t)};return Es(e).iterate({index:df,range:IDBKeyRange.only(Cc(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:Of(s)}}).next(()=>r)}getEntries(e,t){let r=Jt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Jt(),i=new Me(U.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,Of(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return I.resolve();let i=new Ae(ax);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Cc(i.first()),Cc(i.last())),o=i.getIterator(),a=o.getNext();return Es(e).iterate({index:df,range:s},(l,c,u)=>{let m=U.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&ax(a,m)<0;)r(a,null),a=o.getNext();a&&a.isEqual(m)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(Cc(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),vp(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Es(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Jt();for(let m of c){let g=this.maybeDecodeDocument(U.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);g.isFoundDocument()&&(du(t,g)||i.has(g.key))&&(u=u.insert(g.key,g))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Jt(),o=ox(t,r),a=ox(t,bn.max());return Es(e).iterate({index:Bx,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let m=this.maybeDecodeDocument(U.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(m.key,m),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Kb(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return sx(e).get(ib).next(t=>($(!!t),t))}setMetadata(e,t){return sx(e).put(ib,t)}maybeDecodeDocument(e,t){if(t){let r=gG(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(X.min())))return r}return ut.newInvalidDocument(e)}};function Xk(n){return new jb(n)}var Kb=class extends Pf{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new yr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ae((s,o)=>ie(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=BN(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=Of(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=BN(this.documentCache.serializer,o.convertToNoDocument(X.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function sx(n){return pt(n,au)}function Es(n){return pt(n,lp)}function Cc(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ij(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],vp(e),t[t.length-1]]}function ox(n,e){let t=e.documentKey.path.toArray();return[n,vp(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ax(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ie(t[s],r[s]),i)return i;return i=ie(t.length,r.length),i||(i=ie(t[t.length-2],r[r.length-2]),i)?i:ie(t[t.length-1],r[r.length-1])}var sj=17;var $b=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ff=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&kc(r.mutation,i,on.empty(),je.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ae()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ae()){let i=fr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Dc();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=fr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ae()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Jt(),o=zc(),a=Y9();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Un)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),kc(u.mutation,c,u.mutation.getFieldMask(),je.now())):o.set(c.key,on.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var m;return a.set(c,new $b(u,(m=o.get(c))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let r=zc(),i=new Me((o,a)=>o-a),s=ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||on.empty();u=a.applyToLocalView(c,u),r.set(l,u);let m=(i.get(a.batchId)||ae()).add(l);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,m=vk();u.forEach(g=>{if(!s.has(g)){let S=Ck(t.get(g),r.get(g));S!==null&&m.set(g,S),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return I.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return V9(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):s_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):I.resolve(fr()),a=Sa,l=s;return o.next(c=>I.forEach(c,(u,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(u)?I.resolve():this.remoteDocumentCache.getEntry(e,u).next(g=>{l=l.insert(u,g)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,ae())).next(u=>({batchId:a,changes:yk(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=Dc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Dc();return this.indexManager.getCollectionParents(e,s).next(a=>I.forEach(a,l=>{let c=F9(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,ut.newInvalidDocument(u)))});let a=Dc();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&kc(u.mutation,c,on.empty(),je.now()),du(t,c)&&(a=a.insert(l,c))}),a})}};var Wb=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return I.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,CG(t)),I.resolve()}getNamedQuery(e,t){return I.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,EG(t)),I.resolve()}};var Hb=class{constructor(){this.overlays=new Me(U.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return I.resolve(this.overlays.get(t))}getOverlays(e,t){let r=fr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),I.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),I.resolve()}getOverlaysForCollection(e,t,r){let i=fr(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return I.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Me((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let g=s.get(u.largestBatchId);g===null&&(g=fr(),s=s.insert(u.largestBatchId,g)),g.set(u.getKey(),u)}}let a=fr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((m,g)=>a.set(m,g)),!(a.size()>=i)););return I.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Kc(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ae(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Qb=class{constructor(){this.sessionToken=nt.EMPTY_BYTE_STRING}getSessionToken(e){return I.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,I.resolve()}};var Xc=class{constructor(){this.refsByKey=new Ae(lt.compareByKey),this.refsByTarget=new Ae(lt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new lt(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new lt(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new U(new pe([])),r=new lt(t,e),i=new lt(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new U(new pe([])),r=new lt(t,e),i=new lt(t,e+1),s=ae();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new lt(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},lt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return U.comparator(e.key,t.key)||ie(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ie(e.targetOrBatchId,t.targetOrBatchId)||U.comparator(e.key,t.key)}};var Yb=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Ae(lt.compareByKey)}checkEmpty(e){return I.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new jc(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new lt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return I.resolve(o)}lookupMutationBatch(e,t){return I.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return I.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return I.resolve(this.mutationQueue.length===0?Li:this.nextBatchId-1)}getAllMutationBatches(e){return I.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new lt(t,0),i=new lt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),I.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ae(ie);return t.forEach(i=>{let s=new lt(i,0),o=new lt(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),I.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new lt(new U(s),0),a=new Ae(ie);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),I.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");$(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return I.forEach(t.mutations,s=>{let o=new lt(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new lt(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return I.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,I.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function oj(){return new Me(U.comparator)}var Xb=class{constructor(e){this.sizer=e,this.docs=oj(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return I.resolve(r?r.document.mutableCopy():ut.newInvalidDocument(t))}getEntries(e,t){let r=Jt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ut.newInvalidDocument(i))}),I.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Jt(),o=t.path,a=new U(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||HS(Nx(u),r)<=0||!i.has(u.key)&&!du(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return I.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}forEachDocumentKey(e,t){return I.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Jb(this)}getSize(e){return I.resolve(this.size)}};function aj(n){return new Xb(n)}var Jb=class extends Pf{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Zb=class{constructor(e){this.persistence=e,this.targets=new yr(t=>Vs(t),cu),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Xc,this.targetCount=0,this.targetIdGenerator=xa.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),I.resolve()}getLastRemoteSnapshotVersion(e){return I.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return I.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),I.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),I.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new xa(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,I.resolve()}updateTargetData(e,t){return this.saveTargetData(t),I.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,I.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),I.waitFor(s).next(()=>i)}getTargetCount(e){return I.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return I.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),I.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),I.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),I.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return I.resolve(r)}containsKey(e,t){return I.resolve(this.references.containsKey(t))}};var lj="MemoryPersistence",Lf=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new sn(0),this._started=!1,this._started=!0,this.globalsCache=new Qb,this.referenceDelegate=e(this),this.targetCache=new Zb(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Lb,this.remoteDocumentCache=aj(r),this.serializer=new Rf(t),this.bundleCache=new Wb(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Yb(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){L(lj,"Starting transaction:",e);let i=new eS(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return I.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},eS=class extends vf{constructor(e){super(),this.currentSequenceNumber=e}},Bf=class n{constructor(e){this.persistence=e,this.localViewReferences=new Xc,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw G()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),I.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),I.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),I.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return I.forEach(this.orphanedDocuments,i=>{let s=U.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,X.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return I.or([()=>I.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var tS=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new wf("createOrUpgrade",t);r<1&&i>=1&&(uj(e),dj(e),lx(e),fj(e));let o=I.resolve();return r<3&&i>=3&&(r!==0&&(gj(e),lx(e)),o=o.next(()=>vj(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>hj(e,s))),o=o.next(()=>{wj(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(mj(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{yj(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{bj(e),Sj(e)})),r<12&&i>=12&&(o=o.next(()=>{Tj(e)})),r<13&&i>=13&&(o=o.next(()=>pj(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(Is))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>_j(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(dp).clear()}).next(()=>{t.objectStore(hp).clear()})),r<17&&i>=17&&(o=o.next(()=>{Ej(e)})),o}addDocumentGlobal(e){let t=0;return e.store(Is).iterate((r,i)=>{t+=Of(i)}).next(()=>{let r={byteSize:t};return e.store(au).put(ib,r)})}removeAcknowledgedMutations(e){let t=e.store(ou),r=e.store(Fn);return t.loadAll().next(i=>I.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Li],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Ns,o).next(a=>I.forEach(a,l=>{$(l.userId===s.userId);let c=Ds(this.serializer,l);return Wk(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(za),r=e.store(Is);return e.store(Hs).get(bf).next(s=>{let o=l=>t.put({targetId:0,path:qt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new pe(l),m=cj(u);a.push(t.get(m).next(g=>g?I.resolve():o(u)))}).next(()=>I.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Fc,{keyPath:Sz});let r=t.store(Fc),i=new Yc,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:qt(l)})}};return t.store(Is).iterate({keysOnly:!0},(o,a)=>{let l=new pe(o);return s(l.popLast())}).next(()=>t.store(Ua).iterate({keysOnly:!0},([o,a,l],c)=>{let u=hr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(qa);return t.iterate((r,i)=>{let s=Ac(i),o=Gk(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(Is),i=[];return r.iterate((s,o)=>{let a=t.store(lp),l=Cj(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>I.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Fn),i=Xk(this.serializer),s=new Lf(Bf.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:ae();Ds(this.serializer,l).keys().forEach(g=>u=u.add(g)),a.set(l.userId,u)}),I.forEach(a,(l,c)=>{let u=new dt(c),m=Nf.forUser(this.serializer,u),g=s.getIndexManager(u),S=Mf.forUser(u,this.serializer,g,s.referenceDelegate);return new Ff(i,S,m,g).recalculateAndSaveOverlaysForDocumentKeys(new Lc(t,sn.INVALID),l).next()})})}};function cj(n){return[0,qt(n)]}function uj(n){n.createObjectStore(su)}function dj(n){n.createObjectStore(ou,{keyPath:dz}),n.createObjectStore(Fn,{keyPath:Px,autoIncrement:!0}).createIndex(Ns,Fx,{unique:!0}),n.createObjectStore(Ua)}function hj(n,e){return e.store(Fn).loadAll().next(r=>{n.deleteObjectStore(Fn),n.createObjectStore(Fn,{keyPath:Px,autoIncrement:!0}).createIndex(Ns,Fx,{unique:!0});let s=e.store(Fn),o=r.map(a=>s.put(a));return I.waitFor(o)})}function fj(n){n.createObjectStore(Is)}function pj(n){let e=n.createObjectStore(lp,{keyPath:pz});e.createIndex(df,mz),e.createIndex(Bx,gz)}function mj(n){n.createObjectStore(au)}function lx(n){n.createObjectStore(za,{keyPath:wz}).createIndex(YS,bz,{unique:!0}),n.createObjectStore(qa,{keyPath:yz}).createIndex(Vx,vz,{unique:!0}),n.createObjectStore(Hs)}function gj(n){n.deleteObjectStore(za),n.deleteObjectStore(qa),n.deleteObjectStore(Hs)}function yj(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function vj(n){let e=n.store(Hs),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return e.put(bf,t)}function wj(n){n.createObjectStore(_a,{keyPath:_z})}function bj(n){n.createObjectStore(cp,{keyPath:Tz})}function Sj(n){n.createObjectStore(up,{keyPath:Ez})}function _j(n){n.createObjectStore(XS,{keyPath:Cz,autoIncrement:!0}).createIndex(sb,Iz,{unique:!1}),n.createObjectStore(dp,{keyPath:Dz}).createIndex(Ux,Az,{unique:!1}),n.createObjectStore(hp,{keyPath:Rz}).createIndex(qx,Nz,{unique:!1})}function Tj(n){let e=n.createObjectStore(fp,{keyPath:xz});e.createIndex(ob,kz,{unique:!1}),e.createIndex(zx,Oz,{unique:!1})}function Ej(n){n.createObjectStore(JS,{keyPath:Mz})}function Cj(n){return n.document?new U(pe.fromString(n.document.name).popFirst(5)):n.noDocument?U.fromSegments(n.noDocument.path):n.unknownDocument?U.fromSegments(n.unknownDocument.path):G()}var Oi="IndexedDbPersistence",Bw=30*60*1e3,Vw=5e3,Ij=4e3,Uw="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Dj="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",Aj="firestore_zombie",Jk="main",nS=class n{constructor(e,t,r,i,s,o,a,l,c,u,m=sj){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=m,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=g=>Promise.resolve(),!n.isAvailable())throw new N(D.UNIMPLEMENTED,Dj);this.referenceDelegate=new Gb(this,i),this.dbName=t+Jk,this.serializer=new Rf(l),this.simpleDb=new Vi(this.dbName,this.schemaVersion,new tS(this.serializer)),this.globalsCache=new kb,this.targetCache=new Vb(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Xk(this.serializer),this.bundleCache=new xb,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Ge(Oi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(D.FAILED_PRECONDITION,Uw);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new sn(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>_(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>_(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>_(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>lf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Yi(e))return L(Oi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return L(Oi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Ic(e).get(sa).next(r=>I.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return lf(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return _(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,Bw)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=pt(t,_a);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,Bw),o=i.filter(a=>s.indexOf(a)===-1);return I.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",Ij,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?I.resolve(!0):Ic(e).get(sa).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Vw)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new N(D.FAILED_PRECONDITION,Uw);return!1}}return this.networkEnabled&&this.inForeground?!0:lf(e).loadAll().next(s=>this.filterActiveClients(s,Vw).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&L(Oi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return _(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[su,_a],e=>{let t=new Lc(e,sn.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>lf(e).loadAll().next(t=>this.filterActiveClients(t,Bw).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return Mf.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Bb(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Nf.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){L(Oi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=Gz(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Lc(a,this.listenSequence?this.listenSequence.next():sn.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Ge(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new N(D.FAILED_PRECONDITION,xx);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Ic(e).get(sa).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Vw)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new N(D.FAILED_PRECONDITION,Uw)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ic(e).put(sa,t)}static isAvailable(){return Vi.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Ic(e);return t.get(sa).next(r=>this.isLocalClient(r)?(L(Oi,"Releasing primary lease."),t.delete(sa)):I.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Ge(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Jm()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return L(Oi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ge(Oi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ge("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${Aj}_${this.persistenceKey}_${e}`}};function Ic(n){return pt(n,su)}function lf(n){return pt(n,_a)}function p_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function Rj(n){return _(this,null,function*(){if(!Vi.isAvailable())return Promise.resolve();let e=n+Jk;yield Vi.delete(e)})}function Nj(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var m_="LocalStore",xj=5*60*1e6,Jc=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Me(ie),this.targetIdByTarget=new yr(s=>Vs(s),cu),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ff(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function Zk(n,e,t,r){return new Jc(n,e,t,r)}function eO(n,e){return _(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=ae();for(let u of s){a.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}for(let u of o){l.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function kj(n,e){let t=q(n),r=je.now(),i=e.reduce((a,l)=>a.add(l.key),ae()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Jt(),c=ae();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((m,g)=>{g.isValidDocument()||(c=c.add(m))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let m=[];for(let g of e){let S=l6(g,s.get(g.key).overlayedDocument);S!=null&&m.push(new Un(g.key,S,rk(S.value.mapValue),Qe.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,m,e)}).next(u=>{o=u;let m=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,m)})}).then(()=>({batchId:o.batchId,changes:yk(s)}))}function Oj(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return Gj(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,Mj(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Mj(n){let e=ae();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function Pj(n,e){let t=q(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>($(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function Fj(n){let e=q(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function tO(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function Lj(n,e){let t=q(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,m)=>{let g=i.get(m);if(!g)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,m).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,m)));let S=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?S=S.withResumeToken(nt.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):u.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(u.resumeToken,r)),i=i.insert(m,S),Bj(g,S,u)&&a.push(t.targetCache.updateTargetData(s,S))});let l=Jt(),c=ae();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(nO(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(X.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(m=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return I.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function nO(n,e,t){let r=ae(),i=ae();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Jt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(X.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):L(m_,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function Bj(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=xj?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function Vj(n,e){return _(this,null,function*(){let t=q(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>I.forEach(e,i=>I.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>I.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Yi(r))L(m_,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function Uj(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Li),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function qj(n,e){let t=q(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function ka(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,I.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new Na(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function zj(n,e,t){let r=q(n),i=r.targetIdByTarget.get(t);return i!==void 0?I.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Oa(n,e,t){return _(this,null,function*(){let r=q(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Yi(o))L(m_,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function wp(n,e,t){let r=q(n),i=X.min(),s=ae();return r.persistence.runTransaction("Execute query","readwrite",o=>zj(r,o,zt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:X.min(),t?s:ae())).next(a=>(sO(r,pk(e),a),{documents:a,remoteKeys:s})))}function Gj(n,e,t,r){let i=t.batch,s=i.keys(),o=I.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);$(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function jj(n,e){let t=q(n),r=q(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):I.resolve(null)))}function Kj(n,e){q(q(n,Jc).mutationQueue).removeCachedMutationKeys(e)}function $j(n){return q(q(n,Jc).persistence).getActiveClients()}function rO(n,e){let t=q(n),r=q(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function iO(n,e){let t=q(n),r=t.collectionGroupReadTime.get(e)||X.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,Rx(r,Sa),Number.MAX_SAFE_INTEGER)).then(i=>(sO(t,e,i),i))}function sO(n,e,t){let r=n.collectionGroupReadTime.get(e)||X.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function Wj(n){return zt(Ga(pe.fromString(`__bundle__/docs/${n}`)))}function Hj(n,e,t,r){return _(this,null,function*(){let i=q(n),s=ae(),o=Jt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let m=e.toMutableDocument(c);m.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,m)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield ka(i,Wj(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>nO(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function Qj(n,e){let t=q(n),r=et(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function Yj(n,e){let t=q(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function Xj(n,e){let t=q(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function Jj(r,i){return _(this,arguments,function*(n,e,t=ae()){let s=yield ka(n,zt(u_(e.bundledQuery))),o=q(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=et(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(nt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var rS=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Zj=100;function eK(){return Jm()?8:kx(Ll())>0?6:4}var Vf=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=Zj,this.relativeIndexReadCostPerDocument=eK()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new rS;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(ha()<=Hn.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",fa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),I.resolve()):(ha()<=Hn.DEBUG&&L("QueryEngine","Query:",fa(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(ha()<=Hn.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",fa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zt(t))):I.resolve())}performQueryUsingIndex(e,t){if(NN(t))return I.resolve(null);let r=zt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Cf(t,null,"F"),r=zt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ae(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,Cf(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return NN(t)||i.isEqual(X.min())?I.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?I.resolve(null):(ha()<=Hn.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),fa(t)),this.appendRemainingResults(e,o,t,Rx(i,Sa)).next(a=>a))})}applyQuery(e,t){let r=new Ae(mk(e));return t.forEach((i,s)=>{du(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return ha()<=Hn.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",fa(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,bn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var oO="firestore_clients";function cx(n,e){return`${oO}_${n}_${e}`}var aO="firestore_mutations";function ux(n,e,t){let r=`${aO}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var lO="firestore_targets";function qw(n,e){return`${lO}_${n}_${e}`}var tK="firestore_online_state";function nK(n){return`${tK}_${n}`}var rK="firestore_bundle_loaded_v2";function iK(n){return`${rK}_${n}`}var sK="firestore_sequence_number";function oK(n){return`${sK}_${n}`}var dr="SharedClientState",Uf=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new N(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Ge(dr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Oc=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new N(r.error.code,r.error.message))),i?new n(e,r.state,s):(Ge(dr,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},qf=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=a_();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Jx(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ge(dr,`Failed to parse client data for instance '${e}': ${t}`),null)}},iS=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ge(dr,`Failed to parse online state: ${e}`),null)}},Zc=class{constructor(){this.activeTargetIds=a_()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Mc=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Me(ie),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=cx(this.persistenceKey,this.localClientId),this.sequenceNumberKey=oK(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Zc),this.clientStateKeyRe=new RegExp(`^${oO}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${aO}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${lO}_${o}_(\\d+)$`),this.onlineStateKey=nK(this.persistenceKey),this.bundleLoadedKey=iK(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return _(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(cx(this.persistenceKey,r));if(i){let s=qf.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(qw(this.persistenceKey,e));if(i){let s=Oc.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(qw(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return L(dr,"READ",e,t),t}setItem(e,t){L(dr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){L(dr,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(L(dr,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ge("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>_(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=aK(t.newValue);r!==sn.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Uf(this.currentUser,e,t,r),s=ux(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=ux(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=qw(this.persistenceKey,e),s=new Oc(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return qf.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Uf.fromWebStorageEntry(new dt(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Oc.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return iS.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return _(this,null,function*(){if(e.user.uid!==this.currentUser.uid){L(dr,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=a_();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function aK(n){let e=sn.INVALID;if(n!=null)try{let t=JSON.parse(n);$(typeof t=="number"),e=t}catch(t){Ge(dr,"Failed to read sequence number from WebStorage",t)}return e}var zf=class{constructor(){this.localState=new Zc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Zc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var sS=class{addCallback(e){}shutdown(){}};var oS=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var cf=null;function lK(){return 268435456+Math.round(2147483648*Math.random())}function zw(){return cf===null?cf=lK():cf++,"0x"+cf.toString(16)}function cK(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var uK="1.9.1",Ut="GrpcConnection",dK=`gl-node/${process.versions.node} fire/${Va} grpc/${uK}`;function Gw(n,e,t,r){$(e===null||e.type==="OAuth");let i=new Os.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",dK),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var aS=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){L(Ut,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Os.credentials.createSsl():Os.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=zw(),a=this.ensureActiveStub(),l=Gw(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return cK(u=>(L(Ut,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(m,g)=>{m?(L(Ut,`RPC '${e}' ${o} failed with error:`,m),u(new N(pf(m.code),m.message))):(L(Ut,`RPC '${e}' ${o} completed with response:`,g),u(void 0,g))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=zw(),l=[],c=new ct;L(Ut,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),m=Gw(this.databasePath,i,s,this.databaseInfo.appId),g=Object.assign(Object.assign({},r),{database:this.databasePath}),S=u[e](g,m),T=!1;return S.on("data",C=>{L(Ut,`RPC ${e} ${a} received result:`,C),l.push(C),o!==void 0&&l.length===o&&(T=!0,c.resolve(l))}),S.on("end",()=>{L(Ut,`RPC '${e}' ${a} completed.`),T||(T=!0,c.resolve(l))}),S.on("error",C=>{L(Ut,`RPC '${e}' ${a} failed with error:`,C);let E=pf(C.code);c.reject(new N(E,C.message))}),c.promise}openStream(e,t,r){let i=zw(),s=this.ensureActiveStub(),o=Gw(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=g=>{l||(l=!0,u.callOnClose(g),a.end())},u=new oS({sendFn:g=>{if(l)L(Ut,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,g);else{L(Ut,`RPC '${e}' stream ${i} sending:`,g);try{a.write(g)}catch(S){throw Ge("Failure sending:",g),Ge("Error:",S),S}}},closeFn:()=>{L(Ut,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),m=!1;return a.on("data",g=>{l||(L(Ut,`RPC '${e}' stream ${i} received:`,g),m||(u.callOnConnected(),m=!0),u.callOnMessage(g))}),a.on("end",()=>{L(Ut,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",g=>{if(!l){Ln(Ut,`RPC '${e}' stream ${i} error. Code:`,g.code,"Message:",g.message);let S=pf(g.code);c(new N(S,g.message))}}),L(Ut,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},cO={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},hK={nested:cO},fK=Object.freeze({__proto__:null,nested:cO,default:hK});var pK={longs:String,enums:String,defaults:!0,oneofs:!1};function mK(){let n=Ix.fromJSON(fK,pK);return Os.loadPackageDefinition(n)}function gK(n){let e=mK();return new aS(e,n)}function yK(){return new sS}function uO(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function vK(){return null}function fu(n){return new Ib(n,!1)}var wK="ExponentialBackoff",bK=1e3,SK=1.5,_K=60*1e3,eu=class{constructor(e,t,r=bK,i=SK,s=_K){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&L(wK,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var dx="PersistentStream",TK=60*1e3,EK=10*1e3,Gf=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new eu(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return _(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,TK,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return _(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return _(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Ge(t.toString()),Ge("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new N(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,EK,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>_(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return L(dx,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(L(dx,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},lS=class extends Gf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=O6(this.serializer,e),r=P6(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Rb(this.serializer),t.addTarget=$6(this.serializer,e);let r=j6(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Rb(this.serializer),t.removeTarget=e,this.sendRequest(t)}},cS=class extends Gf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return $(!!e.streamToken),this.lastStreamToken=e.streamToken,$(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){$(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=V6(e.writeResults,e.commitTime),r=et(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=Rb(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Qc(this.serializer,r))};this.sendRequest(t)}};var uS=class{},dS=class extends uS{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new N(D.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Ab(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(D.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Ab(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(D.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function CK(n,e,t,r){return new dS(n,e,t,r)}function IK(n,e){return _(this,null,function*(){let t=q(n),r={writes:e.map(i=>Qc(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,pe.emptyPath(),r)})}function DK(n,e){return _(this,null,function*(){let t=q(n),r={documents:e.map(a=>Hc(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,pe.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=k6(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());$(!!l),o.push(l)}),o})}function AK(n,e,t){let r=q(n);return r.verifyInitialized(),new cS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function RK(n,e,t){let r=q(n);return r.verifyInitialized(),new lS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var NK="OnlineStateTracker",hx=1,fx=10*1e3,hS=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",fx,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${fx/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=hx&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${hx} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ge(t),this.shouldWarnClientIsOffline=!1):L(NK,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Gs="RemoteStore",xK=10,fS=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>_(this,null,function*(){Xi(this)&&(L(Gs,"Restarting streams for network reachability change."),yield QK(this))}))}),this.onlineStateTracker=new hS(r,i)}};function kK(n,e,t,r,i){return new fS(n,e,t,r,i)}function OK(n){let e=q(n);return e.offlineCauses.delete(0),pu(e)}function pu(n){return _(this,null,function*(){if(Xi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function MK(n){return _(this,null,function*(){let e=q(n);e.offlineCauses.add(0),yield ja(e),e.onlineStateTracker.set("Offline")})}function ja(n){return _(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function PK(n){return _(this,null,function*(){let e=q(n);L(Gs,"RemoteStore shutting down."),e.offlineCauses.add(5),yield ja(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function bp(n,e){let t=q(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),v_(t)?y_(t):Wa(t).isOpen()&&g_(t,e))}function Ka(n,e){let t=q(n),r=Wa(t);t.listenTargets.delete(e),r.isOpen()&&dO(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Xi(t)&&t.onlineStateTracker.set("Unknown"))}function g_(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wa(n).watch(e)}function dO(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Wa(n).unwatch(e)}function y_(n){n.watchChangeAggregator=new Cb({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Wa(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function v_(n){return Xi(n)&&!Wa(n).isStarted()&&n.listenTargets.size>0}function Xi(n){return q(n).offlineCauses.size===0}function hO(n){n.watchChangeAggregator=void 0}function FK(n){return _(this,null,function*(){n.onlineStateTracker.set("Online")})}function LK(n){return _(this,null,function*(){n.listenTargets.forEach((e,t)=>{g_(n,e)})})}function BK(n,e){return _(this,null,function*(){hO(n),v_(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),y_(n)):n.onlineStateTracker.set("Unknown")})}function VK(n,e,t){return _(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Df&&e.state===2&&e.cause){try{yield qK(n,e)}catch(r){L(Gs,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield jf(n,r)}return}if(e instanceof ba?n.watchChangeAggregator.handleDocumentChange(e):e instanceof If?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(X.min()))try{let r=yield tO(n.localStore);t.compareTo(r)>=0&&(yield UK(n,t))}catch(r){L(Gs,"Failed to raise snapshot:",r),yield jf(n,r)}})}function jf(n,e,t){return _(this,null,function*(){if(Yi(e))n.offlineCauses.add(1),yield ja(n),n.onlineStateTracker.set("Offline"),t||(t=()=>tO(n.localStore)),n.asyncQueue.enqueueRetryable(()=>_(this,null,function*(){L(Gs,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield pu(n)}));else throw e})}function fO(n,e){return e().catch(t=>jf(n,t,e))}function UK(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(nt.EMPTY_BYTE_STRING,s.snapshotVersion)),dO(n,r);let o=new Na(s.target,r,i,s.sequenceNumber);g_(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function qK(n,e){return _(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function $a(n){return _(this,null,function*(){let e=q(n),t=Ji(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Li;for(;zK(e);)try{let i=yield Uj(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,GK(e,i)}catch(i){yield jf(e,i)}pO(e)&&mO(e)})}function zK(n){return Xi(n)&&n.writePipeline.length<xK}function GK(n,e){n.writePipeline.push(e);let t=Ji(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function pO(n){return Xi(n)&&!Ji(n).isStarted()&&n.writePipeline.length>0}function mO(n){Ji(n).start()}function jK(n){return _(this,null,function*(){Ji(n).writeHandshake()})}function KK(n){return _(this,null,function*(){let e=Ji(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function $K(n,e,t){return _(this,null,function*(){let r=n.writePipeline.shift(),i=Sb.from(r,e,t);yield fO(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield $a(n)})}function WK(n,e){return _(this,null,function*(){e&&Ji(n).handshakeComplete&&(yield HK(n,e)),pO(n)&&mO(n)})}function HK(n,e){return _(this,null,function*(){if(m6(e.code)){let t=n.writePipeline.shift();Ji(n).inhibitBackoff(),yield fO(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield $a(n)}})}function QK(n){return _(this,null,function*(){let e=q(n);e.offlineCauses.add(4),yield ja(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield pu(e)})}function px(n,e){return _(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),L(Gs,"RemoteStore received new credentials");let r=Xi(t);t.offlineCauses.add(3),yield ja(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield pu(t)})}function pS(n,e){return _(this,null,function*(){let t=q(n);e?(t.offlineCauses.delete(2),yield pu(t)):e||(t.offlineCauses.add(2),yield ja(t),t.onlineStateTracker.set("Unknown"))})}function Wa(n){return n.watchStream||(n.watchStream=RK(n.datastore,n.asyncQueue,{onConnected:FK.bind(null,n),onOpen:LK.bind(null,n),onClose:BK.bind(null,n),onWatchChange:VK.bind(null,n)}),n.onNetworkStatusChange.push(e=>_(this,null,function*(){e?(n.watchStream.inhibitBackoff(),v_(n)?y_(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),hO(n))}))),n.watchStream}function Ji(n){return n.writeStream||(n.writeStream=AK(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:jK.bind(null,n),onClose:WK.bind(null,n),onHandshakeComplete:KK.bind(null,n),onMutationResult:$K.bind(null,n)}),n.onNetworkStatusChange.push(e=>_(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield $a(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(L(Gs,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var YK="AsyncQueue",mS=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ha(n,e){if(Ge(YK,`${e}: ${n}`),Yi(n))return new N(D.UNAVAILABLE,`${e}: ${n}`);throw n}var Kf=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||U.comparator(t.key,r.key):this.comparator=(t,r)=>U.comparator(t.key,r.key),this.keyedMap=Dc(),this.sortedSet=new Me(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var $f=class{constructor(){this.changeMap=new Me(U.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):G()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Ma=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Kf.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!uu(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var gS=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function XK(){return new yS}var yS=class{constructor(){this.queries=gO(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){r5(this,new N(D.ABORTED,"Firestore shutting down"))}};function gO(){return new yr(n=>fk(n),uu)}function w_(n,e){return _(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new gS,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=Ha(o,`Initialization of query '${fa(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&S_(t)})}function b_(n,e){return _(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function JK(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&S_(t)}function ZK(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function e5(n,e){let t=q(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&S_(t)}function t5(n,e){q(n).snapshotsInSyncListeners.add(e),e.next()}function n5(n,e){q(n).snapshotsInSyncListeners.delete(e)}function r5(n,e){let t=q(n),r=t.queries;t.queries=gO(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function S_(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var yO=function(n){return n.Default="default",n.Cache="cache",n}(yO||{}),tu=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ma(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Ma.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==yO.Cache}};var vS=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=ae(),i=ae();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Wf=class{constructor(e){this.serializer=e}toDocumentKey(e){return pr(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?Fk(this.serializer,e.document,!1):ut.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return et(e)}},wS=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=vO(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=pe.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Wf(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ae()).add(s);t.set(o,a)}}return t}complete(){return _(this,null,function*(){let e=yield Hj(this.localStore,new Wf(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield Jj(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function vO(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function i5(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Hf=class{constructor(e){this.key=e}},Qf=class{constructor(e){this.key=e}},Yf=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ae(),this.mutatedKeys=ae(),this.docComparator=mk(e),this.documentSet=new Kf(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new $f,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,m)=>{let g=i.get(u),S=du(this.query,m)?m:null,T=g?this.mutatedKeys.has(g.key):!1,C=S?S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations:!1,E=!1;g&&S?g.data.isEqual(S.data)?T!==C&&(r.track({type:3,doc:S}),E=!0):this.shouldWaitForSyncedDocument(g,S)||(r.track({type:2,doc:S}),E=!0,(l&&this.docComparator(S,l)>0||c&&this.docComparator(S,c)<0)&&(a=!0)):!g&&S?(r.track({type:0,doc:S}),E=!0):g&&!S&&(r.track({type:1,doc:g}),E=!0,(l||c)&&(a=!0)),E&&(S?(o=o.add(S),C?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((m,g)=>s5(m.type,g.type)||this.docComparator(m.doc,g.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Ma(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new $f,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ae(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Qf(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Hf(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ae();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Ma.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function s5(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return G()}};return t(n)-t(e)}var Zi="SyncEngine",bS=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},SS=class{constructor(e){this.key=e,this.receivedDocument=!1}},_S=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new yr(a=>fk(a),uu),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Me(U.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Xc,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=xa.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function o5(n,e,t,r,i,s,o){let a=new _S(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function a5(n,e,t=!0){return _(this,null,function*(){let r=Sp(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield wO(r,e,t,!0),i})}function l5(n,e){return _(this,null,function*(){let t=Sp(n);yield wO(t,e,!0,!1)})}function wO(n,e,t,r){return _(this,null,function*(){let i=yield ka(n.localStore,zt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield __(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&bp(n.remoteStore,i),a})}function __(n,e,t,r,i){return _(this,null,function*(){n.applyDocChanges=(m,g,S)=>w5(n,m,g,S);let s=yield wp(n.localStore,e,!0),o=new Yf(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Wc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);C_(n,t,c.limboChanges);let u=new bS(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function c5(n,e,t){return _(this,null,function*(){let r=q(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!uu(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Oa(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ka(r.remoteStore,i.targetId),Pa(r,i.targetId)}).catch(Qi))):(Pa(r,i.targetId),yield Oa(r.localStore,i.targetId,!0))})}function u5(n,e){return _(this,null,function*(){let t=q(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ka(t.remoteStore,r.targetId))})}function d5(n,e,t){return _(this,null,function*(){let r=D_(n);try{let i=yield kj(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),y5(r,i.batchId,t),yield qr(r,i.changes),yield $a(r.remoteStore)}catch(i){let s=Ha(i,"Failed to persist write");t.reject(s)}})}function bO(n,e){return _(this,null,function*(){let t=q(n);try{let r=yield Lj(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&($(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?$(o.receivedDocument):i.removedDocuments.size>0&&($(o.receivedDocument),o.receivedDocument=!1))}),yield qr(t,r,e)}catch(r){yield Qi(r)}})}function mx(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),e5(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function h5(n,e,t){return _(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Me(U.comparator);o=o.insert(s,ut.newNoDocument(s,X.min()));let a=ae().add(s),l=new $c(X.min(),new Map,new Me(ie),o,a);yield bO(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),I_(r)}else yield Oa(r.localStore,e,!1).then(()=>Pa(r,e,t)).catch(Qi)})}function f5(n,e){return _(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield Oj(t.localStore,e);E_(t,r,null),T_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield qr(t,i)}catch(i){yield Qi(i)}})}function p5(n,e,t){return _(this,null,function*(){let r=q(n);try{let i=yield Pj(r.localStore,e);E_(r,e,t),T_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield qr(r,i)}catch(i){yield Qi(i)}})}function m5(n,e){return _(this,null,function*(){let t=q(n);Xi(t.remoteStore)||L(Zi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield Fj(t.localStore);if(r===Li){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Ha(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function T_(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function g5(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new N(D.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function y5(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Me(ie)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function E_(n,e,t){let r=q(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Pa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||SO(n,i)})}function SO(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Ka(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),I_(n))}function C_(n,e,t){for(let r of t)r instanceof Hf?(n.limboDocumentRefs.addReference(r.key,e),v5(n,r)):r instanceof Qf?(L(Zi,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||SO(n,r.key)):G()}function v5(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(L(Zi,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),I_(n))}function I_(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new U(pe.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new SS(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),bp(n.remoteStore,new Na(zt(Ga(t.path)),r,"TargetPurposeLimboResolution",sn.INVALID))}}function qr(n,e,t){return _(this,null,function*(){let r=q(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let m=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(c){i.push(c);let m=vS.fromSnapshot(l.targetId,c);s.push(m)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield Vj(r.localStore,s))})}function w5(n,e,t,r){return _(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield wp(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return C_(n,e.targetId,a.limboChanges),a.snapshot})}function b5(n,e){return _(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){L(Zi,"User change. New user:",e.toKey());let i=yield eO(t.localStore,e);t.currentUser=e,g5(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield qr(t,i.affectedDocuments)}})}function S5(n,e){let t=q(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return ae().add(r.key);{let i=ae(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function _5(n,e){return _(this,null,function*(){let t=q(n),r=yield wp(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&C_(t,e.targetId,i.limboChanges),i})}function T5(n,e){return _(this,null,function*(){let t=q(n);return iO(t.localStore,e).then(r=>qr(t,r))})}function E5(n,e,t,r){return _(this,null,function*(){let i=q(n),s=yield jj(i.localStore,e);if(s===null){L(Zi,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield $a(i.remoteStore):t==="acknowledged"||t==="rejected"?(E_(i,e,r||null),T_(i,e),Kj(i.localStore,e)):G(),yield qr(i,s)})}function C5(n,e){return _(this,null,function*(){let t=q(n);if(Sp(t),D_(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield gx(t,r.toArray());t._isPrimaryClient=!0,yield pS(t.remoteStore,!0);for(let s of i)bp(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Pa(t,o),Oa(t.localStore,o,!0))),Ka(t.remoteStore,o)}),yield i,yield gx(t,r),I5(t),t._isPrimaryClient=!1,yield pS(t.remoteStore,!1)}})}function I5(n){let e=q(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Ka(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Me(U.comparator)}function gx(n,e,t){return _(this,null,function*(){let r=q(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield ka(r.localStore,zt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),m=yield _5(r,u);m.snapshot&&s.push(m.snapshot)}}else{let c=yield rO(r.localStore,o);a=yield ka(r.localStore,c),yield __(r,_O(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function _O(n){return hk(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function D5(n){let e=q(n);return $j(e.localStore)}function A5(n,e,t,r){return _(this,null,function*(){let i=q(n);if(i._isPrimaryClient){L(Zi,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield iO(i.localStore,pk(s[0])),a=$c.createSynthesizedRemoteEventForCurrentChange(e,t==="current",nt.EMPTY_BYTE_STRING);yield qr(i,o,a);break}case"rejected":{yield Oa(i.localStore,e,!0),Pa(i,e,r);break}default:G()}})}function R5(n,e,t){return _(this,null,function*(){let r=Sp(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){L(Zi,"Adding an already active target "+i);continue}let o=yield rO(r.localStore,i),a=yield ka(r.localStore,o);yield __(r,_O(o),a.targetId,!1,a.resumeToken),bp(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield Oa(r.localStore,i,!1).then(()=>{Ka(r.remoteStore,i),Pa(r,i)}).catch(Qi))}})}function Sp(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=bO.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=S5.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h5.bind(null,e),e.syncEngineListener.onWatchChange=JK.bind(null,e.eventManager),e.syncEngineListener.onWatchError=ZK.bind(null,e.eventManager),e}function D_(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=p5.bind(null,e),e}function N5(n,e,t){let r=q(n);x5(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function x5(n,e,t){return _(this,null,function*(){try{let r=yield e.getMetadata();if(yield Qj(n.localStore,r))return yield e.close(),t._completeWith(i5(r)),Promise.resolve(new Set);t._updateProgress(vO(r));let s=new wS(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield qr(n,a.changedDocs,void 0),yield Yj(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return Ln(Zi,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var TS=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return _(this,null,function*(){this.serializer=fu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return Zk(this.persistence,new Vf,t.initialUser,this.serializer)}createPersistence(t){return new Lf(Bf.factory,this.serializer)}createSharedClientState(t){return new zf}terminate(){return _(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Xf=class n extends TS{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return _(this,null,function*(){yield Xu(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield D_(this.onlineComponentProvider.syncEngine),yield $a(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return Zk(this.persistence,new Vf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new qb(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new nb(t,this.persistence);return new tb(e.asyncQueue,r)}createPersistence(e){let t=p_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?wn.withCacheSize(this.cacheSizeBytes):wn.DEFAULT;return new nS(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,uO(),vK(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new zf}},ES=class n extends Xf{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return _(this,null,function*(){yield Xu(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Mc&&(this.sharedClientState.syncEngine={applyBatchState:E5.bind(null,t),applyTargetState:A5.bind(null,t),applyActiveTargetsChange:R5.bind(null,t),getActiveClients:D5.bind(null,t),synchronizeWithChangedDocuments:T5.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>_(this,null,function*(){yield C5(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=uO();if(!Mc.isAvailable(t))throw new N(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=p_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Mc(t,e.asyncQueue,r,e.clientId,e.initialUser)}},A_=(()=>{class n{initialize(t,r){return _(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>mx(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=b5.bind(null,this.syncEngine),yield pS(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return XK()}createDatastore(t){let r=fu(t.databaseInfo.databaseId),i=gK(t.databaseInfo);return CK(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return kK(this.localStore,this.datastore,t.asyncQueue,r=>mx(this.syncEngine,r,0),yK())}createSyncEngine(t,r){return o5(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return _(this,null,function*(){var t,r;yield PK(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),k5=10240;function O5(n,e=k5){let t=0;return{read(){return _(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return _(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function R_(n,e,t){if(!t)throw new N(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function N_(n,e,t,r){if(e===!0&&r===!0)throw new N(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function yx(n){if(!U.isDocumentKey(n))throw new N(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function vx(n){if(U.isDocumentKey(n))throw new N(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function M5(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function mu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=P5(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":G()}function P5(n){return n.constructor?n.constructor.name:null}function be(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=mu(n);throw new N(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function TO(n,e){if(e<=0)throw new N(D.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function F5(n,e){if(!(n instanceof Uint8Array))throw new N(D.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${mu(n)}`);return O5(n,e)}var Fa=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):Ge("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var CS=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var IS=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new ct,this.buffer=new Uint8Array,this.textDecoder=g6(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return _(this,null,function*(){return this.metadata.promise})}nextElement(){return _(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return _(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new CS(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return _(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return _(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return _(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function L5(n,e){return new IS(n,e)}var DS=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return _(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield DK(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new $i(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return _(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new Gc(i,this.precondition(i)))}),yield IK(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=X.min();else throw G();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(X.min())?Qe.exists(!1):Qe.updateTime(t):Qe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(X.min()))throw new N(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Qe.updateTime(t)}else return Qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var AS=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new eu(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>_(this,null,function*(){let e=new DS(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return lu(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Rk(t)}return!1}};var Wi="FirestoreClient",B5=100,V5=11,U5=20,q5=22,RS=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=dt.UNAUTHENTICATED,this.clientId=gf.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>_(this,null,function*(){L(Wi,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(L(Wi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:B5}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ha(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function jw(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),L(Wi,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>_(this,null,function*(){r.isEqual(i)||(yield eO(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function wx(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield x_(n);L(Wi,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>px(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>px(e.remoteStore,i)),n._onlineComponents=e})}function z5(n){return n.name==="FirebaseError"?n.code===D.FAILED_PRECONDITION||n.code===D.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===q5||n.code===U5||n.code===V5:!0}function x_(n){return _(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(Wi,"Using user provided OfflineComponentProvider");try{yield jw(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!z5(t))throw t;Ln("Error using user provided cache. Falling back to memory cache: "+t),yield jw(n,new TS)}}else L(Wi,"Using default OfflineComponentProvider"),yield jw(n,new TS);return n._offlineComponents})}function _p(n){return _(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(Wi,"Using user provided OnlineComponentProvider"),yield wx(n,n._uninitializedComponentsProvider._online)):(L(Wi,"Using default OnlineComponentProvider"),yield wx(n,new A_))),n._onlineComponents})}function EO(n){return x_(n).then(e=>e.persistence)}function k_(n){return x_(n).then(e=>e.localStore)}function CO(n){return _p(n).then(e=>e.remoteStore)}function O_(n){return _p(n).then(e=>e.syncEngine)}function G5(n){return _p(n).then(e=>e.datastore)}function La(n){return _(this,null,function*(){let e=yield _p(n),t=e.eventManager;return t.onListen=a5.bind(null,e.syncEngine),t.onUnlisten=c5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=l5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=u5.bind(null,e.syncEngine),t})}function j5(n){return n.asyncQueue.enqueue(()=>_(this,null,function*(){let e=yield EO(n),t=yield CO(n);return e.setNetworkEnabled(!0),OK(t)}))}function K5(n){return n.asyncQueue.enqueue(()=>_(this,null,function*(){let e=yield EO(n),t=yield CO(n);return e.setNetworkEnabled(!1),MK(t)}))}function $5(n){let e=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let t=yield O_(n);return m5(t,e)})),e.promise}function W5(n,e,t,r){let i=new Fa(r),s=new tu(e,i,t);return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let o=yield La(n);return w_(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let o=yield La(n);return b_(o,s)}))}}function H5(n,e){let t=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield k_(n);return Z5(r,e,t)})),t.promise}function IO(n,e,t={}){let r=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let i=yield La(n);return e$(i,n.asyncQueue,e,t,r)})),r.promise}function Q5(n,e){let t=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield k_(n);return t$(r,e,t)})),t.promise}function DO(n,e,t={}){let r=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let i=yield La(n);return n$(i,n.asyncQueue,e,t,r)})),r.promise}function Y5(n,e){let t=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield O_(n);return d5(r,e,t)})),t.promise}function X5(n,e){let t=new Fa(e);return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield La(n);return t5(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield La(n);return n5(r,t)}))}}function J5(n,e,t){let r=new ct;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let i=yield G5(n);new AS(n.asyncQueue,i,t,e,r).run()})),r.promise}function Z5(n,e,t){return _(this,null,function*(){try{let r=yield qj(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new N(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Ha(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function e$(n,e,t,r,i){let s=new Fa({next:a=>{s.mute(),e.enqueueAndForget(()=>b_(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new N(D.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new N(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new tu(Ga(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return w_(n,o)}function t$(n,e,t){return _(this,null,function*(){try{let r=yield wp(n,e,!0),i=new Yf(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Ha(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function n$(n,e,t,r,i){let s=new Fa({next:a=>{s.mute(),e.enqueueAndForget(()=>b_(n,o)),a.fromCache&&r.source==="server"?i.reject(new N(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new tu(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return w_(n,o)}function r$(n,e,t,r){let i=s$(t,fu(e));n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){N5(yield O_(n),i,r)}))}function i$(n,e){return n.asyncQueue.enqueue(()=>_(this,null,function*(){return Xj(yield k_(n),e)}))}function s$(n,e){let t;return typeof n=="string"?t=Nk().encode(n):t=n,L5(F5(t),e)}function o$(n,e){return n.timeoutSeconds===e.timeoutSeconds}function AO(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var a$="ComponentProvider",bx=new Map;function l$(n){let e=bx.get(n);e&&(L(a$,"Removing Datastore"),bx.delete(n),e.terminate())}function c$(n,e,t,r){return new lb(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,AO(r.experimentalLongPollingOptions),r.useFetchStreams)}var RO="firestore.googleapis.com",Sx=!0,_x=5,Tx=30,u$=!0,Jf=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new N(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=RO,this.ssl=Sx}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Sx;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Yk;else{if(e.cacheSizeBytes!==hu&&e.cacheSizeBytes<rx)throw new N(D.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${rx}`);this.cacheSizeBytes=e.cacheSizeBytes}N_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=u$:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=AO((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),d$(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&o$(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function d$(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new N(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<_x)throw new N(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${_x})`);if(n.timeoutSeconds>Tx)throw new N(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${Tx})`)}}var js=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jf({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new N(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jf(e),e.credentials!==void 0&&(this._authCredentials=ez(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return _(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return l$(this),Promise.resolve()}};function M_(n,e,t,r={}){var i;n=be(n,js);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==RO&&s.host!==o&&Ln("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=dt.MOCK_USER;else{a=g0(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new N(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new dt(c)}n._authCredentials=new $w(new mf(a,l))}}var Et=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ke=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},mr=class n extends Et{constructor(e,t,r){super(e,t,Ga(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ke(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function gu(n,e,...t){if(n=ze(n),R_("collection","path",e),n instanceof js){let r=pe.fromString(e,...t);return vx(r),new mr(n,null,r)}else{if(!(n instanceof ke)&&!(n instanceof mr))throw new N(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return vx(r),new mr(n.firestore,null,r)}}function P_(n,e){if(n=be(n,js),R_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(n,null,B9(e))}function Qa(n,e,...t){if(n=ze(n),arguments.length===1&&(e=gf.newId()),R_("doc","path",e),n instanceof js){let r=pe.fromString(e,...t);return yx(r),new ke(n,null,new U(r))}else{if(!(n instanceof ke)&&!(n instanceof mr))throw new N(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return yx(r),new ke(n.firestore,n instanceof mr?n.converter:null,new U(r))}}function Tp(n,e){return n=ze(n),e=ze(e),(n instanceof ke||n instanceof mr)&&(e instanceof ke||e instanceof mr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function Ep(n,e){return n=ze(n),e=ze(e),n instanceof Et&&e instanceof Et?n.firestore===e.firestore&&uu(n._query,e._query)&&n.converter===e.converter:!1}var h$="AsyncQueue",Zf=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new eu(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new ct;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return _(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Yi(e))L(h$,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=f$(r);throw Ge("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=mS.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&G()}verifyOperationInProgress(){}drain(){return _(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function f$(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var NS=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ct,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var NO=hu,Ke=class extends js{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Zf,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return _(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Zf(e),this._firestoreClient=void 0,yield e}})}};function Ct(n){if(n._terminated)throw new N(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||xO(n),n._firestoreClient}function xO(n){var e,t,r;let i=n._freezeSettings(),s=c$(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new RS(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&p$(n._componentsProvider))}function p$(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function F_(n,e){Ln("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return kO(n,A_.provider,{build:r=>new Xf(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function L_(n){return _(this,null,function*(){Ln("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();kO(n,A_.provider,{build:t=>new ES(t,e.cacheSizeBytes)})})}function kO(n,e,t){if(n=be(n,Ke),n._firestoreClient||n._terminated)throw new N(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new N(D.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},xO(n)}function B_(n){if(n._initialized&&!n._terminated)throw new N(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ct;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{yield Rj(p_(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function V_(n){n=be(n,Ke);let e=Ct(n);return $5(e)}function U_(n){n=be(n,Ke);let e=Ct(n);return j5(e)}function q_(n){n=be(n,Ke);let e=Ct(n);return K5(e)}function z_(n,e){n=be(n,Ke);let t=Ct(n),r=new NS;return r$(t,n._databaseId,e,r),r}function G_(n,e){n=be(n,Ke);let t=Ct(n);return i$(t,e).then(r=>r?new Et(n,null,r.query):null)}function m$(n,e=!0){J3(b0),Bl(new ds("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ke(new Ww(t.getProvider("auth-internal")),new Xw(t.getProvider("app-check-internal")),Xz(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Er(mN,gN,n),Er(mN,gN,"esm2017")}var vr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(nt.fromBase64String(e))}catch(t){throw new N(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var qn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new N(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Br=class{constructor(e){this._methodName=e}};var Ks=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ie(this._lat,e._lat)||ie(this._long,e._long)}};var nu=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return Nj(this._values,e._values)}};var g$=/^__.*__$/,xS=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Un(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ki(e,this.data,t,this.fieldTransforms)}},ep=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Un(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function OO(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var tp=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return np(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(OO(this.dataSource)&&g$.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},kS=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fu(e)}createContext(e,t,r,i=!1){return new tp({dataSource:e,methodName:t,targetDoc:r,path:tt.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ys(n){let e=n._freezeSettings(),t=fu(n._databaseId);return new kS(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Cp(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);$_("Data must be an object, but it was:",o,r);let a=FO(r,o),l,c;if(s.merge)l=new on(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let m of s.mergeFields){let g=LS(e,m,t);if(!o.contains(g))throw new N(D.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);BO(u,g)||u.push(g)}l=new on(u),c=o.fieldTransforms.filter(m=>l.covers(m.field))}else l=null,c=o.fieldTransforms;return new xS(new kt(a),l,c)}var ru=class n extends Br{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function MO(n,e,t){return new tp({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var OS=class n extends Br{_toFieldTransform(e){return new Us(e.path,new Gi)}isEqual(e){return e instanceof n}},MS=class n extends Br{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=MO(this,e,!0),r=this._elements.map(s=>Xs(s,t)),i=new Fr(r);return new Us(e.path,i)}isEqual(e){return e instanceof n&&Zm(this._elements,e._elements)}},PS=class n extends Br{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=MO(this,e,!0),r=this._elements.map(s=>Xs(s,t)),i=new Lr(r);return new Us(e.path,i)}isEqual(e){return e instanceof n&&Zm(this._elements,e._elements)}},FS=class n extends Br{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new ji(e.serializer,bk(e.serializer,this._operand));return new Us(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function j_(n,e,t,r){let i=n.createContext(1,e,t);$_("Data must be an object, but it was:",i,r);let s=[],o=kt.empty();Qs(r,(l,c)=>{let u=W_(e,l,t);c=ze(c);let m=i.childContextForFieldPath(u);if(c instanceof ru)s.push(u);else{let g=Xs(c,m);g!=null&&(s.push(u),o.set(u,g))}});let a=new on(s);return new ep(o,a,i.fieldTransforms)}function K_(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[LS(e,r,t)],l=[i];if(s.length%2!==0)throw new N(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(LS(e,s[g])),l.push(s[g+1]);let c=[],u=kt.empty();for(let g=a.length-1;g>=0;--g)if(!BO(c,a[g])){let S=a[g],T=l[g];T=ze(T);let C=o.childContextForFieldPath(S);if(T instanceof ru)c.push(S);else{let E=Xs(T,C);E!=null&&(c.push(S),u.set(S,E))}}let m=new on(c);return new ep(u,m,o.fieldTransforms)}function PO(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Xs(t,i)}function Xs(n,e){if(n=ze(n),LO(n))return $_("Unsupported field value:",e,n),FO(n,e);if(n instanceof Br)return v$(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return y$(n,e)}else return w$(n,e)}function FO(n,e){let t={};return $x(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qs(n,(r,i)=>{let s=Xs(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function y$(n,e){let t=[],r=0;for(let i of n){let s=Xs(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function v$(n,e){if(!OO(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function w$(n,e){if(n=ze(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return bk(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=je.fromDate(n);return{timestampValue:Ra(e.serializer,t)}}else if(n instanceof je){let t=new je(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Ra(e.serializer,t)}}else{if(n instanceof Ks)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof vr)return{bytesValue:xk(e.serializer,n._byteString)};if(n instanceof ke){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:c_(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof nu)return b$(n,e);throw e.createError(`Unsupported field value: ${mu(n)}`)}}}function b$(n,e){return{mapValue:{fields:{[t_]:{stringValue:n_},[Ta]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return l_(e.serializer,r)})}}}}}}function LO(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof je)&&!(n instanceof Ks)&&!(n instanceof vr)&&!(n instanceof ke)&&!(n instanceof Br)&&!(n instanceof nu)}function $_(n,e,t){if(!LO(t)||!M5(t)){let r=mu(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function LS(n,e,t){if(e=ze(e),e instanceof qn)return e._internalPath;if(typeof e=="string")return W_(n,e);throw np("Field path arguments must be of type string or ",n,!1,void 0,t)}var S$=new RegExp("[~\\*/\\[\\]]");function W_(n,e,t){if(e.search(S$)>=0)throw np(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qn(...e.split("."))._internalPath}catch{throw np(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function np(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new N(D.INVALID_ARGUMENT,a+n+l)}function BO(n,e){return n.some(t=>t.isEqual(e))}var $s=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ke(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new BS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Ip("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},BS=class extends $s{data(){return super.data()}};function Ip(n,e){return typeof e=="string"?W_(n,e):e instanceof qn?e._internalPath:e._delegate._internalPath}function VO(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var iu=class{},Ws=class extends iu{};function wr(n,e,...t){let r=[];e instanceof iu&&r.push(e),r=r.concat(t),R$(r);for(let i of r)n=i._apply(n);return n}var rp=class n extends Ws{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return qO(e._query,t),new Et(e.firestore,e.converter,o_(e._query,t))}_parse(e){let t=Ys(e.firestore);return _$(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function H_(n,e,t){let r=e,i=Ip("where",n);return rp._create(i,r,t)}var VS=class n extends iu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ie.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(D$(e._query,t),new Et(e.firestore,e.converter,o_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var US=class n extends Ws{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=T$(e._query,this._field,this._direction);return new Et(e.firestore,e.converter,q9(e._query,t))}};function Q_(n,e="asc"){let t=e,r=Ip("orderBy",n);return US._create(r,t)}var ip=class n extends Ws{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Et(e.firestore,e.converter,Cf(e._query,this._limit,this._limitType))}};function Y_(n){return TO("limit",n),ip._create("limit",n,"F")}function X_(n){return TO("limitToLast",n),ip._create("limitToLast",n,"L")}var sp=class n extends Ws{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=UO(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,z9(e._query,t))}};function J_(...n){return sp._create("startAt",n,!0)}function Z_(...n){return sp._create("startAfter",n,!1)}var op=class n extends Ws{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=UO(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,G9(e._query,t))}};function eT(...n){return op._create("endBefore",n,!1)}function tT(...n){return op._create("endAt",n,!0)}function UO(n,e,t,r){if(t[0]=ze(t[0]),t[0]instanceof $s)return E$(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Ys(n.firestore);return C$(n._query,n.firestore._databaseId,i,e,t,r)}}function _$(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new N(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){Cx(o,s);let c=[];for(let u of o)c.push(Ex(r,n,u));a={arrayValue:{values:c}}}else a=Ex(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&Cx(o,s),a=PO(t,e,o,s==="in"||s==="not-in");return de.create(i,s,a)}function T$(n,e,t){if(n.startAt!==null)throw new N(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new N(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bs(e,t)}function E$(n,e,t,r,i){if(!r)throw new N(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Ia(n))if(o.field.isKeyField())s.push(Ls(e,r.key));else{let a=r.data.field(o.field);if(pp(a))throw new N(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new N(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new gr(s,i)}function C$(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new N(D.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new N(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!s_(n)&&c.indexOf("/")!==-1)throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let m=n.path.child(pe.fromString(c));if(!U.isDocumentKey(m))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${m}' is not because it contains an odd number of segments.`);let g=new U(m);a.push(Ls(e,g))}else{let m=PO(t,r,c);a.push(m)}}return new gr(a,s)}function Ex(n,e,t){if(t=ze(t),typeof t=="string"){if(t==="")throw new N(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!s_(e)&&t.indexOf("/")!==-1)throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(pe.fromString(t));if(!U.isDocumentKey(r))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ls(n,new U(r))}else{if(t instanceof ke)return Ls(n,t._key);throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mu(t)}.`)}}function Cx(n,e){if(!Array.isArray(n)||n.length===0)throw new N(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function I$(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function qO(n,e){let t=A$(n.filters,I$(e.op));if(t!==null)throw t===e.op?new N(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function D$(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)qO(t,i),t=o_(t,i)}function A$(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function R$(n){let e=n.filter(r=>r instanceof VS).length,t=n.filter(r=>r instanceof rp).length;if(e>1||e>0&&t>0)throw new N(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Ba=class{convertValue(e,t="none"){switch(Fs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ui(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Qs(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Ta].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Be(o.doubleValue));return new nu(s)}convertGeoPoint(e){return new Ks(Be(e.latitude),Be(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=e_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bc(e));default:return null}}convertTimestamp(e){let t=Pr(e);return new je(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=pe.fromString(e);$(zk(r));let i=new qi(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Ge(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Dp(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var qS=class extends Ba{constructor(e){super(),this.firestore=e}convertBytes(e){return new vr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ke(this.firestore,null,t)}};function zS(n){return N$(n,["next","error","complete"])}function N$(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Vr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Sn=class extends $s{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Hi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(Ip("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Hi=class extends Sn{data(e={}){return super.data(e)}},zn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Vr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Hi(this._firestore,this._userDataWriter,r.key,r,new Vr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=x$(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function x$(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Hi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Vr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Hi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Vr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:k$(r.type),doc:i,oldIndex:s,newIndex:o}})}}function k$(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function Ap(n,e){return n instanceof Sn&&e instanceof Sn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof zn&&e instanceof zn?n._firestore===e._firestore&&Ep(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function nT(n){n=be(n,ke);let e=be(n.firestore,Ke),t=Ct(e);return IO(t,n._key).then(r=>dT(e,n,r))}var Ur=class extends Ba{constructor(e){super(),this.firestore=e}convertBytes(e){return new vr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ke(this.firestore,null,t)}};function rT(n){n=be(n,ke);let e=be(n.firestore,Ke),t=Ct(e),r=new Ur(e);return H5(t,n._key).then(i=>new Sn(e,r,n._key,i,new Vr(i!==null&&i.hasLocalMutations,!0),n.converter))}function iT(n){n=be(n,ke);let e=be(n.firestore,Ke),t=Ct(e);return IO(t,n._key,{source:"server"}).then(r=>dT(e,n,r))}function sT(n){n=be(n,Et);let e=be(n.firestore,Ke),t=Ct(e),r=new Ur(e);return VO(n._query),DO(t,n._query).then(i=>new zn(e,r,n,i))}function oT(n){n=be(n,Et);let e=be(n.firestore,Ke),t=Ct(e),r=new Ur(e);return Q5(t,n._query).then(i=>new zn(e,r,n,i))}function aT(n){n=be(n,Et);let e=be(n.firestore,Ke),t=Ct(e),r=new Ur(e);return DO(t,n._query,{source:"server"}).then(i=>new zn(e,r,n,i))}function Rp(n,e,t){n=be(n,ke);let r=be(n.firestore,Ke),i=Dp(n.converter,e,t),s=Ys(r),a=Cp(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Qe.none());return Ya(r,[a])}function Np(n,e,t,...r){n=be(n,ke);let i=be(n.firestore,Ke),s=Ys(i);e=ze(e);let o;typeof e=="string"||e instanceof qn?o=K_(s,"updateDoc",n._key,e,t,r):o=j_(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Qe.exists(!0));return Ya(i,[a])}function lT(n){let e=be(n.firestore,Ke),t=[new $i(n._key,Qe.none())];return Ya(e,t)}function cT(n,e){let t=be(n.firestore,Ke),r=Qa(n),i=Dp(n.converter,e),s=Ys(n.firestore),a=Cp(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Qe.exists(!1));return Ya(t,[a]).then(()=>r)}function xp(n,...e){var t,r,i;n=ze(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!zS(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(zS(e[o])){let g=e[o];e[o]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[o+1]=(r=g.error)===null||r===void 0?void 0:r.bind(g),e[o+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,c,u;if(n instanceof ke)c=be(n.firestore,Ke),u=Ga(n._key.path),l={next:g=>{e[o]&&e[o](dT(c,n,g))},error:e[o+1],complete:e[o+2]};else{let g=be(n,Et);c=be(g.firestore,Ke),u=g._query;let S=new Ur(c);l={next:T=>{e[o]&&e[o](new zn(c,S,g,T))},error:e[o+1],complete:e[o+2]},VO(n._query)}let m=Ct(c);return W5(m,u,a,l)}function uT(n,e){n=be(n,Ke);let t=Ct(n),r=zS(e)?e:{next:e};return X5(t,r)}function Ya(n,e){let t=Ct(n);return Y5(t,e)}function dT(n,e,t){let r=t.docs.get(e._key),i=new Ur(n);return new Sn(n,i,e._key,r,new Vr(t.hasPendingWrites,t.fromCache),e.converter)}var O$={maxAttempts:5};function M$(n){if(n.maxAttempts<1)throw new N(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}var ap=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ys(e)}set(e,t,r){this._verifyNotCommitted();let i=Fi(e,this._firestore),s=Dp(i.converter,t,r),o=Cp(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Qe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Fi(e,this._firestore);t=ze(t);let o;return typeof t=="string"||t instanceof qn?o=K_(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=j_(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Qe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Fi(e,this._firestore);return this._mutations=this._mutations.concat(new $i(t._key,Qe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Fi(n,e){if(n=ze(n),n.firestore!==e)throw new N(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var GS=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ys(e)}get(e){let t=Fi(e,this._firestore),r=new qS(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return G();let s=i[0];if(s.isFoundDocument())return new $s(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new $s(this._firestore,r,t._key,null,t.converter);throw G()})}set(e,t,r){let i=Fi(e,this._firestore),s=Dp(i.converter,t,r),o=Cp(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Fi(e,this._firestore);t=ze(t);let o;return typeof t=="string"||t instanceof qn?o=K_(this._dataReader,"Transaction.update",s._key,t,r,i):o=j_(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Fi(e,this._firestore);return this._transaction.delete(t._key),this}};var jS=class extends GS{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Fi(e,this._firestore),r=new Ur(this._firestore);return super.get(e).then(i=>new Sn(this._firestore,r,t._key,i._document,new Vr(!1,!1),t.converter))}};function hT(n,e,t){n=be(n,Ke);let r=Object.assign(Object.assign({},O$),t);M$(r);let i=Ct(n);return J5(i,s=>e(new jS(n,s)),r)}function fT(){return new ru("deleteField")}function pT(){return new OS("serverTimestamp")}function mT(...n){return new MS("arrayUnion",n)}function gT(...n){return new PS("arrayRemove",n)}function yT(n){return new FS("increment",n)}m$("node");var P$="@firebase/firestore-compat",F$="0.3.38";function TT(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new N("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function zO(){if(typeof Uint8Array>"u")throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function GO(){if(!Wx())throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}var kp=class n{constructor(e){this._delegate=e}static fromBase64String(e){return GO(),new n(vr.fromBase64String(e))}static fromUint8Array(e){return zO(),new n(vr.fromUint8Array(e))}toBase64(){return GO(),this._delegate.toBase64()}toUint8Array(){return zO(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function vT(n){return L$(n,["next","error","complete"])}function L$(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var wT=class{enableIndexedDbPersistence(e,t){return F_(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return L_(e._delegate)}clearIndexedDbPersistence(e){return B_(e._delegate)}},Op=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof qi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ln("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){M_(this._delegate,e,t,r)}enableNetwork(){return U_(this._delegate)}disableNetwork(){return q_(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,N_("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return V_(this._delegate)}onSnapshotsInSync(e){return uT(this._delegate,e)}get app(){if(!this._appCompat)throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Za(this,gu(this._delegate,e))}catch(t){throw Gt(t,"collection()","Firestore.collection()")}}doc(e){try{return new br(this,Qa(this._delegate,e))}catch(t){throw Gt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new to(this,P_(this._delegate,e))}catch(t){throw Gt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return hT(this._delegate,t=>e(new Mp(this,t)))}batch(){return Ct(this._delegate),new Pp(new ap(this._delegate,e=>Ya(this._delegate,e)))}loadBundle(e){return z_(this._delegate,e)}namedQuery(e){return G_(this._delegate,e).then(t=>t?new to(this,t):null)}},Xa=class extends Ba{constructor(e){super(),this.firestore=e}convertBytes(e){return new kp(new vr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return br.forKey(t,this.firestore,null)}};function B$(n){KS(n)}var Mp=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Xa(e)}get(e){let t=Js(e);return this._delegate.get(t).then(r=>new Zs(this._firestore,new Sn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Js(e);return r?(TT("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Js(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Js(e);return this._delegate.delete(t),this}},Pp=class{constructor(e){this._delegate=e}set(e,t,r){let i=Js(e);return r?(TT("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Js(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Js(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ja=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Hi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new eo(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Xa(e),t),i.set(t,s)),s}};Ja.INSTANCES=new WeakMap;var br=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Xa(e)}static forPath(e,t,r){if(e.length%2!==0)throw new N("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ke(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new ke(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Za(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Za(this.firestore,gu(this._delegate,e))}catch(t){throw Gt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ze(e),e instanceof ke?Tp(this._delegate,e):!1}set(e,t){t=TT("DocumentReference.set",t);try{return t?Rp(this._delegate,e,t):Rp(this._delegate,e)}catch(r){throw Gt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Np(this._delegate,e):Np(this._delegate,e,t,...r)}catch(i){throw Gt(i,"updateDoc()","DocumentReference.update()")}}delete(){return lT(this._delegate)}onSnapshot(...e){let t=jO(e),r=KO(e,i=>new Zs(this.firestore,new Sn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return xp(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=rT(this._delegate):e?.source==="server"?t=iT(this._delegate):t=nT(this._delegate),t.then(r=>new Zs(this.firestore,new Sn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ja.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Gt(n,e,t){return n.message=n.message.replace(e,t),n}function jO(n){for(let e of n)if(typeof e=="object"&&!vT(e))return e;return{}}function KO(n,e){var t,r;let i;return vT(n[0])?i=n[0]:vT(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Zs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new br(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ap(this._delegate,e._delegate)}},eo=class extends Zs{data(e){let t=this._delegate.data(e);return this._delegate._converter||Dx(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},to=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Xa(e)}where(e,t,r){try{return new n(this.firestore,wr(this._delegate,H_(e,t,r)))}catch(i){throw Gt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,wr(this._delegate,Q_(e,t)))}catch(r){throw Gt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,wr(this._delegate,Y_(e)))}catch(t){throw Gt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,wr(this._delegate,X_(e)))}catch(t){throw Gt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,wr(this._delegate,J_(...e)))}catch(t){throw Gt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,wr(this._delegate,Z_(...e)))}catch(t){throw Gt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,wr(this._delegate,eT(...e)))}catch(t){throw Gt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,wr(this._delegate,tT(...e)))}catch(t){throw Gt(t,"endAt()","Query.endAt()")}}isEqual(e){return Ep(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=oT(this._delegate):e?.source==="server"?t=aT(this._delegate):t=sT(this._delegate),t.then(r=>new yu(this.firestore,new zn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=jO(e),r=KO(e,i=>new yu(this.firestore,new zn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return xp(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ja.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},bT=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new eo(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},yu=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new to(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new eo(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new bT(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new eo(this._firestore,r))})}isEqual(e){return Ap(this._delegate,e._delegate)}},Za=class n extends to{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new br(this.firestore,e):null}doc(e){try{return e===void 0?new br(this.firestore,Qa(this._delegate)):new br(this.firestore,Qa(this._delegate,e))}catch(t){throw Gt(t,"doc()","CollectionReference.doc()")}}add(e){return cT(this._delegate,e).then(t=>new br(this.firestore,t))}isEqual(e){return Tp(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ja.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Js(n){return be(n,ke)}var ST=class n{constructor(...e){this._delegate=new qn(...e)}static documentId(){return new n(tt.keyField().canonicalString())}isEqual(e){return e=ze(e),e instanceof qn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var _T=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=pT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=fT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=mT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=gT(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=yT(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var V$={Firestore:Op,GeoPoint:Ks,Timestamp:je,Blob:kp,Transaction:Mp,WriteBatch:Pp,DocumentReference:br,DocumentSnapshot:Zs,Query:to,QueryDocumentSnapshot:eo,QuerySnapshot:yu,CollectionReference:Za,FieldPath:ST,FieldValue:_T,setLogLevel:B$,CACHE_SIZE_UNLIMITED:NO};function U$(n,e){n.INTERNAL.registerComponent(new ds("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},V$)))}function q$(n){U$(n,(e,t)=>new Op(e,t,new wT)),n.registerVersion(P$,F$,"node")}q$(Wt);function z$(n,e=Ju){return new Wn(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function $O(n,e){return z$(n,e)}function G$(n,e){return $O(n,e).pipe(Rl(void 0),Dl(),ot(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function IT(n,e){return $O(n,e).pipe(ot(t=>({payload:t,type:"query"})))}var Fp=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=XO(r,t);return new Bp(i,s,this.afs)}snapshotChanges(){return G$(this.ref,this.afs.schedulers.outsideAngular).pipe(Lt)}valueChanges(e={}){return this.snapshotChanges().pipe(ot(({payload:t})=>e.idField?Tr(an({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return En(this.ref.get(e)).pipe(Lt)}};function Lp(n,e){return IT(n,e).pipe(Rl(void 0),Dl(),ot(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(m=>m.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(m=>m.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function WO(n,e,t){return Lp(n,t).pipe(Al((r,i)=>j$(r,i.map(s=>s.payload),e),[]),Fm(),ot(r=>r.map(i=>({type:i.type,payload:i}))))}function j$(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=K$(n,r))}),n}function ET(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function K$(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return ET(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return ET(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ET(n,e.oldIndex,1);break}return n}function HO(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Bp=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Lp(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ot(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Rl(void 0),Dl(),ho(([r,i])=>i.length>0||!r),ot(([,r])=>r),Lt)}auditTrail(e){return this.stateChanges(e).pipe(Al((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=HO(e);return WO(this.query,t,this.afs.schedulers.outsideAngular).pipe(Lt)}valueChanges(e={}){return IT(this.query,this.afs.schedulers.outsideAngular).pipe(ot(t=>t.payload.docs.map(r=>e.idField?Tr(an({},r.data()),{[e.idField]:r.id}):r.data())),Lt)}get(e){return En(this.query.get(e)).pipe(Lt)}add(e){return this.ref.add(e)}doc(e){return new Fp(this.ref.doc(e),this.afs)}},CT=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Lp(this.query,this.afs.schedulers.outsideAngular).pipe(Lt):Lp(this.query,this.afs.schedulers.outsideAngular).pipe(ot(t=>t.filter(r=>e.indexOf(r.type)>-1)),ho(t=>t.length>0),Lt)}auditTrail(e){return this.stateChanges(e).pipe(Al((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=HO(e);return WO(this.query,t,this.afs.schedulers.outsideAngular).pipe(Lt)}valueChanges(e={}){return IT(this.query,this.afs.schedulers.outsideAngular).pipe(ot(r=>r.payload.docs.map(i=>e.idField?an({[e.idField]:i.id},i.data()):i.data())),Lt)}get(e){return En(this.query.get(e)).pipe(Lt)}},QO=new Xe("angularfire2.enableFirestorePersistence"),YO=new Xe("angularfire2.firestore.persistenceSettings"),$$=new Xe("angularfire2.firestore.settings"),W$=new Xe("angularfire2.firestore.use-emulator");function XO(n,e=t=>t){return{query:e(n),ref:n}}var DT=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,m,g,S,T,C,E,x,A){this.schedulers=l;let k=ql(t,a,r),O=u;m&&pg(k,a,g,T,C,E,S,x),[this.firestore,this.persistenceEnabled$]=cd(`${k.name}.firestore`,"AngularFirestore",k.name,()=>{let z=a.runOutsideAngular(()=>k.firestore());if(s&&z.settings(s),O&&z.useEmulator(...O),i&&!td(o)){let Q=()=>{try{return En(z.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(v){return typeof console<"u"&&console.warn(v),Xr(!1)}};return[z,a.runOutsideAngular(Q)]}else return[z,Xr(!1)]},[s,O,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=XO(i,r),a=this.schedulers.ngZone.run(()=>s);return new Bp(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new CT(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Fp(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(he(yo),he(vo,8),he(QO,8),he($$,8),he(fo),he(Zr),he(Vl),he(YO,8),he(W$,8),he(q0,8),he(lg,8),he(cg,8),he(ug,8),he(dg,8),he(hg,8),he(fg,8),he(ti,8))};static \u0275prov=as({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),JO=(()=>{class n{constructor(){Wt.registerVersion("angularfire",fs.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:QO,useValue:!0},{provide:YO,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=$t({type:n});static \u0275inj=Kt({providers:[DT]})}return n})();var aM=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(Fe(zm),Fe(qm))}}static{this.\u0275dir=Cn({type:n})}}return n})(),Q$=(()=>{class n extends aM{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Um(n)))(i||n)}})()}static{this.\u0275dir=Cn({type:n,features:[ei]})}}return n})(),lM=new Xe("");var Y$={provide:lM,useExisting:Nl(()=>Kp),multi:!0};function X$(){let n=Qm()?Qm().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var J$=new Xe(""),Kp=(()=>{class n extends aM{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!X$())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(Fe(zm),Fe(qm),Fe(J$,8))}}static{this.\u0275dir=Cn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&Dt("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[Fl([Y$]),ei]})}}return n})();function Z$(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}var RT=new Xe(""),cM=new Xe("");function eW(n){return Z$(n.value)?{required:!0}:null}function ZO(n){return null}function uM(n){return n!=null}function dM(n){return a0(n)?En(n):n}function hM(n){let e={};return n.forEach(t=>{e=t!=null?an(an({},e),t):e}),Object.keys(e).length===0?null:e}function fM(n,e){return e.map(t=>t(n))}function tW(n){return!n.validate}function pM(n){return n.map(e=>tW(e)?e:t=>e.validate(t))}function nW(n){if(!n)return null;let e=n.filter(uM);return e.length==0?null:function(t){return hM(fM(t,e))}}function NT(n){return n!=null?nW(pM(n)):null}function rW(n){if(!n)return null;let e=n.filter(uM);return e.length==0?null:function(t){let r=fM(t,e).map(dM);return e0(r).pipe(ot(hM))}}function xT(n){return n!=null?rW(pM(n)):null}function eM(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function iW(n){return n._rawValidators}function sW(n){return n._rawAsyncValidators}function AT(n){return n?Array.isArray(n)?n:[n]:[]}function Up(n,e){return Array.isArray(n)?n.includes(e):n===e}function tM(n,e){let t=AT(e);return AT(n).forEach(i=>{Up(t,i)||t.push(i)}),t}function nM(n,e){return AT(e).filter(t=>!Up(n,t))}var qp=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=NT(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=xT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},tl=class extends qp{get formDirective(){return null}get path(){return null}},Su=class extends qp{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},zp=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},oW={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},$te=Tr(an({},oW),{"[class.ng-submitted]":"isSubmitted"}),mM=(()=>{class n extends zp{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(Fe(Su,2))}}static{this.\u0275dir=Cn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&po("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[ei]})}}return n})(),gM=(()=>{class n extends zp{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(Fe(tl,10))}}static{this.\u0275dir=Cn({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&po("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[ei]})}}return n})();var vu="VALID",Vp="INVALID",el="PENDING",wu="DISABLED";function yM(n){return($p(n)?n.validators:n)||null}function aW(n){return Array.isArray(n)?NT(n):n||null}function vM(n,e){return($p(e)?e.asyncValidators:n)||null}function lW(n){return Array.isArray(n)?xT(n):n||null}function $p(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function cW(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Zu(1e3,"");if(!r[t])throw new Zu(1001,"")}function uW(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Zu(1002,"")})}var Gp=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===vu}get invalid(){return this.status===Vp}get pending(){return this.status==el}get disabled(){return this.status===wu}get enabled(){return this.status!==wu}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(tM(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(tM(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(nM(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(nM(e,this._rawAsyncValidators))}hasValidator(e){return Up(this._rawValidators,e)}hasAsyncValidator(e){return Up(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=el,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=wu,this.errors=null,this._forEachChild(r=>{r.disable(Tr(an({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Tr(an({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=vu,this._forEachChild(r=>{r.enable(Tr(an({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Tr(an({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===vu||this.status===el)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wu:vu}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=el,this._hasOwnPendingAsyncValidator=!0;let t=dM(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new kl,this.statusChanges=new kl}_calculateStatus(){return this._allControlsDisabled()?wu:this.errors?Vp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(el)?el:this._anyControlsHaveStatus(Vp)?Vp:vu}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){$p(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=aW(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=lW(this._rawAsyncValidators)}},jp=class extends Gp{constructor(e,t,r){super(yM(t),vM(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){uW(this,!0,e),Object.keys(e).forEach(r=>{cW(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var kT=new Xe("CallSetDisabledState",{providedIn:"root",factory:()=>OT}),OT="always";function dW(n,e){return[...e.path,n]}function wM(n,e,t=OT){bM(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),fW(n,e),mW(n,e),pW(n,e),hW(n,e)}function rM(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function hW(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function bM(n,e){let t=iW(n);e.validator!==null?n.setValidators(eM(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=sW(n);e.asyncValidator!==null?n.setAsyncValidators(eM(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();rM(e._rawValidators,i),rM(e._rawAsyncValidators,i)}function fW(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&SM(n,e)})}function pW(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&SM(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function SM(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function mW(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function gW(n,e){n==null,bM(n,e)}function yW(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function vW(n){return Object.getPrototypeOf(n.constructor)===Q$}function wW(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function bW(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Kp?t=s:vW(s)?r=s:i=s}),i||r||t||null}var SW={provide:tl,useExisting:Nl(()=>MT)},bu=Promise.resolve(),MT=(()=>{class n extends tl{constructor(t,r,i){super(),this.callSetDisabledState=i,this.submitted=!1,this._directives=new Set,this.ngSubmit=new kl,this.form=new jp({},NT(t),xT(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){bu.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),wM(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){bu.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){bu.then(()=>{let r=this._findContainer(t.path),i=new jp({});gW(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){bu.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){bu.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,wW(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(r){return new(r||n)(Fe(RT,10),Fe(cM,10),Fe(kT,8))}}static{this.\u0275dir=Cn({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){r&1&&Dt("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{options:[xl.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Fl([SW]),ei]})}}return n})();function iM(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function sM(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var _W=class extends Gp{constructor(e=null,t,r){super(yM(t),vM(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),$p(t)&&(t.nonNullable||t.initialValueIsDefault)&&(sM(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){iM(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){iM(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){sM(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var TW={provide:Su,useExisting:Nl(()=>PT)},oM=Promise.resolve(),PT=(()=>{class n extends Su{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new _W,this._registered=!1,this.name="",this.update=new kl,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=bW(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),yW(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){wM(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){oM.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Hm(r);oM.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?dW(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(Fe(tl,9),Fe(RT,10),Fe(cM,10),Fe(lM,10),Fe(l0,8),Fe(kT,8))}}static{this.\u0275dir=Cn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[xl.None,"disabled","isDisabled"],model:[xl.None,"ngModel","model"],options:[xl.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Fl([TW]),ei,Vm]})}}return n})(),_M=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Cn({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var EW=(()=>{class n{constructor(){this._validator=ZO}ngOnChanges(t){if(this.inputName in t){let r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):ZO,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Cn({type:n,features:[Vm]})}}return n})();var CW={provide:RT,useExisting:Nl(()=>FT),multi:!0};var FT=(()=>{class n extends EW{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Hm,this.createValidator=t=>eW}enabled(t){return t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Um(n)))(i||n)}})()}static{this.\u0275dir=Cn({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,i){r&2&&s0("required",i._enabled?"":null)},inputs:{required:"required"},features:[Fl([CW]),ei]})}}return n})();var IW=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=$t({type:n})}static{this.\u0275inj=Kt({})}}return n})();var TM=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:kT,useValue:t.callSetDisabledState??OT}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=$t({type:n})}static{this.\u0275inj=Kt({imports:[IW]})}}return n})();var EM=(()=>{class n{constructor(t,r){this.firestore=t,this.router=r,this.name="",this.email="",this.specialization="",this.password="",this.loginEmail="",this.loginPassword=""}register(){let t={name:this.name,email:this.email,specialization:this.specialization,password:this.password};this.firestore.collection("doctors").add(t).then(()=>{alert("User registered successfully"),this.router.navigate(["/dashboard"])})}login(){this.firestore.collection("doctors",t=>t.where("email","==",this.loginEmail).where("password","==",this.loginPassword)).get().subscribe(t=>{t.empty?alert("Invalid credentials"):(alert("Login successful"),this.router.navigate(["/dashboard"]))})}static{this.\u0275fac=function(r){return new(r||n)(Fe(DT),Fe(nd))}}static{this.\u0275cmp=Jr({type:n,selectors:[["app-login"]],decls:19,vars:6,consts:[[1,"login-container"],[1,"form-container"],[3,"ngSubmit"],["type","text","name","name","placeholder","Name","required","",3,"ngModelChange","ngModel"],["type","email","name","email","placeholder","Email","required","",3,"ngModelChange","ngModel"],["type","text","name","specialization","placeholder","Specialization","required","",3,"ngModelChange","ngModel"],["type","password","name","password","placeholder","Password","required","",3,"ngModelChange","ngModel"],["type","submit"],["type","email","name","loginEmail","placeholder","Email","required","",3,"ngModelChange","ngModel"],["type","password","name","loginPassword","placeholder","Password","required","",3,"ngModelChange","ngModel"]],template:function(r,i){r&1&&(Z(0,"div",0)(1,"div",1)(2,"h2"),oe(3,"Register"),ee(),Z(4,"form",2),Dt("ngSubmit",function(){return i.register()}),Z(5,"input",3),us("ngModelChange",function(o){return cs(i.name,o)||(i.name=o),o}),ee(),Z(6,"input",4),us("ngModelChange",function(o){return cs(i.email,o)||(i.email=o),o}),ee(),Z(7,"input",5),us("ngModelChange",function(o){return cs(i.specialization,o)||(i.specialization=o),o}),ee(),Z(8,"input",6),us("ngModelChange",function(o){return cs(i.password,o)||(i.password=o),o}),ee(),Z(9,"button",7),oe(10,"Register"),ee()()(),Z(11,"div",1)(12,"h2"),oe(13,"Login"),ee(),Z(14,"form",2),Dt("ngSubmit",function(){return i.login()}),Z(15,"input",8),us("ngModelChange",function(o){return cs(i.loginEmail,o)||(i.loginEmail=o),o}),ee(),Z(16,"input",9),us("ngModelChange",function(o){return cs(i.loginPassword,o)||(i.loginPassword=o),o}),ee(),Z(17,"button",7),oe(18,"Login"),ee()()()()),r&2&&(qe(5),ls("ngModel",i.name),qe(),ls("ngModel",i.email),qe(),ls("ngModel",i.specialization),qe(),ls("ngModel",i.password),qe(7),ls("ngModel",i.loginEmail),qe(),ls("ngModel",i.loginPassword))},dependencies:[_M,Kp,mM,gM,FT,PT,MT],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:40px;padding:50px}.login-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:20px;border-radius:8px;box-shadow:0 4px 6px #0000001a}.login-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:#00796b}.login-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.login-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px;border:1px solid #ccc;border-radius:4px}.login-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px;background-color:#00796b;color:#fff;border:none;border-radius:4px;cursor:pointer}.login-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#00574b}"]})}}return n})();var AW={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var CM=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},RW=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],a=n[t++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},IM={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,a=o?n[i+1]:0,l=i+2<n.length,c=l?n[i+2]:0,u=s>>2,m=(s&3)<<4|a>>4,g=(a&15)<<2|c>>6,S=c&63;l||(S=64,o||(g=64)),r.push(t[u],t[m],t[g],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(CM(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):RW(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;let c=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||c==null||m==null)throw new LT;let g=s<<2|a>>4;if(r.push(g),c!==64){let S=a<<4&240|c>>2;if(r.push(S),m!==64){let T=c<<6&192|m;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},LT=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},NW=function(n){let e=CM(n);return IM.encodeByteArray(e,!0)},BT=function(n){return NW(n).replace(/\./g,"")},xW=function(n){try{return IM.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function kW(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var OW=()=>kW().__FIREBASE_DEFAULTS__,MW=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},PW=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&xW(n[1]);return e&&JSON.parse(e)},FW=()=>{try{return OW()||MW()||PW()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}};function DM(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function LW(){var n;let e=(n=FW())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function AM(){return!LW()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VT(){try{return typeof indexedDB=="object"}catch{return!1}}function RM(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var BW="FirebaseError",zr=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=BW,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_u.prototype.create)}},_u=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?VW(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new zr(i,a,r)}};function VW(n,e){return n.replace(UW,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var UW=/\{\$([^}]+)}/g;var Yte=4*60*60*1e3;function NM(n){return n&&n._delegate?n._delegate:n}AW.NODE_CLIENT=!0;var es=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var qW=[],me=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(me||{}),zW={debug:me.DEBUG,verbose:me.VERBOSE,info:me.INFO,warn:me.WARN,error:me.ERROR,silent:me.SILENT},GW=me.INFO,jW={[me.DEBUG]:"log",[me.VERBOSE]:"log",[me.INFO]:"info",[me.WARN]:"warn",[me.ERROR]:"error"},KW=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=jW[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},nl=class{constructor(e){this.name=e,this._logLevel=GW,this._logHandler=KW,this._userLogHandler=null,qW.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in me))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zW[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,me.DEBUG,...e),this._logHandler(this,me.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,me.VERBOSE,...e),this._logHandler(this,me.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,me.INFO,...e),this._logHandler(this,me.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,me.WARN,...e),this._logHandler(this,me.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,me.ERROR,...e),this._logHandler(this,me.ERROR,...e)}};var qT=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(WW(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function WW(n){let e=n.getComponent();return e?.type==="VERSION"}var zT="@firebase/app",xM="0.10.17";var Gr=new nl("@firebase/app"),HW="@firebase/app-compat",QW="@firebase/analytics-compat",YW="@firebase/analytics",XW="@firebase/app-check-compat",JW="@firebase/app-check",ZW="@firebase/auth",eH="@firebase/auth-compat",tH="@firebase/database",nH="@firebase/data-connect",rH="@firebase/database-compat",iH="@firebase/functions",sH="@firebase/functions-compat",oH="@firebase/installations",aH="@firebase/installations-compat",lH="@firebase/messaging",cH="@firebase/messaging-compat",uH="@firebase/performance",dH="@firebase/performance-compat",hH="@firebase/remote-config",fH="@firebase/remote-config-compat",pH="@firebase/storage",mH="@firebase/storage-compat",gH="@firebase/firestore",yH="@firebase/vertexai",vH="@firebase/firestore-compat",wH="firebase",bH="11.1.0";var SH={[zT]:"fire-core",[HW]:"fire-core-compat",[YW]:"fire-analytics",[QW]:"fire-analytics-compat",[JW]:"fire-app-check",[XW]:"fire-app-check-compat",[ZW]:"fire-auth",[eH]:"fire-auth-compat",[tH]:"fire-rtdb",[nH]:"fire-data-connect",[rH]:"fire-rtdb-compat",[iH]:"fire-fn",[sH]:"fire-fn-compat",[oH]:"fire-iid",[aH]:"fire-iid-compat",[lH]:"fire-fcm",[cH]:"fire-fcm-compat",[uH]:"fire-perf",[dH]:"fire-perf-compat",[hH]:"fire-rc",[fH]:"fire-rc-compat",[pH]:"fire-gcs",[mH]:"fire-gcs-compat",[gH]:"fire-fst",[vH]:"fire-fst-compat",[yH]:"fire-vertex","fire-js":"fire-js",[wH]:"fire-js-all"};var _H=new Map,TH=new Map,kM=new Map;function OM(n,e){try{n.container.addComponent(e)}catch(t){Gr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Tu(n){let e=n.name;if(kM.has(e))return Gr.debug(`There were multiple attempts to register component ${e}.`),!1;kM.set(e,n);for(let t of _H.values())OM(t,n);for(let t of TH.values())OM(t,n);return!0}var EH={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},KT=new _u("app","Firebase",EH);var LM=bH;function rl(n,e,t){var r;let i=(r=SH[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Gr.warn(a.join(" "));return}Tu(new es(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var CH="firebase-heartbeat-database",IH=1,Eu="firebase-heartbeat-store",UT=null;function BM(){return UT||(UT=w0(CH,IH,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Eu)}catch(t){console.warn(t)}}}}).catch(n=>{throw KT.create("idb-open",{originalErrorMessage:n.message})})),UT}function DH(n){return _(this,null,function*(){try{let t=(yield BM()).transaction(Eu),r=yield t.objectStore(Eu).get(VM(n));return yield t.done,r}catch(e){if(e instanceof zr)Gr.warn(e.message);else{let t=KT.create("idb-get",{originalErrorMessage:e?.message});Gr.warn(t.message)}}})}function MM(n,e){return _(this,null,function*(){try{let r=(yield BM()).transaction(Eu,"readwrite");yield r.objectStore(Eu).put(e,VM(n)),yield r.done}catch(t){if(t instanceof zr)Gr.warn(t.message);else{let r=KT.create("idb-set",{originalErrorMessage:t?.message});Gr.warn(r.message)}}})}function VM(n){return`${n.name}!${n.options.appId}`}var AH=1024,RH=30*24*60*60*1e3,GT=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new jT(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return _(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=PM();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=RH}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Gr.warn(r)}})}getHeartbeatsHeader(){return _(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=PM(),{heartbeatsToSend:r,unsentEntries:i}=NH(this._heartbeatsCache.heartbeats),s=BT(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Gr.warn(t),""}})}};function PM(){return new Date().toISOString().substring(0,10)}function NH(n,e=AH){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),FM(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),FM(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var jT=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return _(this,null,function*(){return VT()?RM().then(()=>!0).catch(()=>!1):!1})}read(){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield DH(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return _(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return MM(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return _(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return MM(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function FM(n){return BT(JSON.stringify({version:2,heartbeats:n})).length}function xH(n){Tu(new es("platform-logger",e=>new qT(e),"PRIVATE")),Tu(new es("heartbeat",e=>new GT(e),"PRIVATE")),rl(zT,xM,n),rl(zT,xM,"esm2017"),rl("fire-js","")}xH("");import{inspect as kH,TextEncoder as OH,TextDecoder as Ine}from"util";import{randomBytes as MH}from"crypto";var UM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qM={};var ts,$T;(function(){var n;function e(v,h){function p(){}p.prototype=h.prototype,v.D=h.prototype,v.prototype=new p,v.prototype.constructor=v,v.C=function(y,f,w){for(var d=Array(arguments.length-2),b=2;b<arguments.length;b++)d[b-2]=arguments[b];return h.prototype[f].apply(y,d)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,h,p){p||(p=0);var y=Array(16);if(typeof h=="string")for(var f=0;16>f;++f)y[f]=h.charCodeAt(p++)|h.charCodeAt(p++)<<8|h.charCodeAt(p++)<<16|h.charCodeAt(p++)<<24;else for(f=0;16>f;++f)y[f]=h[p++]|h[p++]<<8|h[p++]<<16|h[p++]<<24;h=v.g[0],p=v.g[1],f=v.g[2];var w=v.g[3],d=h+(w^p&(f^w))+y[0]+3614090360&4294967295;h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[1]+3905402710&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[2]+606105819&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[3]+3250441966&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(w^p&(f^w))+y[4]+4118548399&4294967295,h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[5]+1200080426&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[6]+2821735955&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[7]+4249261313&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(w^p&(f^w))+y[8]+1770035416&4294967295,h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[9]+2336552879&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[10]+4294925233&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[11]+2304563134&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(w^p&(f^w))+y[12]+1804603682&4294967295,h=p+(d<<7&4294967295|d>>>25),d=w+(f^h&(p^f))+y[13]+4254626195&4294967295,w=h+(d<<12&4294967295|d>>>20),d=f+(p^w&(h^p))+y[14]+2792965006&4294967295,f=w+(d<<17&4294967295|d>>>15),d=p+(h^f&(w^h))+y[15]+1236535329&4294967295,p=f+(d<<22&4294967295|d>>>10),d=h+(f^w&(p^f))+y[1]+4129170786&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[6]+3225465664&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[11]+643717713&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[0]+3921069994&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(f^w&(p^f))+y[5]+3593408605&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[10]+38016083&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[15]+3634488961&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[4]+3889429448&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(f^w&(p^f))+y[9]+568446438&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[14]+3275163606&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[3]+4107603335&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[8]+1163531501&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(f^w&(p^f))+y[13]+2850285829&4294967295,h=p+(d<<5&4294967295|d>>>27),d=w+(p^f&(h^p))+y[2]+4243563512&4294967295,w=h+(d<<9&4294967295|d>>>23),d=f+(h^p&(w^h))+y[7]+1735328473&4294967295,f=w+(d<<14&4294967295|d>>>18),d=p+(w^h&(f^w))+y[12]+2368359562&4294967295,p=f+(d<<20&4294967295|d>>>12),d=h+(p^f^w)+y[5]+4294588738&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[8]+2272392833&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[11]+1839030562&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[14]+4259657740&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(p^f^w)+y[1]+2763975236&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[4]+1272893353&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[7]+4139469664&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[10]+3200236656&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(p^f^w)+y[13]+681279174&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[0]+3936430074&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[3]+3572445317&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[6]+76029189&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(p^f^w)+y[9]+3654602809&4294967295,h=p+(d<<4&4294967295|d>>>28),d=w+(h^p^f)+y[12]+3873151461&4294967295,w=h+(d<<11&4294967295|d>>>21),d=f+(w^h^p)+y[15]+530742520&4294967295,f=w+(d<<16&4294967295|d>>>16),d=p+(f^w^h)+y[2]+3299628645&4294967295,p=f+(d<<23&4294967295|d>>>9),d=h+(f^(p|~w))+y[0]+4096336452&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[7]+1126891415&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[14]+2878612391&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[5]+4237533241&4294967295,p=f+(d<<21&4294967295|d>>>11),d=h+(f^(p|~w))+y[12]+1700485571&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[3]+2399980690&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[10]+4293915773&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[1]+2240044497&4294967295,p=f+(d<<21&4294967295|d>>>11),d=h+(f^(p|~w))+y[8]+1873313359&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[15]+4264355552&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[6]+2734768916&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[13]+1309151649&4294967295,p=f+(d<<21&4294967295|d>>>11),d=h+(f^(p|~w))+y[4]+4149444226&4294967295,h=p+(d<<6&4294967295|d>>>26),d=w+(p^(h|~f))+y[11]+3174756917&4294967295,w=h+(d<<10&4294967295|d>>>22),d=f+(h^(w|~p))+y[2]+718787259&4294967295,f=w+(d<<15&4294967295|d>>>17),d=p+(w^(f|~h))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+h&4294967295,v.g[1]=v.g[1]+(f+(d<<21&4294967295|d>>>11))&4294967295,v.g[2]=v.g[2]+f&4294967295,v.g[3]=v.g[3]+w&4294967295}r.prototype.u=function(v,h){h===void 0&&(h=v.length);for(var p=h-this.blockSize,y=this.B,f=this.h,w=0;w<h;){if(f==0)for(;w<=p;)i(this,v,w),w+=this.blockSize;if(typeof v=="string"){for(;w<h;)if(y[f++]=v.charCodeAt(w++),f==this.blockSize){i(this,y),f=0;break}}else for(;w<h;)if(y[f++]=v[w++],f==this.blockSize){i(this,y),f=0;break}}this.h=f,this.o+=h},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var h=1;h<v.length-8;++h)v[h]=0;var p=8*this.o;for(h=v.length-8;h<v.length;++h)v[h]=p&255,p/=256;for(this.u(v),v=Array(16),h=p=0;4>h;++h)for(var y=0;32>y;y+=8)v[p++]=this.g[h]>>>y&255;return v};function s(v,h){var p=a;return Object.prototype.hasOwnProperty.call(p,v)?p[v]:p[v]=h(v)}function o(v,h){this.h=h;for(var p=[],y=!0,f=v.length-1;0<=f;f--){var w=v[f]|0;y&&w==h||(p[f]=w,y=!1)}this.g=p}var a={};function l(v){return-128<=v&&128>v?s(v,function(h){return new o([h|0],0>h?-1:0)}):new o([v|0],0>v?-1:0)}function c(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return E(c(-v));for(var h=[],p=1,y=0;v>=p;y++)h[y]=v/p|0,p*=4294967296;return new o(h,0)}function u(v,h){if(v.length==0)throw Error("number format error: empty string");if(h=h||10,2>h||36<h)throw Error("radix out of range: "+h);if(v.charAt(0)=="-")return E(u(v.substring(1),h));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var p=c(Math.pow(h,8)),y=m,f=0;f<v.length;f+=8){var w=Math.min(8,v.length-f),d=parseInt(v.substring(f,f+w),h);8>w?(w=c(Math.pow(h,w)),y=y.j(w).add(c(d))):(y=y.j(p),y=y.add(c(d)))}return y}var m=l(0),g=l(1),S=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-E(this).m();for(var v=0,h=1,p=0;p<this.g.length;p++){var y=this.i(p);v+=(0<=y?y:4294967296+y)*h,h*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(T(this))return"0";if(C(this))return"-"+E(this).toString(v);for(var h=c(Math.pow(v,6)),p=this,y="";;){var f=O(p,h).g;p=x(p,f.j(h));var w=((0<p.g.length?p.g[0]:p.h)>>>0).toString(v);if(p=f,T(p))return w+y;for(;6>w.length;)w="0"+w;y=w+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function T(v){if(v.h!=0)return!1;for(var h=0;h<v.g.length;h++)if(v.g[h]!=0)return!1;return!0}function C(v){return v.h==-1}n.l=function(v){return v=x(this,v),C(v)?-1:T(v)?0:1};function E(v){for(var h=v.g.length,p=[],y=0;y<h;y++)p[y]=~v.g[y];return new o(p,~v.h).add(g)}n.abs=function(){return C(this)?E(this):this},n.add=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0,f=0;f<=h;f++){var w=y+(this.i(f)&65535)+(v.i(f)&65535),d=(w>>>16)+(this.i(f)>>>16)+(v.i(f)>>>16);y=d>>>16,w&=65535,d&=65535,p[f]=d<<16|w}return new o(p,p[p.length-1]&-2147483648?-1:0)};function x(v,h){return v.add(E(h))}n.j=function(v){if(T(this)||T(v))return m;if(C(this))return C(v)?E(this).j(E(v)):E(E(this).j(v));if(C(v))return E(this.j(E(v)));if(0>this.l(S)&&0>v.l(S))return c(this.m()*v.m());for(var h=this.g.length+v.g.length,p=[],y=0;y<2*h;y++)p[y]=0;for(y=0;y<this.g.length;y++)for(var f=0;f<v.g.length;f++){var w=this.i(y)>>>16,d=this.i(y)&65535,b=v.i(f)>>>16,V=v.i(f)&65535;p[2*y+2*f]+=d*V,A(p,2*y+2*f),p[2*y+2*f+1]+=w*V,A(p,2*y+2*f+1),p[2*y+2*f+1]+=d*b,A(p,2*y+2*f+1),p[2*y+2*f+2]+=w*b,A(p,2*y+2*f+2)}for(y=0;y<h;y++)p[y]=p[2*y+1]<<16|p[2*y];for(y=h;y<2*h;y++)p[y]=0;return new o(p,0)};function A(v,h){for(;(v[h]&65535)!=v[h];)v[h+1]+=v[h]>>>16,v[h]&=65535,h++}function k(v,h){this.g=v,this.h=h}function O(v,h){if(T(h))throw Error("division by zero");if(T(v))return new k(m,m);if(C(v))return h=O(E(v),h),new k(E(h.g),E(h.h));if(C(h))return h=O(v,E(h)),new k(E(h.g),h.h);if(30<v.g.length){if(C(v)||C(h))throw Error("slowDivide_ only works with positive integers.");for(var p=g,y=h;0>=y.l(v);)p=z(p),y=z(y);var f=Q(p,1),w=Q(y,1);for(y=Q(y,2),p=Q(p,2);!T(y);){var d=w.add(y);0>=d.l(v)&&(f=f.add(p),w=d),y=Q(y,1),p=Q(p,1)}return h=x(v,f.j(h)),new k(f,h)}for(f=m;0<=v.l(h);){for(p=Math.max(1,Math.floor(v.m()/h.m())),y=Math.ceil(Math.log(p)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),w=c(p),d=w.j(h);C(d)||0<d.l(v);)p-=y,w=c(p),d=w.j(h);T(w)&&(w=g),f=f.add(w),v=x(v,d)}return new k(f,v)}n.A=function(v){return O(this,v).h},n.and=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0;y<h;y++)p[y]=this.i(y)&v.i(y);return new o(p,this.h&v.h)},n.or=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0;y<h;y++)p[y]=this.i(y)|v.i(y);return new o(p,this.h|v.h)},n.xor=function(v){for(var h=Math.max(this.g.length,v.g.length),p=[],y=0;y<h;y++)p[y]=this.i(y)^v.i(y);return new o(p,this.h^v.h)};function z(v){for(var h=v.g.length+1,p=[],y=0;y<h;y++)p[y]=v.i(y)<<1|v.i(y-1)>>>31;return new o(p,v.h)}function Q(v,h){var p=h>>5;h%=32;for(var y=v.g.length-p,f=[],w=0;w<y;w++)f[w]=0<h?v.i(w+p)>>>h|v.i(w+p+1)<<32-h:v.i(w+p);return new o(f,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,$T=qM.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,ts=qM.Integer=o}).apply(typeof UM<"u"?UM:typeof self<"u"?self:typeof window<"u"?window:{});var so=Yu(Ow(),1),I1=Yu(sh(),1);var zM="@firebase/firestore",GM="4.7.5";var Ot=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ot.UNAUTHENTICATED=new Ot(null);Ot.GOOGLE_CREDENTIALS=new Ot("google-credentials-uid");Ot.FIRST_PARTY=new Ot("first-party-uid");Ot.MOCK_USER=new Ot("mock-user");var PH="11.0.2";var El=PH;function FH(n){El=n}function LH(n){return kH(n,{depth:100})}var oo=new nl("@firebase/firestore");function il(){return oo.logLevel}function H(n,...e){if(oo.logLevel<=me.DEBUG){let t=e.map(MC);oo.debug(`Firestore (${El}): ${n}`,...t)}}function jn(n,...e){if(oo.logLevel<=me.ERROR){let t=e.map(MC);oo.error(`Firestore (${El}): ${n}`,...t)}}function Iu(n,...e){if(oo.logLevel<=me.WARN){let t=e.map(MC);oo.warn(`Firestore (${El}): ${n}`,...t)}}function MC(n){if(typeof n=="string")return n;try{return LH(n)}catch{return n}}function se(n="Unexpected state"){let e=`FIRESTORE (${El}) INTERNAL ASSERTION FAILED: `+n;throw jn(e),new Error(e)}function $e(n,e){n||se()}function ye(n,e){return n}var K={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ne=class extends zr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Kr=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var nE=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},rE=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ot.UNAUTHENTICATED))}shutdown(){}};var iE=class{constructor(e){this.authProvider=e,this.currentUser=Ot.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){$e(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Kr;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Kr,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>_(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Kr)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($e(typeof r.accessToken=="string"),new nE(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return $e(e===null||typeof e=="string"),new Ot(e)}},sE=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Ot.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},oE=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new sE(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}},aE=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},lE=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){$e(this.tokenListener===void 0);let r=s=>{s.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,H("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($e(typeof t.token=="string"),this.latestAppCheckToken=t.token,new aE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function BH(n){if(!n)return new rE;switch(n.type){case"firstParty":return new oE(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new ne(K.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function VH(n){return MH(n)}var cE=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=VH(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ge(n,e){return n<e?-1:n>e?1:0}function ao(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}var jM=-62135596800,KM=1e6,Tn=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*KM);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ne(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ne(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<jM)throw new ne(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ne(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/KM}_compareTo(e){return this.seconds===e.seconds?ge(this.nanoseconds,e.nanoseconds):ge(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-jM,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var le=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Tn(0,0))}static max(){return new n(new Tn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var $M="__name__",Jp=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&se(),r===void 0?r=e.length-t:r>e.length-t&&se(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},St=class n extends Jp{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new ne(K.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},UH=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kn=class n extends Jp{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return UH.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===$M}static keyField(){return new n([$M])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new ne(K.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new ne(K.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new ne(K.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new ne(K.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var te=class n{constructor(e){this.path=e}static fromPath(e){return new n(St.fromString(e))}static fromName(e){return new n(St.fromString(e).popFirst(5))}static empty(){return new n(St.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&St.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return St.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new St(e.slice()))}};var xu=-1;function qH(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=le.fromTimestamp(r===1e9?new Tn(t+1,0):new Tn(t,r));return new lo(i,te.empty(),e)}function zH(n){return new lo(n.readTime,n.key,xu)}var lo=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(le.min(),te.empty(),xu)}static max(){return new n(le.max(),te.empty(),xu)}};function GH(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=te.comparator(n.documentKey,e.documentKey),t!==0)?t:ge(n.largestBatchId,e.largestBatchId)}var jH="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",uE=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Tm(n){return _(this,null,function*(){if(n.code===K.FAILED_PRECONDITION&&n.message===jH)H("LocalStore","Unexpectedly lost primary lease");else throw n})}var M=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&se(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function KH(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Cl(n){return n.name==="IndexedDbTransactionError"}var Nne=15*1e3,xne=60*1e3;var PC=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Yp="",$H="",WH="",HH="";function QH(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=WM(e)),e=YH(n.get(t),e);return WM(e)}function YH(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Yp+WH;break;case Yp:t+=Yp+HH;break;default:t+=s}}return t}function WM(n){return n+Yp+$H}var XH="remoteDocuments";var D1="owner";var A1="mutationQueues";var R1="mutations";var N1="documentMutations",JH="remoteDocumentsV14";var x1="remoteDocumentGlobal";var k1="targets";var O1="targetDocuments";var M1="targetGlobal",P1="collectionParents";var F1="clientMetadata";var L1="bundles";var B1="namedQueries";var ZH="indexConfiguration";var e7="indexState";var t7="indexEntries";var V1="documentOverlays";var n7="globals";var r7=[A1,R1,N1,XH,k1,D1,M1,O1],i7=r7,s7=[...i7,F1],o7=[...s7,x1],a7=[...o7,P1],l7=[...a7,L1,B1],kne=[...l7,V1],c7=[A1,R1,N1,JH,k1,D1,M1,O1,F1,x1,P1,L1,B1,V1],u7=c7,d7=[...u7,ZH,e7,t7];var One=[...d7,n7];function HM(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function $u(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function h7(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var rt=class n{constructor(e,t){this.comparator=e,this.root=t||Du.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Du.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Du.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new al(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new al(this.root,e,this.comparator,!1)}getReverseIterator(){return new al(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new al(this.root,e,this.comparator,!0)}},al=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Du=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw se();let t=this.left.check();if(t!==this.right.check())throw se();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),dE=class{constructor(){this.size=0}get key(){throw se()}get value(){throw se()}get color(){throw se()}get left(){throw se()}get right(){throw se()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Du(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Du.EMPTY=new dE;var _t=class n{constructor(e){this.comparator=e,this.data=new rt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Zp(this.data.getIterator())}getIteratorFrom(e){return new Zp(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Zp=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var no=class n{constructor(e){this.fields=e,e.sort(Kn.comparator)}static empty(){return new n([])}unionWith(e){let t=new _t(Kn.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ao(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function f7(n){return Buffer.from(n,"base64").toString("binary")}function p7(n){return Buffer.from(n,"binary").toString("base64")}var Mt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=f7(e);return new n(t)}static fromUint8Array(e){let t=m7(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return p7(this.binaryString)}toUint8Array(){return g7(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ge(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Mt.EMPTY_BYTE_STRING=new Mt("");function m7(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function g7(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var y7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $r(n){if($e(!!n),typeof n=="string"){let e=0,t=y7.exec(n);if($e(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ve(n.seconds),t=Ve(n.nanos);return{seconds:e,nanos:t}}}function Ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Wr(n){return typeof n=="string"?Mt.fromBase64String(n):Mt.fromUint8Array(n)}var U1="server_timestamp",q1="__type__",z1="__previous_value__",G1="__local_write_time__";function FC(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[q1])===null||t===void 0?void 0:t.stringValue)===U1}function v7(n,e){let t={fields:{[q1]:{stringValue:U1},[G1]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&FC(e)&&(e=Em(e)),e&&(t.fields[z1]=e),{mapValue:t}}function Em(n){let e=n.mapValue.fields[z1];return FC(e)?Em(e):e}function ku(n){let e=$r(n.mapValue.fields[G1].timestampValue);return new Tn(e.seconds,e.nanos)}var hE=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},QM="(default)",em=class n{constructor(e,t){this.projectId=e,this.database=t||QM}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===QM}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function w7(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new ne(K.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new em(n.options.projectId,e)}var b7=-1;function Cm(n){return n==null}function tm(n){return n===0&&1/n===-1/0}var j1="__type__",K1="__max__",Wp={mapValue:{fields:{__type__:{stringValue:K1}}}},$1="__vector__",Ou="value";function ns(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?FC(n)?4:Q1(n)?9007199254740991:H1(n)?10:11:se()}function Gn(n,e){if(n===e)return!0;let t=ns(n),r=ns(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ku(n).isEqual(ku(e));case 3:return S7(n,e);case 5:return n.stringValue===e.stringValue;case 6:return T7(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return _7(n,e);case 2:return E7(n,e);case 9:return ao(n.arrayValue.values||[],e.arrayValue.values||[],Gn);case 10:case 11:return C7(n,e);case 9007199254740991:return!0;default:return se()}}function S7(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=$r(n.timestampValue),r=$r(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function _7(n,e){return Ve(n.geoPointValue.latitude)===Ve(e.geoPointValue.latitude)&&Ve(n.geoPointValue.longitude)===Ve(e.geoPointValue.longitude)}function T7(n,e){return Wr(n.bytesValue).isEqual(Wr(e.bytesValue))}function E7(n,e){if("integerValue"in n&&"integerValue"in e)return Ve(n.integerValue)===Ve(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ve(n.doubleValue),r=Ve(e.doubleValue);return t===r?tm(t)===tm(r):isNaN(t)&&isNaN(r)}return!1}function C7(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(HM(t)!==HM(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Gn(t[i],r[i])))return!1;return!0}function Mu(n,e){return(n.values||[]).find(t=>Gn(t,e))!==void 0}function dl(n,e){if(n===e)return 0;let t=ns(n),r=ns(e);if(t!==r)return ge(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ge(n.booleanValue,e.booleanValue);case 2:return I7(n,e);case 3:return YM(n.timestampValue,e.timestampValue);case 4:return YM(ku(n),ku(e));case 5:return ge(n.stringValue,e.stringValue);case 6:return R7(n.bytesValue,e.bytesValue);case 7:return D7(n.referenceValue,e.referenceValue);case 8:return A7(n.geoPointValue,e.geoPointValue);case 9:return W1(n.arrayValue,e.arrayValue);case 10:return N7(n.mapValue,e.mapValue);case 11:return x7(n.mapValue,e.mapValue);default:throw se()}}function I7(n,e){let t=Ve(n.integerValue||n.doubleValue),r=Ve(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function YM(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ge(n,e);let t=$r(n),r=$r(e),i=ge(t.seconds,r.seconds);return i!==0?i:ge(t.nanos,r.nanos)}function D7(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ge(t[i],r[i]);if(s!==0)return s}return ge(t.length,r.length)}function A7(n,e){let t=ge(Ve(n.latitude),Ve(e.latitude));return t!==0?t:ge(Ve(n.longitude),Ve(e.longitude))}function R7(n,e){let t=Wr(n),r=Wr(e);return t.compareTo(r)}function W1(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=dl(t[i],r[i]);if(s)return s}return ge(t.length,r.length)}function N7(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Ou])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Ou])===null||r===void 0?void 0:r.arrayValue,u=ge(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:W1(l,c)}function x7(n,e){if(n===Wp.mapValue&&e===Wp.mapValue)return 0;if(n===Wp.mapValue)return 1;if(e===Wp.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ge(r[o],s[o]);if(a!==0)return a;let l=dl(t[r[o]],i[s[o]]);if(l!==0)return l}return ge(r.length,s.length)}function hl(n){return LC(n)}function LC(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?O7(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?k7(n.bytesValue):"referenceValue"in n?P7(n.referenceValue):"geoPointValue"in n?M7(n.geoPointValue):"arrayValue"in n?L7(n.arrayValue):"mapValue"in n?F7(n.mapValue):se()}function k7(n){return Wr(n).toBase64()}function O7(n){let e=$r(n);return`time(${e.seconds},${e.nanos})`}function M7(n){return`geo(${n.latitude},${n.longitude})`}function P7(n){return te.fromName(n).toString()}function F7(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${LC(n.fields[i])}`;return t+"}"}function L7(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=LC(r);return e+"]"}function Im(n){switch(ns(n)){case 0:return 4;case 1:return 4;case 2:return 8;case 3:return 16;case 4:let e=Em(n);return e?16+Im(e):16;case 5:return n.stringValue.length*2;case 6:return Wr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 8:return 16;case 9:return V7(n.arrayValue);case 10:case 11:return B7(n.mapValue);default:throw se()}}function B7(n){let e=0;return $u(n.fields,(t,r)=>{e+=t.length+Im(r)}),e}function V7(n){return(n.values||[]).reduce((e,t)=>e+Im(t),0)}function fE(n){return!!n&&"integerValue"in n}function U7(n){return!!n&&"doubleValue"in n}function q7(n){return fE(n)||U7(n)}function BC(n){return!!n&&"arrayValue"in n}function XM(n){return!!n&&"nullValue"in n}function JM(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function WT(n){return!!n&&"mapValue"in n}function H1(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[j1])===null||t===void 0?void 0:t.stringValue)===$1}function Au(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return $u(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Au(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Au(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function Q1(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===K1}var Mne={mapValue:{fields:{[j1]:{stringValue:$1},[Ou]:{arrayValue:{}}}}};var jr=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!WT(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Au(t)}setAll(e){let t=Kn.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Au(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());WT(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Gn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!WT(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){$u(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Au(this.value))}};var $n=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,le.min(),le.min(),le.min(),jr.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,le.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,le.min(),le.min(),jr.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,le.min(),le.min(),jr.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(le.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=le.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function z7(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?dl(r,i):se()}var fl=class{constructor(e,t){this.position=e,this.inclusive=t}};function Y1(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=te.comparator(te.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=dl(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function G7(n,e,t){let r=Y1(n,e,t);return n.inclusive?r>=0:r>0}function j7(n,e,t){let r=Y1(n,e,t);return n.inclusive?r<=0:r<0}function ZM(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Gn(r,i))return!1}return!0}var pl=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function K7(n){return n.field.canonicalString()+n.dir}function $7(n){return`${n.field.canonicalString()} (${n.dir})`}function W7(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var nm=class{},mt=class n extends nm{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new mE(e,t,r):t==="array-contains"?new vE(e,r):t==="in"?new wE(e,r):t==="not-in"?new bE(e,r):t==="array-contains-any"?new SE(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new gE(e,r):new yE(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(dl(t,this.value)):t!==null&&ns(this.value)===ns(t)&&this.matchesComparison(dl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return se()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},_r=class n extends nm{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return X1(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function X1(n){return n.op==="and"}function J1(n){return H7(n)&&X1(n)}function H7(n){for(let e of n.filters)if(e instanceof _r)return!1;return!0}function pE(n){if(n instanceof mt)return n.field.canonicalString()+n.op.toString()+hl(n.value);if(J1(n))return n.filters.map(e=>pE(e)).join(",");{let e=n.filters.map(t=>pE(t)).join(",");return`${n.op}(${e})`}}function Z1(n,e){if(n instanceof mt)return Q7(n,e);if(n instanceof _r)return Y7(n,e);se()}function Q7(n,e){return e instanceof mt&&n.op===e.op&&n.field.isEqual(e.field)&&Gn(n.value,e.value)}function Y7(n,e){return e instanceof _r&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&Z1(i,e.filters[s]),!0):!1}function eP(n){return n instanceof mt?J7(n):n instanceof _r?X7(n):"Filter"}function X7(n){return n.op.toString()+" {"+n.getFilters().map(eP).join(" ,")+"}"}function J7(n){return`${n.field.canonicalString()} ${n.op} ${hl(n.value)}`}var mE=class extends mt{constructor(e,t,r){super(e,t,r),this.key=te.fromName(r.referenceValue)}matches(e){let t=te.comparator(e.key,this.key);return this.matchesComparison(t)}},gE=class extends mt{constructor(e,t){super(e,"in",t),this.keys=tP("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},yE=class extends mt{constructor(e,t){super(e,"not-in",t),this.keys=tP("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function tP(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>te.fromName(r.referenceValue))}var vE=class extends mt{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return BC(t)&&Mu(t.arrayValue,this.value)}},wE=class extends mt{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Mu(this.value.arrayValue,t)}},bE=class extends mt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Mu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Mu(this.value.arrayValue,t)}},SE=class extends mt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!BC(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Mu(this.value.arrayValue,r))}};var _E=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function e1(n,e=null,t=[],r=[],i=null,s=null,o=null){return new _E(n,e,t,r,i,s,o)}function VC(n){let e=ye(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>pE(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>K7(r)).join(","),Cm(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>hl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>hl(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function Z7(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>eP(t)).join(", ")}]`),Cm(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>$7(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>hl(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>hl(t)).join(",")),`Target(${e})`}function UC(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!W7(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Z1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!ZM(n.startAt,e.startAt)?!1:ZM(n.endAt,e.endAt)}function TE(n){return te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var ml=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function eQ(n,e,t,r,i,s,o,a){return new ml(n,e,t,r,i,s,o,a)}function qC(n){return new ml(n)}function tQ(n,e){return new ml(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function t1(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function nQ(n){let e=new _t(Kn.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function rQ(n){return te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function iQ(n){return n.collectionGroup!==null}function Pu(n){let e=ye(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";nQ(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new pl(s,r))}),t.has(Kn.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new pl(Kn.keyField(),r))}return e.memoizedNormalizedOrderBy}function Sr(n){let e=ye(n);return e.memoizedTarget||(e.memoizedTarget=sQ(e,Pu(n))),e.memoizedTarget}function sQ(n,e){if(n.limitType==="F")return e1(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new pl(i.field,s)});let t=n.endAt?new fl(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new fl(n.startAt.position,n.startAt.inclusive):null;return e1(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function EE(n,e,t){return new ml(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Dm(n,e){return UC(Sr(n),Sr(e))&&n.limitType===e.limitType}function nP(n){return`${VC(Sr(n))}|lt:${n.limitType}`}function sl(n){return`Query(target=${Z7(Sr(n))}; limitType=${n.limitType})`}function Am(n,e){return e.isFoundDocument()&&oQ(n,e)&&aQ(n,e)&&lQ(n,e)&&cQ(n,e)}function oQ(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):te.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function aQ(n,e){for(let t of Pu(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function lQ(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function cQ(n,e){return!(n.startAt&&!j7(n.startAt,Pu(n),e)||n.endAt&&!G7(n.endAt,Pu(n),e))}function uQ(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function rP(n){return(e,t)=>{let r=!1;for(let i of Pu(n)){let s=dQ(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function dQ(n,e,t){let r=n.field.isKeyField()?te.comparator(e.key,t.key):z7(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return se()}}var Hr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$u(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return h7(this.inner)}size(){return this.innerSize}};var hQ=new rt(te.comparator);function rs(){return hQ}var iP=new rt(te.comparator);function Cu(...n){let e=iP;for(let t of n)e=e.insert(t.key,t);return e}function fQ(){return Fu()}function pQ(n){let e=iP;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ro(){return Fu()}function sP(){return Fu()}function Fu(){return new Hr(n=>n.toString(),(n,e)=>n.isEqual(e))}var Pne=new rt(te.comparator);var mQ=new _t(te.comparator);function Se(...n){let e=mQ;for(let t of n)e=e.add(t);return e}var gQ=new _t(ge);function yQ(){return gQ}function vQ(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tm(e)?"-0":e}}function wQ(n){return{integerValue:""+n}}var gl=class{constructor(){this._=void 0}};function bQ(n,e,t){return n instanceof Lu?v7(t,e):n instanceof yl?oP(n,e):n instanceof vl?aP(n,e):EQ(n,e)}function SQ(n,e,t){return n instanceof yl?oP(n,e):n instanceof vl?aP(n,e):t}function _Q(n,e){return n instanceof Bu?q7(e)?e:{integerValue:0}:null}function TQ(n,e){return n instanceof yl&&e instanceof yl||n instanceof vl&&e instanceof vl?ao(n.elements,e.elements,Gn):n instanceof Bu&&e instanceof Bu?Gn(n.operand,e.operand):n instanceof Lu&&e instanceof Lu}var Lu=class extends gl{},yl=class extends gl{constructor(e){super(),this.elements=e}};function oP(n,e){let t=lP(e);for(let r of n.elements)t.some(i=>Gn(i,r))||t.push(r);return{arrayValue:{values:t}}}var vl=class extends gl{constructor(e){super(),this.elements=e}};function aP(n,e){let t=lP(e);for(let r of n.elements)t=t.filter(i=>!Gn(i,r));return{arrayValue:{values:t}}}var Bu=class extends gl{constructor(e,t){super(),this.serializer=e,this.operand=t}};function EQ(n,e){let t=_Q(n,e),r=n1(t)+n1(n.operand);return fE(t)&&fE(n.operand)?wQ(r):vQ(n.serializer,r)}function n1(n){return Ve(n.integerValue||n.doubleValue)}function lP(n){return BC(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function CQ(n,e){return n.field.isEqual(e.field)&&TQ(n.transform,e.transform)}function IQ(n,e){return n===void 0&&e===void 0?!0:n&&e?ao(n,e,(t,r)=>CQ(t,r)):!1}var Ru=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Rm(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Vu=class{};function cP(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new CE(n.key,Ru.none()):new Uu(n.key,n.data,Ru.none());{let t=n.data,r=jr.empty(),i=new _t(Kn.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new wl(n.key,r,new no(i.toArray()),Ru.none())}}function DQ(n,e,t){n instanceof Uu?AQ(n,e,t):n instanceof wl?NQ(n,e,t):kQ(n,e,t)}function Nu(n,e,t,r){return n instanceof Uu?RQ(n,e,t,r):n instanceof wl?xQ(n,e,t,r):OQ(n,e,t)}function r1(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!IQ(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Uu=class extends Vu{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function AQ(n,e,t){let r=n.value.clone(),i=dP(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function RQ(n,e,t,r){if(!Rm(n.precondition,e))return t;let i=n.value.clone(),s=hP(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var wl=class extends Vu{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function NQ(n,e,t){if(!Rm(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=dP(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(uP(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function xQ(n,e,t,r){if(!Rm(n.precondition,e))return t;let i=hP(n.fieldTransforms,r,e),s=e.data;return s.setAll(uP(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function uP(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function dP(n,e,t){let r=new Map;$e(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,SQ(o,a,t[i]))}return r}function hP(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,bQ(s,o,e))}return r}var CE=class extends Vu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function kQ(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function OQ(n,e,t){return Rm(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var IE=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];DQ(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Nu(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Nu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sP();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=cP(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(le.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Se())}isEqual(e){return this.batchId===e.batchId&&ao(this.mutations,e.mutations,(t,r)=>r1(t,r))&&ao(this.baseMutations,e.baseMutations,(t,r)=>r1(t,r))}};var DE=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var AE=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var bt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(bt||{});function Xp(n){if(n===void 0)return jn("GRPC error has no .code"),K.UNKNOWN;switch(n){case bt.OK:return K.OK;case bt.CANCELLED:return K.CANCELLED;case bt.UNKNOWN:return K.UNKNOWN;case bt.DEADLINE_EXCEEDED:return K.DEADLINE_EXCEEDED;case bt.RESOURCE_EXHAUSTED:return K.RESOURCE_EXHAUSTED;case bt.INTERNAL:return K.INTERNAL;case bt.UNAVAILABLE:return K.UNAVAILABLE;case bt.UNAUTHENTICATED:return K.UNAUTHENTICATED;case bt.INVALID_ARGUMENT:return K.INVALID_ARGUMENT;case bt.NOT_FOUND:return K.NOT_FOUND;case bt.ALREADY_EXISTS:return K.ALREADY_EXISTS;case bt.PERMISSION_DENIED:return K.PERMISSION_DENIED;case bt.FAILED_PRECONDITION:return K.FAILED_PRECONDITION;case bt.ABORTED:return K.ABORTED;case bt.OUT_OF_RANGE:return K.OUT_OF_RANGE;case bt.UNIMPLEMENTED:return K.UNIMPLEMENTED;case bt.DATA_LOSS:return K.DATA_LOSS;default:return se()}}var RE=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var HT=null;function MQ(){return new OH}var PQ=new ts([4294967295,4294967295],0);function i1(n){let e=MQ().encode(n),t=new $T;return t.update(e),new Uint8Array(t.digest())}function s1(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new ts([t,r],0),a=new ts([i,s],0);return[o,a]}var NE=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new io(`Invalid padding: ${t}`);if(r<0)throw new io(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new io(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new io(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=ts.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(ts.fromNumber(r)));return i.compare(PQ)===1&&(i=new ts([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=i1(e),[r,i]=s1(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=i1(e),[r,i]=s1(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},io=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var rm=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,qu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(le.min(),i,new rt(ge),rs(),Se())}},qu=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Se(),Se(),Se())}};var cl=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},im=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},sm=class{constructor(e,t,r=Mt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},om=class{constructor(){this.pendingResponses=0,this.documentChanges=o1(),this._resumeToken=Mt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Se(),t=Se(),r=Se();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:se()}}),new qu(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=o1()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,$e(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},FQ="WatchChangeAggregator",xE=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=rs(),this.pendingDocumentUpdatesByTarget=Hp(),this.pendingDocumentTargetMapping=Hp(),this.pendingTargetResets=new rt(ge)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:se()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(TE(s))if(r===0){let o=new te(s.path);this.removeDocumentFromTarget(t,o,$n.newNoDocument(o,le.min()))}else $e(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}HT?.notifyOnExistenceFilterMismatch(LQ(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Wr(r).toUint8Array()}catch(l){if(l instanceof RE)return Iu("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new NE(o,i,s)}catch(l){return l instanceof io?Iu("BloomFilter error: ",l):Iu("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&TE(a.target)){let l=new te(a.target.path);!this.ensureDocumentUpdateByTarget(l).has(o)&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,$n.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Se();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new rm(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=rs(),this.pendingDocumentUpdatesByTarget=Hp(),this.pendingDocumentTargetMapping=Hp(),this.pendingTargetResets=new rt(ge),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new om,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new _t(ge),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new _t(ge),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||H(FQ,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new om),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function Hp(){return new rt(te.comparator)}function o1(){return new rt(te.comparator)}function LQ(n,e,t,r,i){var s,o,a,l,c,u;let m={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},g=e.unchangedNames;return g&&(m.bloomFilter={applied:i===0,hashCount:(s=g?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=g?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=g?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:S=>{var T;return(T=r?.mightContain(S))!==null&&T!==void 0?T:!1}}),m}var BQ=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),VQ=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),UQ=(()=>{let n={};return n.and="AND",n.or="OR",n})();var kE=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function qQ(n){let e=n.code===void 0?K.UNKNOWN:Xp(n.code);return new ne(e,n.message||"")}function OE(n,e){return n.useProto3Json||Cm(e)?e:{value:e}}function zQ(n){let e;return typeof n=="object"?e=n.value:e=n,Cm(e)?null:e}function GQ(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function jQ(n){let e=$r(n);return new Tn(e.seconds,e.nanos)}function KQ(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function $Q(n,e){return n.useProto3Json?($e(e===void 0||typeof e=="string"),Mt.fromBase64String(e||"")):($e(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Mt.fromUint8Array(e||new Uint8Array))}function ul(n){return $e(!!n),le.fromTimestamp(jQ(n))}function WQ(n,e){return ME(n,e).canonicalString()}function ME(n,e){let t=QQ(n).child("documents");return e===void 0?t:t.child(e)}function fP(n){let e=St.fromString(n);return $e(vP(e)),e}function QT(n,e){let t=fP(e);if(t.get(1)!==n.databaseId.projectId)throw new ne(K.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ne(K.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new te(mP(t))}function pP(n,e){return WQ(n.databaseId,e)}function HQ(n){let e=fP(n);return e.length===4?St.emptyPath():mP(e)}function a1(n){return new St(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function QQ(n){return new St(["projects",n.projectId,"databases",n.database])}function mP(n){return $e(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function YQ(n,e){let t;if("targetChange"in e){e.targetChange;let r=XQ(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=$Q(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&qQ(o);t=new sm(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=QT(n,r.document.name),s=ul(r.document.updateTime),o=r.document.createTime?ul(r.document.createTime):le.min(),a=new jr({mapValue:{fields:r.document.fields}}),l=$n.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new cl(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=QT(n,r.document),s=r.readTime?ul(r.readTime):le.min(),o=$n.newNoDocument(i,s),a=r.removedTargetIds||[];t=new cl([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=QT(n,r.document),s=r.removedTargetIds||[];t=new cl([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new AE(i,s),a=r.targetId;t=new im(a,o)}else return se();return t}function XQ(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:se()}function JQ(n){if(!("targetChange"in n))return le.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?le.min():ul(e.readTime)}function ZQ(n,e){return{documents:[pP(n,e.path)]}}function e8(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=pP(n,i);let s=s8(e.filters);s&&(t.structuredQuery.where=s);let o=a8(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=OE(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=c8(e.startAt)),e.endAt&&(t.structuredQuery.endAt=u8(e.endAt)),{queryTarget:t,parent:i}}function t8(n){let e=HQ(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){$e(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=o8(t.where));let o=[];t.orderBy&&(o=l8(t.orderBy));let a=null;t.limit&&(a=zQ(t.limit));let l=null;t.startAt&&(l=d8(t.startAt));let c=null;return t.endAt&&(c=h8(t.endAt)),eQ(e,i,o,s,a,"F",l,c)}function n8(n,e){let t=r8(e.purpose);return t==null?null:{"goog-listen-tags":t}}function r8(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return se()}}function i8(n,e){let t,r=e.target;if(TE(r)?t={documents:ZQ(n,r)}:t={query:e8(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=KQ(n,e.resumeToken);let i=OE(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(le.min())>0){t.readTime=GQ(n,e.snapshotVersion.toTimestamp());let i=OE(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function s8(n){if(n.length!==0)return yP(_r.create(n,"and"))}function o8(n){let e=gP(n);return e instanceof _r&&J1(e)?e.getFilters():[e]}function gP(n){return n.unaryFilter!==void 0?T8(n):n.fieldFilter!==void 0?E8(n):n.compositeFilter!==void 0?C8(n):se()}function a8(n){if(n.length!==0)return n.map(e=>w8(e))}function l8(n){return n.map(e=>b8(e))}function c8(n){return{before:n.inclusive,values:n.position}}function u8(n){return{before:!n.inclusive,values:n.position}}function d8(n){let e=!!n.before,t=n.values||[];return new fl(t,e)}function h8(n){let e=!n.before,t=n.values||[];return new fl(t,e)}function f8(n){return BQ[n]}function p8(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function m8(n){return VQ[n]}function g8(n){return UQ[n]}function y8(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return se();default:return se()}}function v8(n){switch(n){case"AND":return"and";case"OR":return"or";default:return se()}}function ol(n){return{fieldPath:n.canonicalString()}}function ll(n){return Kn.fromServerFormat(n.fieldPath)}function w8(n){return{field:ol(n.field),direction:f8(n.dir)}}function b8(n){return new pl(ll(n.field),p8(n.direction))}function yP(n){return n instanceof mt?_8(n):n instanceof _r?S8(n):se()}function S8(n){let e=n.getFilters().map(t=>yP(t));return e.length===1?e[0]:{compositeFilter:{op:g8(n.op),filters:e}}}function _8(n){if(n.op==="=="){if(JM(n.value))return{unaryFilter:{field:ol(n.field),op:"IS_NAN"}};if(XM(n.value))return{unaryFilter:{field:ol(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(JM(n.value))return{unaryFilter:{field:ol(n.field),op:"IS_NOT_NAN"}};if(XM(n.value))return{unaryFilter:{field:ol(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ol(n.field),op:m8(n.op),value:n.value}}}function T8(n){switch(n.unaryFilter.op){case"IS_NAN":let e=ll(n.unaryFilter.field);return mt.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=ll(n.unaryFilter.field);return mt.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ll(n.unaryFilter.field);return mt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ll(n.unaryFilter.field);return mt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return se();default:return se()}}function E8(n){return mt.create(ll(n.fieldFilter.field),y8(n.fieldFilter.op),n.fieldFilter.value)}function C8(n){return _r.create(n.compositeFilter.filters.map(e=>gP(e)),v8(n.compositeFilter.op))}function vP(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var zu=class n{constructor(e,t,r,i,s=le.min(),o=le.min(),a=Mt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var PE=class{constructor(e){this.remoteSerializer=e}};function I8(n){let e=t8({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?EE(e,e.limit,"L"):e}function D8(n){return{name:n.name,query:I8(n.bundledQuery),readTime:ul(n.readTime)}}function A8(n){return{id:n.id,version:n.version,createTime:ul(n.createTime)}}var R8=5,N8=10,x8=13,YT=15,k8=20,O8=25,M8=30,P8=37,F8=45,L8=50,B8=53,V8=55,U8=60,q8=2,am=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,R8);else if("booleanValue"in e)this.writeValueTypeLabel(t,N8),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,YT),t.writeNumber(Ve(e.integerValue));else if("doubleValue"in e){let r=Ve(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,x8):(this.writeValueTypeLabel(t,YT),tm(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,k8),typeof r=="string"&&(r=$r(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,M8),t.writeBytes(Wr(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,F8),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?Q1(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):H1(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):se()}writeIndexString(e,t){this.writeValueTypeLabel(t,O8),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,V8);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,B8);let o=Ou,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,YT),t.writeNumber(Ve(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,L8);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,P8),te.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,U8),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(q8)}};am.INSTANCE=new am;var FE=class{constructor(){this.collectionParentIndex=new LE}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(lo.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(lo.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}},LE=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new _t(St.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new _t(St.comparator)).toArray()}};var Fne=new Uint8Array(0);var XT=2,Gu=class n{constructor(e){this.lastId=e}next(){return this.lastId+=XT,this.lastId}static forTargetCache(){return new n(2-XT)}static forSyncEngine(){return new n(1-XT)}};var l1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Nm=-1,wP=40*1024*1024,_n=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};_n.DEFAULT_COLLECTION_PERCENTILE=10;_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;_n.DEFAULT=new _n(wP,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);_n.DISABLED=new _n(Nm,0,0);var c1="LruGarbageCollector",u1=1*1024*1024,z8=1*60*1e3,G8=5*60*1e3;function d1([n,e],[t,r]){let i=ge(n,t);return i===0?ge(e,r):i}var BE=class{constructor(e){this.maxElements=e,this.buffer=new _t(d1),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();d1(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},VE=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Nm&&this.scheduleGC(z8)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){H(c1,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>_(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Cl(t)?H(c1,"Ignoring IndexedDB error during garbage collection: ",t):yield Tm(t)}yield this.scheduleGC(G8)}))}},UE=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(PC.INVALID);let r=new BE(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Nm?(H("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(l1)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(H("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),l1):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(H("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>{if(c=Date.now(),il()<=me.DEBUG){let g=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${m} documents in ${c-l}ms
Total Duration: ${c-u}ms`;H("LruGarbageCollector",g)}return M.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})})}};function j8(n,e){return new UE(n,e)}var qE=class{constructor(){this.changes=new Hr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$n.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var zE=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var GE=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Nu(r.mutation,i,no.empty(),Tn.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Se()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Se()){let i=ro();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Cu();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=ro();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Se()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=rs(),o=Fu(),a=fQ();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof wl)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Nu(u.mutation,c,u.mutation.getFieldMask(),Tn.now())):o.set(c.key,no.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var m;return a.set(c,new zE(u,(m=o.get(c))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Fu(),i=new rt((o,a)=>o-a),s=Se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||no.empty();u=a.applyToLocalView(c,u),r.set(l,u);let m=(i.get(a.batchId)||Se()).add(l);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,m=sP();u.forEach(g=>{if(!s.has(g)){let S=cP(t.get(g),r.get(g));S!==null&&m.set(g,S),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return rQ(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):iQ(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):M.resolve(ro()),a=xu,l=s;return o.next(c=>M.forEach(c,(u,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(u)?M.resolve():this.remoteDocumentCache.getEntry(e,u).next(g=>{l=l.insert(u,g)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Se())).next(u=>({batchId:a,changes:pQ(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new te(t)).next(r=>{let i=Cu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Cu();return this.indexManager.getCollectionParents(e,s).next(a=>M.forEach(a,l=>{let c=tQ(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,$n.newInvalidDocument(u)))});let a=Cu();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Nu(u.mutation,c,no.empty(),Tn.now()),Am(t,c)&&(a=a.insert(l,c))}),a})}};var jE=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return M.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,A8(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,D8(t)),M.resolve()}};var KE=class{constructor(){this.overlays=new rt(te.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ro();return M.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),M.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){let i=ro(),s=t.length+1,o=new te(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return M.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new rt((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let g=s.get(u.largestBatchId);g===null&&(g=ro(),s=s.insert(u.largestBatchId,g)),g.set(u.getKey(),u)}}let a=ro(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((m,g)=>a.set(m,g)),!(a.size()>=i)););return M.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new DE(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Se(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var $E=class{constructor(){this.sessionToken=Mt.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}};var ju=class{constructor(){this.refsByKey=new _t(ht.compareByKey),this.refsByTarget=new _t(ht.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new ht(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new ht(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new te(new St([])),r=new ht(t,e),i=new ht(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new te(new St([])),r=new ht(t,e),i=new ht(t,e+1),s=Se();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ht(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ht=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return te.comparator(e.key,t.key)||ge(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ge(e.targetOrBatchId,t.targetOrBatchId)||te.comparator(e.key,t.key)}};var WE=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new _t(ht.compareByKey)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new IE(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new ht(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return M.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?b7:this.nextBatchId-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ht(t,0),i=new ht(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),M.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new _t(ge);return t.forEach(i=>{let s=new ht(i,0),o=new ht(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),M.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;te.isDocumentKey(s)||(s=s.child(""));let o=new ht(new te(s),0),a=new _t(ge);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),M.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");$e(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return M.forEach(t.mutations,s=>{let o=new ht(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new ht(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return M.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function K8(){return new rt(te.comparator)}var HE=class{constructor(e){this.sizer=e,this.docs=K8(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():$n.newInvalidDocument(t))}getEntries(e,t){let r=rs();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():$n.newInvalidDocument(i))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=rs(),o=t.path,a=new te(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||GH(zH(u),r)<=0||!i.has(u.key)&&!Am(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return M.resolve(s)}getAllFromCollectionGroup(e,t,r,i){se()}forEachDocumentKey(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new QE(this)}getSize(e){return M.resolve(this.size)}};function $8(n){return new HE(n)}var QE=class extends qE{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var YE=class{constructor(e){this.persistence=e,this.targets=new Hr(t=>VC(t),UC),this.lastRemoteSnapshotVersion=le.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new ju,this.targetCount=0,this.targetIdGenerator=Gu.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),M.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Gu(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.saveTargetData(t),M.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),M.waitFor(s).next(()=>i)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),M.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),M.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),M.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this.references.containsKey(t))}};var W8="MemoryPersistence",lm=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new PC(0),this._started=!1,this._started=!0,this.globalsCache=new $E,this.referenceDelegate=e(this),this.targetCache=new YE(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new FE,this.remoteDocumentCache=$8(r),this.serializer=new PE(t),this.bundleCache=new jE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new KE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new WE(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){H(W8,"Starting transaction:",e);let i=new XE(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return M.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},XE=class extends uE{constructor(e){super(),this.currentSequenceNumber=e}},JE=class n{constructor(e){this.persistence=e,this.localViewReferences=new ju,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw se()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),M.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.orphanedDocuments,i=>{let s=te.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,le.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return M.or([()=>M.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}},cm=class n{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new Hr(r=>QH(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=j8(this,t)}static factory(e,t){return new n(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return M.forEach(this.orphanedSequenceNumbers,(r,i)=>this.isPinned(e,r,i).next(s=>s?M.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.forEachDocumentKey(e,a=>this.isPinned(e,a,t).next(l=>{l||(r++,s.removeEntry(a,le.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),M.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Im(e.data.value)),t}isPinned(e,t,r){return M.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.orphanedSequenceNumbers.get(t);return M.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Lne=30*60*1e3;function H8(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var zC="LocalStore",Q8=5*60*1e6,ZE=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new rt(ge),this.targetIdByTarget=new Hr(s=>VC(s),UC),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new GE(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function Y8(n,e,t,r){return new ZE(n,e,t,r)}function bP(n,e){return _(this,null,function*(){let t=ye(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Se();for(let u of s){a.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}for(let u of o){l.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function SP(n){let e=ye(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function X8(n,e){let t=ye(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,m)=>{let g=i.get(m);if(!g)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,m).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,m)));let S=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?S=S.withResumeToken(Mt.EMPTY_BYTE_STRING,le.min()).withLastLimboFreeSnapshotVersion(le.min()):u.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(u.resumeToken,r)),i=i.insert(m,S),Z8(g,S,u)&&a.push(t.targetCache.updateTargetData(s,S))});let l=rs(),c=Se();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(J8(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(le.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(m=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return M.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function J8(n,e,t){let r=Se(),i=Se();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=rs();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(le.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):H(zC,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function Z8(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=Q8?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function eY(n,e){return _(this,null,function*(){let t=ye(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>M.forEach(e,i=>M.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>M.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Cl(r))H(zC,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function tY(n,e){let t=ye(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,M.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new zu(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function nY(n,e,t){let r=ye(n),i=r.targetIdByTarget.get(t);return i!==void 0?M.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function eC(n,e,t){return _(this,null,function*(){let r=ye(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Cl(o))H(zC,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function _P(n,e,t){let r=ye(n),i=le.min(),s=Se();return r.persistence.runTransaction("Execute query","readwrite",o=>nY(r,o,Sr(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:le.min(),t?s:Se())).next(a=>(rY(r,uQ(e),a),{documents:a,remoteKeys:s})))}function rY(n,e,t){let r=n.collectionGroupReadTime.get(e)||le.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}var tC=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var iY=100;function sY(){return AM()?8:KH(DM())>0?6:4}var nC=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=iY,this.relativeIndexReadCostPerDocument=sY()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new tC;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(il()<=me.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",sl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),M.resolve()):(il()<=me.DEBUG&&H("QueryEngine","Query:",sl(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(il()<=me.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",sl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Sr(t))):M.resolve())}performQueryUsingIndex(e,t){if(t1(t))return M.resolve(null);let r=Sr(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=EE(t,null,"F"),r=Sr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Se(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,EE(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return t1(t)||i.isEqual(le.min())?M.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?M.resolve(null):(il()<=me.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),sl(t)),this.appendRemainingResults(e,o,t,qH(i,xu)).next(a=>a))})}applyQuery(e,t){let r=new _t(rP(e));return t.forEach((i,s)=>{Am(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return il()<=me.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",sl(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,lo.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var um=class{constructor(){this.activeTargetIds=yQ()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var rC=class{constructor(){this.localState=new um,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new um,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var iC=class{addCallback(e){}shutdown(){}};var sC=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Qp=null;function oY(){return 268435456+Math.round(2147483648*Math.random())}function JT(){return Qp===null?Qp=oY():Qp++,"0x"+Qp.toString(16)}function aY(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var lY="1.9.1",jt="GrpcConnection",cY=`gl-node/${process.versions.node} fire/${El} grpc/${lY}`;function ZT(n,e,t,r){$e(e===null||e.type==="OAuth");let i=new so.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",cY),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var oC=class{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){H(jt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?so.credentials.createSsl():so.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=JT(),a=this.ensureActiveStub(),l=ZT(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return aY(u=>(H(jt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(m,g)=>{m?(H(jt,`RPC '${e}' ${o} failed with error:`,m),u(new ne(Xp(m.code),m.message))):(H(jt,`RPC '${e}' ${o} completed with response:`,g),u(void 0,g))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=JT(),l=[],c=new Kr;H(jt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),m=ZT(this.databasePath,i,s,this.databaseInfo.appId),g=Object.assign(Object.assign({},r),{database:this.databasePath}),S=u[e](g,m),T=!1;return S.on("data",C=>{H(jt,`RPC ${e} ${a} received result:`,C),l.push(C),o!==void 0&&l.length===o&&(T=!0,c.resolve(l))}),S.on("end",()=>{H(jt,`RPC '${e}' ${a} completed.`),T||(T=!0,c.resolve(l))}),S.on("error",C=>{H(jt,`RPC '${e}' ${a} failed with error:`,C);let E=Xp(C.code);c.reject(new ne(E,C.message))}),c.promise}openStream(e,t,r){let i=JT(),s=this.ensureActiveStub(),o=ZT(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=g=>{l||(l=!0,u.callOnClose(g),a.end())},u=new sC({sendFn:g=>{if(l)H(jt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,g);else{H(jt,`RPC '${e}' stream ${i} sending:`,g);try{a.write(g)}catch(S){throw jn("Failure sending:",g),jn("Error:",S),S}}},closeFn:()=>{H(jt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),m=!1;return a.on("data",g=>{l||(H(jt,`RPC '${e}' stream ${i} received:`,g),m||(u.callOnConnected(),m=!0),u.callOnMessage(g))}),a.on("end",()=>{H(jt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",g=>{if(!l){Iu(jt,`RPC '${e}' stream ${i} error. Code:`,g.code,"Message:",g.message);let S=Xp(g.code);c(new ne(S,g.message))}}),H(jt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},TP={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},uY={nested:TP},dY=Object.freeze({__proto__:null,nested:TP,default:uY});var hY={longs:String,enums:String,defaults:!0,oneofs:!1};function fY(){let n=I1.fromJSON(dY,hY);return so.loadPackageDefinition(n)}function pY(n){let e=fY();return new oC(e,n)}function mY(){return new iC}function EP(n){return new kE(n,!1)}var gY="ExponentialBackoff",yY=1e3,vY=1.5,wY=60*1e3,dm=class{constructor(e,t,r=yY,i=vY,s=wY){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&H(gY,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var h1="PersistentStream",bY=60*1e3,SY=10*1e3,aC=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new dm(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return _(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,bY,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return _(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return _(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===K.RESOURCE_EXHAUSTED?(jn(t.toString()),jn("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===K.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new ne(K.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,SY,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>_(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return H(h1,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(H(h1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},lC=class extends aC{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=YQ(this.serializer,e),r=JQ(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=a1(this.serializer),t.addTarget=i8(this.serializer,e);let r=n8(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=a1(this.serializer),t.removeTarget=e,this.sendRequest(t)}};var cC=class{},uC=class extends cC{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new ne(K.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,ME(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new ne(K.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,ME(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ne(K.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function _Y(n,e,t,r){return new uC(n,e,t,r)}function TY(n,e,t){let r=ye(n);return r.verifyInitialized(),new lC(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var EY="OnlineStateTracker",f1=1,p1=10*1e3,dC=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",p1,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${p1/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=f1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${f1} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(jn(t),this.shouldWarnClientIsOffline=!1):H(EY,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var bl="RemoteStore";var hC=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>_(this,null,function*(){Hu(this)&&(H(bl,"Restarting streams for network reachability change."),yield OY(this))}))}),this.onlineStateTracker=new dC(r,i)}};function CY(n,e,t,r,i){return new hC(n,e,t,r,i)}function xm(n){return _(this,null,function*(){if(Hu(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function Wu(n){return _(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function IY(n){return _(this,null,function*(){let e=ye(n);H(bl,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Wu(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function CP(n,e){let t=ye(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),$C(t)?KC(t):Il(t).isOpen()&&jC(t,e))}function GC(n,e){let t=ye(n),r=Il(t);t.listenTargets.delete(e),r.isOpen()&&IP(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Hu(t)&&t.onlineStateTracker.set("Unknown"))}function jC(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(le.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Il(n).watch(e)}function IP(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Il(n).unwatch(e)}function KC(n){n.watchChangeAggregator=new xE({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Il(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function $C(n){return Hu(n)&&!Il(n).isStarted()&&n.listenTargets.size>0}function Hu(n){return ye(n).offlineCauses.size===0}function DP(n){n.watchChangeAggregator=void 0}function DY(n){return _(this,null,function*(){n.onlineStateTracker.set("Online")})}function AY(n){return _(this,null,function*(){n.listenTargets.forEach((e,t)=>{jC(n,e)})})}function RY(n,e){return _(this,null,function*(){DP(n),$C(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),KC(n)):n.onlineStateTracker.set("Unknown")})}function NY(n,e,t){return _(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof sm&&e.state===2&&e.cause){try{yield kY(n,e)}catch(r){H(bl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield m1(n,r)}return}if(e instanceof cl?n.watchChangeAggregator.handleDocumentChange(e):e instanceof im?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(le.min()))try{let r=yield SP(n.localStore);t.compareTo(r)>=0&&(yield xY(n,t))}catch(r){H(bl,"Failed to raise snapshot:",r),yield m1(n,r)}})}function m1(n,e,t){return _(this,null,function*(){if(Cl(e))n.offlineCauses.add(1),yield Wu(n),n.onlineStateTracker.set("Offline"),t||(t=()=>SP(n.localStore)),n.asyncQueue.enqueueRetryable(()=>_(this,null,function*(){H(bl,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield xm(n)}));else throw e})}function xY(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Mt.EMPTY_BYTE_STRING,s.snapshotVersion)),IP(n,r);let o=new zu(s.target,r,i,s.sequenceNumber);jC(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function kY(n,e){return _(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function OY(n){return _(this,null,function*(){let e=ye(n);e.offlineCauses.add(4),yield Wu(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield xm(e)})}function g1(n,e){return _(this,null,function*(){let t=ye(n);t.asyncQueue.verifyOperationInProgress(),H(bl,"RemoteStore received new credentials");let r=Hu(t);t.offlineCauses.add(3),yield Wu(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield xm(t)})}function MY(n,e){return _(this,null,function*(){let t=ye(n);e?(t.offlineCauses.delete(2),yield xm(t)):e||(t.offlineCauses.add(2),yield Wu(t),t.onlineStateTracker.set("Unknown"))})}function Il(n){return n.watchStream||(n.watchStream=TY(n.datastore,n.asyncQueue,{onConnected:DY.bind(null,n),onOpen:AY.bind(null,n),onClose:RY.bind(null,n),onWatchChange:NY.bind(null,n)}),n.onNetworkStatusChange.push(e=>_(this,null,function*(){e?(n.watchStream.inhibitBackoff(),$C(n)?KC(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),DP(n))}))),n.watchStream}var PY="AsyncQueue",fC=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Kr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ne(K.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function AP(n,e){if(jn(PY,`${e}: ${n}`),Cl(n))return new ne(K.UNAVAILABLE,`${e}: ${n}`);throw n}var hm=class n{static emptySet(e){return new n(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||te.comparator(t.key,r.key):this.comparator=(t,r)=>te.comparator(t.key,r.key),this.keyedMap=Cu(),this.sortedSet=new rt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var fm=class{constructor(){this.changeMap=new rt(te.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):se()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Sl=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,hm.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Dm(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var pC=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function FY(){return new mC}var mC=class{constructor(){this.queries=RP(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){zY(this,new ne(K.ABORTED,"Firestore shutting down"))}};function RP(){return new Hr(n=>nP(n),Dm)}function LY(n,e){return _(this,null,function*(){let t=ye(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new pC,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=AP(o,`Initialization of query '${sl(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&WC(t)})}function BY(n,e){return _(this,null,function*(){let t=ye(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function VY(n,e){let t=ye(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&WC(t)}function UY(n,e,t){let r=ye(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function qY(n,e){let t=ye(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&WC(t)}function zY(n,e){let t=ye(n),r=t.queries;t.queries=RP(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function WC(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var NP=function(n){return n.Default="default",n.Cache="cache",n}(NP||{}),gC=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Sl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Sl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==NP.Cache}};var yC=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Se(),i=Se();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var pm=class{constructor(e){this.key=e}},mm=class{constructor(e){this.key=e}},vC=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Se(),this.mutatedKeys=Se(),this.docComparator=rP(e),this.documentSet=new hm(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new fm,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,m)=>{let g=i.get(u),S=Am(this.query,m)?m:null,T=g?this.mutatedKeys.has(g.key):!1,C=S?S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations:!1,E=!1;g&&S?g.data.isEqual(S.data)?T!==C&&(r.track({type:3,doc:S}),E=!0):this.shouldWaitForSyncedDocument(g,S)||(r.track({type:2,doc:S}),E=!0,(l&&this.docComparator(S,l)>0||c&&this.docComparator(S,c)<0)&&(a=!0)):!g&&S?(r.track({type:0,doc:S}),E=!0):g&&!S&&(r.track({type:1,doc:g}),E=!0,(l||c)&&(a=!0)),E&&(S?(o=o.add(S),C?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((m,g)=>GY(m.type,g.type)||this.docComparator(m.doc,g.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Sl(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new fm,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Se(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new mm(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new pm(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Se();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Sl.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function GY(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return se()}};return t(n)-t(e)}var HC="SyncEngine",wC=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},bC=class{constructor(e){this.key=e,this.receivedDocument=!1}},SC=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new Hr(a=>nP(a),Dm),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new rt(te.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new ju,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Gu.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function jY(n,e,t,r,i,s,o){let a=new SC(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function KY(n,e,t=!0){return _(this,null,function*(){let r=FP(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield xP(r,e,t,!0),i})}function $Y(n,e){return _(this,null,function*(){let t=FP(n);yield xP(t,e,!0,!1)})}function xP(n,e,t,r){return _(this,null,function*(){let i=yield tY(n.localStore,Sr(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield WY(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&CP(n.remoteStore,i),a})}function WY(n,e,t,r,i){return _(this,null,function*(){n.applyDocChanges=(m,g,S)=>ZY(n,m,g,S);let s=yield _P(n.localStore,e,!0),o=new vC(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=qu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);MP(n,t,c.limboChanges);let u=new wC(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function HY(n,e,t){return _(this,null,function*(){let r=ye(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Dm(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield eC(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&GC(r.remoteStore,i.targetId),_C(r,i.targetId)}).catch(Tm))):(_C(r,i.targetId),yield eC(r.localStore,i.targetId,!0))})}function QY(n,e){return _(this,null,function*(){let t=ye(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),GC(t.remoteStore,r.targetId))})}function kP(n,e){return _(this,null,function*(){let t=ye(n);try{let r=yield X8(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&($e(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?$e(o.receivedDocument):i.removedDocuments.size>0&&($e(o.receivedDocument),o.receivedDocument=!1))}),yield PP(t,r,e)}catch(r){yield Tm(r)}})}function y1(n,e,t){let r=ye(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),qY(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function YY(n,e,t){return _(this,null,function*(){let r=ye(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new rt(te.comparator);o=o.insert(s,$n.newNoDocument(s,le.min()));let a=Se().add(s),l=new rm(le.min(),new Map,new rt(ge),o,a);yield kP(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),QC(r)}else yield eC(r.localStore,e,!1).then(()=>_C(r,e,t)).catch(Tm)})}function XY(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new ne(K.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function _C(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||OP(n,i)})}function OP(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(GC(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),QC(n))}function MP(n,e,t){for(let r of t)r instanceof pm?(n.limboDocumentRefs.addReference(r.key,e),JY(n,r)):r instanceof mm?(H(HC,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||OP(n,r.key)):se()}function JY(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(H(HC,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),QC(n))}function QC(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new te(St.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new bC(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),CP(n.remoteStore,new zu(Sr(qC(t.path)),r,"TargetPurposeLimboResolution",PC.INVALID))}}function PP(n,e,t){return _(this,null,function*(){let r=ye(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let m=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(c){i.push(c);let m=yC.fromSnapshot(l.targetId,c);s.push(m)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield eY(r.localStore,s))})}function ZY(n,e,t,r){return _(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield _P(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return MP(n,e.targetId,a.limboChanges),a.snapshot})}function eX(n,e){return _(this,null,function*(){let t=ye(n);if(!t.currentUser.isEqual(e)){H(HC,"User change. New user:",e.toKey());let i=yield bP(t.localStore,e);t.currentUser=e,XY(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield PP(t,i.affectedDocuments)}})}function tX(n,e){let t=ye(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Se().add(r.key);{let i=Se(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function FP(n){let e=ye(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=kP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tX.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=YY.bind(null,e),e.syncEngineListener.onWatchChange=VY.bind(null,e.eventManager),e.syncEngineListener.onWatchError=UY.bind(null,e.eventManager),e}var LP=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return _(this,null,function*(){this.serializer=EP(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return Y8(this.persistence,new nC,t.initialUser,this.serializer)}createPersistence(t){return new lm(JE.factory,this.serializer)}createSharedClientState(t){return new rC}terminate(){return _(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),TC=class extends LP{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){$e(this.persistence.referenceDelegate instanceof cm);let r=this.persistence.referenceDelegate.garbageCollector;return new VE(r,e.asyncQueue,t)}createPersistence(e){let t=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new lm(r=>cm.factory(r,t),this.serializer)}};var nX=(()=>{class n{initialize(t,r){return _(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>y1(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=eX.bind(null,this.syncEngine),yield MY(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return FY()}createDatastore(t){let r=EP(t.databaseInfo.databaseId),i=pY(t.databaseInfo);return _Y(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return CY(this.localStore,this.datastore,t.asyncQueue,r=>y1(this.syncEngine,r,0),mY())}createSyncEngine(t,r){return jY(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return _(this,null,function*(){var t,r;yield IY(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})();function rX(n,e,t,r){if(e===!0&&r===!0)throw new ne(K.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function iX(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=sX(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":se()}function sX(n){return n.constructor?n.constructor.name:null}function eE(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ne(K.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=iX(n);throw new ne(K.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var EC=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):jn("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var is="FirestoreClient",oX=100,aX=11,lX=20,cX=22,CC=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ot.UNAUTHENTICATED,this.clientId=cE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>_(this,null,function*(){H(is,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(H(is,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:oX}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Kr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=AP(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function tE(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),H(is,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>_(this,null,function*(){r.isEqual(i)||(yield bP(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function v1(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield dX(n);H(is,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>g1(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>g1(e.remoteStore,i)),n._onlineComponents=e})}function uX(n){return n.name==="FirebaseError"?n.code===K.FAILED_PRECONDITION||n.code===K.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===cX||n.code===lX||n.code===aX:!0}function dX(n){return _(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){H(is,"Using user provided OfflineComponentProvider");try{yield tE(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!uX(t))throw t;Iu("Error using user provided cache. Falling back to memory cache: "+t),yield tE(n,new LP)}}else H(is,"Using default OfflineComponentProvider"),yield tE(n,new TC(void 0));return n._offlineComponents})}function hX(n){return _(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(H(is,"Using user provided OnlineComponentProvider"),yield v1(n,n._uninitializedComponentsProvider._online)):(H(is,"Using default OnlineComponentProvider"),yield v1(n,new nX))),n._onlineComponents})}function w1(n){return _(this,null,function*(){let e=yield hX(n),t=e.eventManager;return t.onListen=KY.bind(null,e.syncEngine),t.onUnlisten=HY.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=$Y.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=QY.bind(null,e.syncEngine),t})}function fX(n,e,t,r){let i=new EC(r),s=new gC(e,i,t);return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let o=yield w1(n);return LY(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let o=yield w1(n);return BY(o,s)}))}}function pX(n,e){return n.timeoutSeconds===e.timeoutSeconds}function BP(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var mX="ComponentProvider",b1=new Map;function gX(n){let e=b1.get(n);e&&(H(mX,"Removing Datastore"),b1.delete(n),e.terminate())}function yX(n,e,t,r){return new hE(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,BP(r.experimentalLongPollingOptions),r.useFetchStreams)}var vX="firestore.googleapis.com",S1=!0,_1=5,T1=30,wX=!0,gm=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ne(K.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vX,this.ssl=S1}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:S1;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=wP;else{if(e.cacheSizeBytes!==Nm&&e.cacheSizeBytes<u1)throw new ne(K.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${u1}`);this.cacheSizeBytes=e.cacheSizeBytes}rX("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=wX:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=BP((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),bX(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&pX(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function bX(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new ne(K.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<_1)throw new ne(K.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${_1})`);if(n.timeoutSeconds>T1)throw new ne(K.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${T1})`)}}var IC=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gm({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ne(K.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ne(K.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gm(e),e.credentials!==void 0&&(this._authCredentials=BH(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return _(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return gX(this),Promise.resolve()}};var ym=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},_l=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new DC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},DC=class n extends ym{constructor(e,t,r){super(e,t,qC(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new _l(this.firestore,null,new te(e))}withConverter(e){return new n(this.firestore,e,this._path)}};var SX="AsyncQueue",vm=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new dm(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Kr;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return _(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Cl(e))H(SX,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=_X(r);throw jn("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=fC.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&se()}verifyOperationInProgress(){}drain(){return _(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function _X(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var Ku=class extends IC{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new vm,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return _(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new vm(e),this._firestoreClient=void 0,yield e}})}};function TX(n){if(n._terminated)throw new ne(K.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||EX(n),n._firestoreClient}function EX(n){var e,t,r;let i=n._freezeSettings(),s=yX(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new CC(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&CX(n._componentsProvider))}function CX(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function IX(n,e=!0){FH(LM),Tu(new es("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ku(new iE(t.getProvider("auth-internal")),new lE(t.getProvider("app-check-internal")),w7(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),rl(zM,GM,n),rl(zM,GM,"esm2017")}var AC=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Mt.fromBase64String(e))}catch(t){throw new ne(K.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Mt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var wm=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ne(K.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Kn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var RC=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ne(K.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ne(K.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ge(this._lat,e._lat)||ge(this._long,e._long)}};var NC=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return H8(this._values,e._values)}};var DX=new RegExp("[~\\*/\\[\\]]");function AX(n,e,t){if(e.search(DX)>=0)throw E1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new wm(...e.split("."))._internalPath}catch{throw E1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function E1(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new ne(K.INVALID_ARGUMENT,a+n+l)}var bm=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new _l(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new xC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(VP("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},xC=class extends bm{data(){return super.data()}};function VP(n,e){return typeof e=="string"?AX(n,e):e instanceof wm?e._internalPath:e._delegate._internalPath}function RX(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ne(K.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var kC=class{convertValue(e,t="none"){switch(ns(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Wr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw se()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return $u(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Ou].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ve(o.doubleValue));return new NC(s)}convertGeoPoint(e){return new RC(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Em(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ku(e));default:return null}}convertTimestamp(e){let t=$r(e);return new Tn(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=St.fromString(e);$e(vP(r));let i=new em(r.get(1),r.get(3)),s=new te(r.popFirst(5));return i.isEqual(t)||jn(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function C1(n){return NX(n,["next","error","complete"])}function NX(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var co=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Sm=class extends bm{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Tl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(VP("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Tl=class extends Sm{data(e={}){return super.data(e)}},OC=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new co(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Tl(this._firestore,this._userDataWriter,r.key,r,new co(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ne(K.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=xX(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function xX(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Tl(n._firestore,n._userDataWriter,r.doc.key,r.doc,new co(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Tl(n._firestore,n._userDataWriter,r.doc.key,r.doc,new co(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:kX(r.type),doc:i,oldIndex:s,newIndex:o}})}}function kX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return se()}}var _m=class extends kC{constructor(e){super(),this.firestore=e}convertBytes(e){return new AC(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new _l(this.firestore,null,t)}};function UP(n,...e){var t,r,i;n=NM(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!C1(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(C1(e[o])){let g=e[o];e[o]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[o+1]=(r=g.error)===null||r===void 0?void 0:r.bind(g),e[o+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,c,u;if(n instanceof _l)c=eE(n.firestore,Ku),u=qC(n._key.path),l={next:g=>{e[o]&&e[o](OX(c,n,g))},error:e[o+1],complete:e[o+2]};else{let g=eE(n,ym);c=eE(g.firestore,Ku),u=g._query;let S=new _m(c);l={next:T=>{e[o]&&e[o](new OC(c,S,g,T))},error:e[o+1],complete:e[o+2]},RX(n._query)}let m=TX(c);return fX(m,u,a,l)}function OX(n,e,t){let r=t.docs.get(e._key),i=new _m(n);return new Sm(n,i,e._key,r,new co(t.hasPendingWrites,t.fromCache),e.converter)}IX("node");var km=function(){return km=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},km.apply(this,arguments)};var MX={includeMetadataChanges:!1};function qP(n,e){return e===void 0&&(e=MX),new Wn(function(t){var r=UP(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function zP(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:km(km({},r),(t={},t[e.idField]=n.id,t))}function GP(n){return qP(n,{includeMetadataChanges:!0}).pipe(ot(function(e){return e.docs}))}function jP(n,e){return e===void 0&&(e={}),GP(n).pipe(ot(function(t){return t.map(function(r){return zP(r,e)})}))}var Om=class{constructor(e){return e}};var YC=tg(jP,!0);var XC=tg(gu,!0);function FX(n,e){if(n&1&&(Z(0,"li")(1,"strong"),oe(2,"Type:"),ee(),oe(3),Ml(4,"br"),Z(5,"strong"),oe(6,"Context:"),ee(),oe(7),Ml(8,"br"),Z(9,"strong"),oe(10,"Date:"),ee(),oe(11),jm(12,"date"),ee()),n&2){let t=e.$implicit;qe(3),Pl(" ",t.type," "),qe(4),Pl(" ",t.context," "),qe(4),Pl(" ",Km(12,3,t.date.toDate(),"medium")," ")}}function LX(n,e){if(n&1&&(Z(0,"div",6)(1,"h2"),oe(2,"General Overview"),ee(),Z(3,"p"),oe(4),ee(),Z(5,"h3"),oe(6,"Agenda"),ee(),Z(7,"ul"),ed(8,FX,13,6,"li",7),ee()()),n&2){let t=Gm();qe(4),Pl("Total Patients: ",t.totalPatients,""),qe(4),Ol("ngForOf",t.appointments)}}function BX(n,e){if(n&1&&(Z(0,"tr")(1,"td"),oe(2),ee(),Z(3,"td"),oe(4),ee(),Z(5,"td"),oe(6),ee(),Z(7,"td"),oe(8),ee(),Z(9,"td"),oe(10),jm(11,"date"),ee()()),n&2){let t=e.$implicit;qe(2),mo(t.id),qe(2),mo(t.name),qe(2),mo(t.area),qe(2),mo(t.status),qe(2),mo(Km(11,5,t.date.toDate(),"medium"))}}function VX(n,e){if(n&1&&(Z(0,"div",8)(1,"h2"),oe(2,"Patients List"),ee(),Z(3,"table")(4,"thead")(5,"tr")(6,"th"),oe(7,"ID"),ee(),Z(8,"th"),oe(9,"Name"),ee(),Z(10,"th"),oe(11,"Area"),ee(),Z(12,"th"),oe(13,"Status"),ee(),Z(14,"th"),oe(15,"Date"),ee()()(),Z(16,"tbody"),ed(17,BX,12,8,"tr",7),ee()()()),n&2){let t=Gm();qe(17),Ol("ngForOf",t.pacients)}}var KP=(()=>{class n{constructor(t){this.firestore=t,this.activeTab="general",this.totalPatients=0,this.appointments=[],this.pacients=[]}ngOnInit(){this.loadPatients(),this.loadAppointments()}setActiveTab(t){this.activeTab=t}loadPatients(){let t=XC(this.firestore,"pacients");YC(t,{idField:"id"}).subscribe(r=>{this.pacients=r,this.totalPatients=r.length})}loadAppointments(){let t=XC(this.firestore,"appointments");YC(t,{idField:"id"}).subscribe(r=>{this.appointments=r})}static{this.\u0275fac=function(r){return new(r||n)(Fe(Om))}}static{this.\u0275cmp=Jr({type:n,selectors:[["app-dashboard"]],decls:9,vars:6,consts:[[1,"dashboard"],[1,"side-panel"],[3,"click"],[1,"main-content"],["class","general-tab",4,"ngIf"],["class","pacients-tab",4,"ngIf"],[1,"general-tab"],[4,"ngFor","ngForOf"],[1,"pacients-tab"]],template:function(r,i){r&1&&(Z(0,"div",0)(1,"div",1)(2,"button",2),Dt("click",function(){return i.setActiveTab("general")}),oe(3,"General"),ee(),Z(4,"button",2),Dt("click",function(){return i.setActiveTab("pacients")}),oe(5,"Pacients"),ee()(),Z(6,"div",3),ed(7,LX,9,2,"div",4)(8,VX,18,1,"div",5),ee()()),r&2&&(qe(2),po("active",i.activeTab==="general"),qe(2),po("active",i.activeTab==="pacients"),qe(3),Ol("ngIf",i.activeTab==="general"),qe(),Ol("ngIf",i.activeTab==="pacients"))},dependencies:[c0,u0,d0],styles:[".dashboard[_ngcontent-%COMP%]{display:flex;height:100vh}.dashboard[_ngcontent-%COMP%]   .side-panel[_ngcontent-%COMP%]{width:200px;background-color:#00796b;color:#fff;display:flex;flex-direction:column;gap:10px;padding:15px}.dashboard[_ngcontent-%COMP%]   .side-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;color:#fff;padding:10px;text-align:left;cursor:pointer}.dashboard[_ngcontent-%COMP%]   .side-panel[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#004d40;font-weight:700}.dashboard[_ngcontent-%COMP%]   .side-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#00574b}.dashboard[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]{flex:1;padding:20px}.dashboard[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:15px}.dashboard[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:is(th, td)[_ngcontent-%COMP%]{border:1px solid #ccc;padding:10px;text-align:left}.dashboard[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f5f5f5}"]})}}return n})();var UX=[{path:"",component:T0},{path:"login",component:EM},{path:"dashboard",component:KP}],$P=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=$t({type:n})}static{this.\u0275inj=Kt({imports:[Ym.forRoot(UX),Ym]})}}return n})();var Mm=(()=>{class n{constructor(){this.title="medihelp"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=Jr({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(r,i){r&1&&Ml(0,"router-outlet")},dependencies:[p0]})}}return n})();var WP={production:!1,firebase:{apiKey:"AIzaSyAzID9DPONp3kZztJrFd-t0cUprQQKoPN4",authDomain:"gluciobot.firebaseapp.com",projectId:"gluciobot",storageBucket:"gluciobot.firebasestorage.app",messagingSenderId:"505352236961",appId:"1:505352236961:web:68c8c70b9afaa2e6c365e0"}};var HP=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=$t({type:n,bootstrap:[Mm]})}static{this.\u0275inj=Kt({imports:[h0,$P,TM,U0.initializeApp(WP.firebase),JO]})}}return n})();var qX=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=$t({type:n,bootstrap:[Mm]})}static{this.\u0275inj=Kt({imports:[HP,f0]})}}return n})();export{qX as a};
